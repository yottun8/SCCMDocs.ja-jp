---
title: "タスクの自動化計画に関する考慮事項 | Microsoft Docs"
description: "System Center Configuration Manager でのタスクの自動化の前の計画"
ms.custom: na
ms.date: 10/06/2016
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology:
- configmgr-osd
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: fc497a8a-3c54-4529-8403-6f6171a21c64
caps.latest.revision: 13
caps.handback.revision: 0
author: Dougeby
ms.author: dougeby
manager: angrobe
translationtype: Human Translation
ms.sourcegitcommit: 74341fb60bf9ccbc8822e390bd34f9eda58b4bda
ms.openlocfilehash: 830f715b688cc9929a179da94eba9c81de8db11a


---
# <a name="planning-considerations-for-automating-tasks-in-system-center-configuration-manager"></a>System Center Configuration Manager でのタスクの自動化計画に関する考慮事項

*適用対象: System Center Configuration Manager (Current Branch)*

System Center Configuration Manager 環境でタスクを自動化するためのタスク シーケンスを作成できます。 これらのタスクには、参照コンピューターでのオペレーティング システムのキャプチャや、1 台以上の展開先コンピューターへのオペレーティング システムの展開などがあります。 タスク シーケンス アクションは、シーケンスの個別のステップで定義されます。 タスク シーケンスを実行する際、各ステップの操作はローカル システム コンテキストのコマンドライン レベルで実行され、ユーザー操作は不要です。 次のセクションは、Configuration Manager におけるタスクの自動化計画に役立ちます。

##  <a name="a-namebkmktsstepsactionsa-task-sequence-steps-and-actions"></a><a name="BKMK_TSStepsActions"></a> タスク シーケンスのステップとアクション  
 ステップは、タスク シーケンスの基本コンポーネントです。 参照コンピューターのオペレーティング システムを構成してキャプチャするコマンドが含まれている場合や、オペレーティング システム、ドライバー、Configuration Manager クライアント、ソフトウェアをセットアップ先のコンピューターにインストールするコマンドが含まれている場合があります。 タスク シーケンスのステップのコマンドは、ステップのアクションによって定義されます。 2 種類のアクションがあります。 コマンドライン文字列で定義するアクションは、カスタム アクションと呼ばれます。 Configuration Manager で定義済みのアクションは、組み込みアクションと呼ばれます。 タスク シーケンスは、カスタム アクションと組み込みアクションを任意に組み合わせて実行できます。  

 タスク シーケンスのステップには、エラーが発生した場合にタスク シーケンスを停止するか続行するかなど、ステップの動作方法を制御する条件を含めることもできます。 条件は、ステップにタスク シーケンス変数を含めることで、ステップに追加されます。 たとえば、 **SMSTSLastActionRetCode** 変数を使用して、前のステップの条件をテストできます。 変数は、1 つのステップまたはステップのグループに追加できます。  

 タスク シーケンスのステップは、ステップのアクションやステップに割り当てられたすべての条件を含めて、順次に処理されます。 Configuration Manager がタスク シーケンスのステップの処理を開始する際、前のアクションが完了するまでは、次のステップが開始されません。 タスク シーケンスは、すべてのステップが完了されたか、タスク シーケンスがすべてのステップを完了する前に Configuration Manager が失敗したステップのため実行を停止した場合に、完了したと見なされます。 たとえば、タスク シーケンスのステップが参照イメージまたはパッケージを配布ポイントで見つけられない場合、タスク シーケンスには破損された参照が含まれ、エラー発生時に続行する条件がエラーの発生したステップにない限り、Configuration Manager はその時点でタスク シーケンスの実行を停止します。  

> [!IMPORTANT]  
>  既定では、1 つのステップまたはアクションが失敗すると、タスク シーケンスが失敗します。 ステップでエラーが発生した後もタスク シーケンスを続行するには、タスク シーケンスを編集し、 [オプション] タブをクリックして、 [エラー時に続行する]」を参照してください。  

 タスク シーケンスに追加できるステップの詳細については、「[タスク シーケンスのステップ](../understand/task-sequence-steps.md)」を参照してください。  

##  <a name="a-namebkmktsgroupsa-task-sequence-groups"></a><a name="BKMK_TSGroups"></a> タスク シーケンス グループ  
 **グループ**とは、タスク シーケンス内の複数のステップのことです。 タスク シーケンス グループには、タスク シーケンスが次のステップに進む前に単位として評価される名前、オプションの説明、およびオプションの条件があります。 グループは入れ子にできます。また、グループにステップとサブグループを含むこともできます。 グループは、1 つの条件を共有する複数のステップをまとめる場合に便利です。  

> [!IMPORTANT]  
>  既定では、グループ内のステップまたは入れ子のグループの 1 つが失敗すると、タスク シーケンス グループが失敗します。 ステップまたは入れ子のグループでエラーが発生した後もタスク シーケンスを続行する場合は、タスク シーケンスを編集し、 [オプション] タブをクリックして、 [エラー時に続行する]」を参照してください。  

 次の表には、ステップをグループ化した場合、**[エラー時に続行する]** オプションがどのように動作するかを示します。  

 この例では、2 つのタスク シーケンス グループそれぞれに、3 つのタスク シーケンス ステップが含まれています。  

|タスク シーケンス グループまたはステップ|[エラー時に続行する] の設定状況|  
|---------------------------------|-------------------------------|  
|**タスク シーケンス グループ 1**|**[エラー時に続行する]** がオン。|  
|タスク シーケンス ステップ 1|**[エラー時に続行する]** がオン。|  
|タスク シーケンス ステップ 2|未設定。|  
|タスク シーケンス ステップ 3|未設定。|  
|**タスク シーケンス グループ 2**|未設定。|  
|タスク シーケンス ステップ 4|未設定。|  
|タスク シーケンス ステップ 5|未設定。|  
|タスク シーケンス ステップ 6|未設定。|  

-   タスク シーケンス ステップ 1 が失敗すると、タスク シーケンスはタスク シーケンス ステップ 2 へ進みます。  

-   タスク シーケンス ステップ 2 が失敗すると、タスク シーケンスはタスク シーケンス ステップ 3 を実行せず、異なるタスク シーケンス グループに含まれているタスク シーケンス ステップ 4 および 5 へ進みます。  

-   タスク シーケンス ステップ 4 が失敗すると、ステップはそれ以上実行されず、タスク シーケンス グループ 2 には **[エラー時に続行する]** が設定されていないので、このタスク シーケンスは失敗します。  

 タスク シーケンス グループには名前を指定する必要があります。ただし、グループ名が一意である必要はありません。 また、オプションで、タスク シーケンス グループの説明を指定することもできます。  

##  <a name="a-namebkmktsvariablesa-task-sequence-variables"></a><a name="BKMK_TSVariables"></a> タスク シーケンス変数  
 タスク シーケンス変数は、一連の名前と値のペアであり、Configuration Manager のクライアント コンピューターのコンピューター、オペレーティング システム、およびユーザー状態構成タスクに、構成およびオペレーティング システム展開設定を指定します。 タスク シーケンス変数は、タスク シーケンス ステップの構成およびカスタマイズを行うメカニズムです。  

 タスク シーケンスを実行すると、多くのタスク シーケンス設定は環境変数として保存されます。 組み込みタスク シーケンス変数の値は、アクセスしたり変更したりすることができます。また、新しいタスク シーケンス変数を作成して、タスク シーケンスを展開先コンピューターで実行する方法をカスタマイズすることもできます。  

 タスク シーケンス環境でタスク シーケンス変数を使用して、次のアクションを実行できます。  

-   タスク シーケンス アクションの設定を構成する  

-   タスク シーケンス ステップにコマンド ライン引数を指定する  

-   タスク シーケンス ステップまたはグループを実行するかどうかを判断する条件を評価する  

-   タスク シーケンスで使用されるカスタム スクリプトに値を提供する  

 たとえば、**[ドメインまたはワークグループに参加]** タスク シーケンス ステップがタスク シーケンスに含まれており、 ドメイン メンバーシップによってコレクションのメンバーシップが決定される、さまざまなコレクションにこのタスク シーケンスを展開するとします。 この場合は、コレクションのドメイン名ごとにコレクションごとのタスク シーケンス変数を指定し、そのタスク シーケンス変数を使用して、タスク シーケンスで適切なドメイン名を提供できます。  

###  <a name="a-namebkmktscreatevariablesa-create-task-sequence-variables"></a><a name="BKMK_TSCreateVariables"></a> タスク シーケンス変数の作成  
 新しいタスク シーケンス変数を追加して、タスク シーケンス ステップのカスタマイズおよび制御を行うことができます。 たとえば、タスク シーケンス変数を作成し、組み込みタスク シーケンス ステップの設定を上書きすることができます。 また、カスタム タスク シーケンス変数を作成し、タスク シーケンスの条件、コマンド ライン、またはカスタム ステップで使用することもできます。 タスク シーケンス変数を作成すると、そのシーケンスによって展開先コンピューターが再起動されても、タスク シーケンス変数および関連する値が、タスク シーケンス環境内に維持されます。 変数およびその値は、さまざまなオペレーティング システム環境のタスク シーケンス内で使用できます。 たとえば、完全な Windows オペレーティング システムや Windows PE 環境で使用できます。  

 次の表では、タスク シーケンス変数の作成方法と詳細な使用方法について説明します。  

|作成方法|使用方法|  
|-------------------|-----------|  
|タスク シーケンス エディターを使用してタスク シーケンス ステップのフィールドを設定|タスク シーケンス ステップの既定値を指定します。 変数および値は、タスク シーケンスでステップを実行するときだけアクセス可能になります。 変数および値はシーケンス環境全体に属しておらず、タスク シーケンスのその他のタスク シーケンス ステップではこの変数と値にアクセスできません。<br /><br /> 組み込み変数と関連付けられたアクションの一覧については、「[タスク シーケンス アクション変数](../understand/task-sequence-action-variables.md)」を参照してください。|  
|タスク シーケンスにタスク シーケンス変数の設定ステップを追加|タスク シーケンス ステップをタスク シーケンスの一部として実行するとき、タスク シーケンス環境でタスク シーケンス変数と値を指定します。 その後のすべてのタスク シーケンス ステップが、環境変数とその値にアクセスできます。|  
|コレクションごとの変数を定義|コンピューターのコレクションに、タスク シーケンス変数と値を指定します。 コレクションを対象とするすべてのタスク シーケンスは、このタスク シーケンス変数とその値にアクセスできます。|  
|コンピューターごとの変数を定義|特定のコンピューターのタスク シーケンス変数および値を指定します。 そのコンピューターを対象とするすべてのタスク シーケンスが、このタスク シーケンス変数とその値にアクセスできます。|  
|タスク シーケンス メディア ウィザードの **[カスタマイズ]** ページでタスク シーケンス変数を追加|タスク シーケンス変数とその値にアクセス可能なメディアから実行するタスク シーケンスの変数と値を指定します。|  

 組み込みタスク シーケンス変数の既定値を上書きするには、組み込みタスク シーケンス変数と同じ名前のタスク シーケンス変数を定義する必要があります。 組み込みタスク シーケンス変数の一覧、およびその関連操作と使用法については、「[タスク シーケンス組み込み変数](../understand/task-sequence-built-in-variables.md)」を参照してください。  

 タスク シーケンス変数の作成と同じ方法により、タスク シーケンス環境からタスク シーケンス変数を削除できます。 この場合、タスク シーケンス環境から変数を削除するには、タスク シーケンス変数値を空の文字列に設定します。  

 この方法を組み合わせて、同じシーケンスでタスク シーケンス環境変数をさまざまな値に設定できます。 さらに上級向けのシナリオでは、タスク シーケンス エディターを使用してシーケンス ステップに既定値を設定してから、さまざまな作成方法を使用してカスタム変数値を設定できます。 次に、複数の方法でタスク シーケンス変数が作成された場合に、どの値が使用されるかを決定する規則について説明します。  

1.  **[タスク シーケンス変数の設定]** ステップでは、その他すべての作成方法を上書きします。  

2.  コンピューターごとの変数は、コレクションごとの変数より優先されます。 コンピューターごとの変数およびコレクションごとの変数に同じタスク シーケンス変数名を指定すると、展開されたタスク シーケンスを展開先コンピューターが実行する際に、コンピューターごとの変数値が使用されます。  

3.  タスク シーケンスは、メディアから実行できます。 コレクションごとの変数またはコンピューターごとの変数の代わりに、メディア変数を使用してください。 タスク シーケンスをメディアから実行している場合、コンピューターごとの変数およびコレクションごとの変数は適用されず、使用されません。 その代わりに、タスク シーケンス メディア ウィザードの **[カスタマイズ]** ページで定義したタスク シーケンス変数が使用され、メディアから実行しているタスク シーケンスに固有の値が設定されます。  

4.  タスク シーケンス変数値をシーケンス環境全体で設定しない場合、組み込みアクションでは、タスク シーケンス エディターで設定されたステップの既定値が使用されます。  

 組み込みタスク シーケンス ステップの設定の値を上書きできるだけでなく、新しい環境変数を作成して、タスク シーケンス ステップ、スクリプト、コマンド ライン、または条件で使用することもできます。 新しいタスク シーケンス変数の名前を指定する際、次のガイドラインに従います。  

-   指定するタスク シーケンス変数名には、文字、数字、下線 (_)、およびハイフン (-) を含めることができます。  

-   タスク シーケンス変数名の最低の長さは 1 文字、最大の長さは 256 文字です。  

-   ユーザー定義変数は英字 (A ～ Z または a ～ z) で始まる必要があります。  

-   ユーザー定義変数名を下線で始めることはできません。 読み取り専用タスク シーケンス変数のみ、下線で始めることができます。  

    > [!NOTE]  
    >  読み取り専用タスク シーケンス変数は、タスク シーケンスのタスク シーケンス ステップで読み取ることができますが、設定することはできません。 たとえば、**[コマンド ラインの実行]** タスク シーケンス アクション変数のコマンド ラインの一部として読み取り専用タスク シーケンス変数を使用できますが、**[タスク シーケンス変数の設定]** アクション変数を使用して読み取り専用変数を設定することはできません。  

-   タスク シーケンス変数名では大文字と小文字が区別されません。 たとえば、OSDVAR と osdvar は同一タスク シーケンス変数を表します。  

-   タスク シーケンス変数名をスペースで始めたり終わらせたりすることはできず、変数名にスペースを埋め込むこともできません。 タスク シーケンス変数名の先頭または末尾のスペースは無視されます。  

 有効/無効なユーザー指定タスク シーケンス変数の例を、次の表に示します。  

|有効なユーザー指定変数名の例|無効なユーザー指定変数名の例|  
|-------------------------------------------------------|----------------------------------------------------------|  
|MyVariable|1Variable<br /><br /> ユーザー指定タスク シーケンス変数を数字で始めることはできません。|  
|My_Variable|MyV@riable<br /><br /> ユーザー指定タスク シーケンス変数に @ 記号を含めることはできません。|  
|My_Variable_2|_MyVariable<br /><br /> ユーザー指定タスク シーケンス変数を下線で始めることはできません。|  

 タスク シーケンス変数の一般的な制限事項:  

-   タスク シーケンス変数の値は、4,000 文字を超えることはできません。  

-   読み取り専用タスク シーケンス変数を作成したり上書きしたりすることはできません。 読み取り専用変数の名前は、下線 (_) で始まります。 読み取り専用タスク シーケンス変数の値にはタスク シーケンス内でアクセスできますが、関連する値を変更することはできません。  

-   タスク シーケンス変数の値は、値の使用方法に応じて、大文字と小文字が区別されることがあります。 ほとんどの場合、タスク シーケンス変数の値では、大文字と小文字が区別されません。 ただし、パスワードを含む変数など、一部の値では、大文字と小文字が区別されることがあります。  

-   作成できるタスク シーケンス変数の数に制限はありません。 ただし、タスク シーケンス環境のサイズによって制限されます。 タスク シーケンス環境の合計サイズの制限は、32 MB です。  

###  <a name="a-namebkmktsenvironmentvariablesa-access-environment-variables"></a><a name="BKMK_TSEnvironmentVariables"></a> 環境変数へのアクセス  
 前のセクションの方法のいずれかによってタスク シーケンス変数とその値を指定したら、タスク シーケンス内で環境変数の値を使用できます。 組み込みタスク シーケンス変数の既定値にアクセスしたり、組み込み変数に新しい値を指定したり、コマンド ラインまたはスクリプトでカスタム タスク シーケンス変数を使用したりすることができます。  

 次の表では、タスク シーケンス環境変数にアクセスして実行できるタスク シーケンス操作について概説します。  

|タスク シーケンス操作|使用方法|  
|-----------------------------|-----------|  
|アクションを構成|シーケンスの実行時に、タスク シーケンス ステップを変数値によって設定するように指定できます。<br /><br /> タスク シーケンス ステップの設定をタスク シーケンス環境変数で指定するには、タスク シーケンス エディターを使用してステップを編集し、フィールド値として変数名を指定します。 変数名はパーセント記号 (%) で囲み、環境変数であることを示す必要があります。|  
|コマンド ライン引数を指定|環境変数の値を使用して、カスタム コマンド ラインの一部またはすべてを指定できます。<br /><br /> 環境変数を使用してコマンドライン設定を指定するには、**[コマンド ラインの実行]** タスク シーケンス ステップの **[コマンド ライン]** フィールドの一部として変数名を使用します。 変数名は、パーセント記号 (%) で囲む必要があります。<br /><br /> たとえば、次のコマンド ラインでは、組み込み環境変数を使用して、コンピューター名を C:\File.txt. に書き込んでいます。<br /><br /> <br /><br /> **Cmd /C %_SMSTSMachineName% > C:\File.txt**|  
|ステップの条件を評価|組み込みタスク シーケンス環境変数またはカスタム タスク シーケンス環境変数を、タスク シーケンス ステップまたはグループの条件の一部として使用できます。 環境変数値は、タスク シーケンス ステップまたはグループが実行される前に評価されます。<br /><br /> 変数値を評価する条件を追加するには、次を実行します。<br /><br /> 1.条件を追加するステップまたはグループを選択します。<br />2.ステップまたはグループの **[オプション]** タブで、**[条件の追加]** ドロップダウンから **[タスク シーケンス変数]** を選択します。<br />3.**[タスク シーケンス変数]** ダイアログ ボックスで、変数名、テストする条件、および変数値を指定します。|  
|カスタム スクリプトの情報を指定|タスク シーケンス変数は、タスク シーケンスの実行中に、Microsoft.SMS.TSEnvironment COM オブジェクトを使用して読み書きできます。<br /><br /> 次の例は、**_SMSTSLogPath** タスク シーケンス変数を照会して現在のログの場所を取得する Visual Basic スクリプト ファイルを示しています。 このスクリプトではカスタム変数も設定されます。<br /><br /> <br /><br /> **dim osd: set env = CreateObject("Microsoft.SMS.TSEnvironment")**<br /><br /> <br /><br /> **dim logPath**<br /><br /> <br /><br /> **' 環境を調べるクエリを実行して、既存の変数を取得できます。**<br /><br /> **logPath = env("_SMSTSLogPath")**<br /><br /> <br /><br /> **' 変数を OSD 環境で設定することもできます。**<br /><br /> **env("MyCustomVariable") = "varname"**<br /><br /> <br /><br /> タスク シーケンス変数をスクリプトで使用する方法については、SDK のマニュアルを参照してください。|  

###  <a name="a-namebkmkcomputercollectionvariablesa-computer-and-collection-variables"></a><a name="BKMK_ComputerCollectionVariables"></a> コンピューター変数およびコレクション変数  
 タスク シーケンスは、複数のコンピューターまたはコレクションで同時に実行するように構成できます。 一意のオペレーティング システム製品キーを指定したり、コレクションのすべてのメンバーを指定ドメインに参加させたりというように、コンピューターごとまたはコレクションごとの一意の情報を指定できます。  

 タスク シーケンス変数は、単一のコンピューターまたはコレクションに割り当てることができます。 タスク シーケンスの実行が対象のコンピューターまたはコレクションで始まると、指定した値が対象のコンピューターまたはコレクションに適用されます。  

 タスク シーケンス変数は、単一のコンピューターまたはコレクションに指定できます。 タスク シーケンスの実行が対象のコンピューターまたはコレクションで始まると、指定した変数が環境に追加され、値はタスク シーケンスのすべてのタスク シーケンスのステップで使用できるようになります。  

> [!WARNING]  
>  コレクションごとの変数およびコンピューターごとの変数の両方に同一変数名を使用すると、コンピューター変数の値がコレクション変数より優先されます。 コレクションに割り当てられるタスク シーケンス変数は、組み込みタスク シーケンス変数に優先します。  

 コンピューターとコレクションのタスク シーケンス変数の作成方法の詳細については、「[コンピューターおよびコレクションのタスク シーケンスの変数の作成](../deploy-use/manage-task-sequences-to-automate-tasks.md#BKMK_CreateTSVariables)」を参照してください。  

###  <a name="a-namebkmktsmediavariablesa-task-sequence-media-variables"></a><a name="BKMK_TSMediaVariables"></a> タスク シーケンス メディア変数  
 メディアから実行されるタスク シーケンスのタスク シーケンス変数を指定できます。 メディアを使用してオペレーティング システムを展開する場合、メディアの作成時にタスク シーケンス変数を追加して値を指定します。変数と値はメディアに保存されます。  

> [!NOTE]  
>  タスク シーケンスは、スタンドアロン メディアに保存されます。 ただし、事前設定メディアなどのその他のすべての種類のメディアは、管理ポイントからタスク シーケンスを取得します。  

 タスク シーケンス メディア ウィザードの **[カスタマイズ]** ページで、タスク シーケンス変数を指定できます。 メディアの作成方法については、「[タスク シーケンス メディアの作成](../deploy-use/create-task-sequence-media.md)」を参照してください。  

> [!TIP]  
>  タスク シーケンスによって、パッケージ ID と起動前コマンドライン (タスク シーケンスの変数の値を含む) が、Configuration Manager コンソールを実行しているコンピューターの CreateTSMedia.log というログ ファイルに書き込まれます。 このログ ファイルで、タスク シーケンスの変数の値を確認できます。  

##  <a name="a-namebkmktscreatea-create-a--task-sequence"></a><a name="BKMK_TSCreate"></a> タスク シーケンスの作成  
 タスク シーケンスの作成ウィザードを使用して、タスク シーケンスを作成します。 ウィザードでは、特定のタスクを実行する組み込みタスク シーケンスまたはさまざまな異なるタスクを実行できるカスタム タスク シーケンスを作成できます。  

 たとえば、参照コンピューターからオペレーティング システム イメージを構築してキャプチャするタスク シーケンス、既存のオペレーティング システム イメージを展開先コンピューターにインストールするタスク シーケンス、またはカスタム タスクを実行するカスタム タスク シーケンスを作成できます。 カスタム タスク シーケンスを使用すると、特殊なオペレーティング システムの展開を実行できます。  

 タスク シーケンスの作成方法の詳細については、「[タスク シーケンスの作成](../deploy-use/manage-task-sequences-to-automate-tasks.md#BKMK_CreateTaskSequence)」を参照してください。  

##  <a name="a-namebkmktsedita-edit-a-task-sequence"></a><a name="BKMK_TSEdit"></a> タスク シーケンスの編集  
 **[タスク シーケンス エディター]** を使用してタスク シーケンスを編集します。 エディターでは、タスク シーケンスに対して次のような変更を行えます。  

-   タスク シーケンスのステップを追加または削除できます。  

-   タスク シーケンスのステップの順序を変更できます。  

-   ステップのグループを追加または削除できます。  

-   エラーが発生した場合にタスク シーケンスを続行するかどうかを指定できます。  

-   タスク シーケンスのステップとグループに条件を追加できます。  

> [!IMPORTANT]  
>  編集した結果、タスク シーケンスにパッケージまたはプログラムへの関連付けられていない参照があった場合は、参照を修正するか、参照されていないプログラムをタスク シーケンスから削除するか、または失敗したタスク シーケンス ステップを、壊れている参照が修正または削除されるまで一時的に無効にします。  

 タスク シーケンスの編集方法について詳しくは、「[タスク シーケンスの編集](../deploy-use/manage-task-sequences-to-automate-tasks.md#BKMK_ModifyTaskSequence)」を参照してください。  

##  <a name="a-namebkmktsdeploya-deploy-a-task-sequence"></a><a name="BKMK_TSDeploy"></a> タスク シーケンスの展開  
 任意の Configuration Manager コレクションにある展開先コンピューターに対してタスク シーケンスを展開できます。 これには、オペレーティング システムを不明なコンピューターに展開するために使用される **[すべての不明なコンピューター]** コレクションが含まれます。 ただし、タスク シーケンスをユーザー コレクションに展開することはできません。  

> [!IMPORTANT]  
>  オペレーティング システムをインストールするタスク シーケンスを不適切なコレクション ( **[すべてのシステム]** コレクションなど) に展開しないでください。 タスク シーケンスを展開するコレクションには、オペレーティング システムをインストールするコンピューターのみが含まれていることを確認してください。 不要なオペレーティング システムの展開を防ぐため、展開の設定を管理できます。 詳細については、「[危険度の高い展開を管理するための設定](../../protect/understand/settings-to-manage-high-risk-deployments.md)」を参照してください。  

 タスク シーケンスを受信する各展開先コンピューターは、展開で指定された設定に従ってタスク シーケンスを実行します。 タスク シーケンスには、関連するファイルやプログラムは含まれません。 タスク シーケンスによって参照されるすべてのファイルは、展開先コンピューターか、クライアントがアクセスできる配布ポイントに既に存在している必要があります。 また、プログラムまたはパッケージが既に展開先コンピューターにインストールされている場合でも、タスク シーケンスはプログラムによって参照されるパッケージをインストールします。  

> [!NOTE]  
>  パッケージやプログラムと比較して、タスク シーケンスでアプリケーションをインストールする場合、アプリケーションの要件規則が満たされ、アプリケーションがまだインストールされていない場合にのみ、アプリケーションに指定された探索方法に基づいてアプリケーションがインストールされます。  

 Configuration Manager クライアントは、クライアント ポリシーのダウンロード時にタスク シーケンスの展開を実行します。 次のポーリング サイクルまで待機せずにこのアクションを開始する場合は、「[Configuration Manager クライアントのポリシーの取得開始](../../core/clients/manage/manage-clients.md#BKMK_PolicyRetrieval)」を参照してください。  

 書き込みフィルターを有効にした Windows Embedded デバイスにタスク シーケンスを展開する場合、展開中はデバイスで書き込みフィルターを無効にし、展開後にデバイスを再起動するかどうかを指定できます。 書き込みフィルターが無効な場合、タスク シーケンスは一時オーバーレイに展開され、デバイスを再起動すると使用できなくなります。  

> [!NOTE]  
>  タスク シーケンスを Windows Embedded デバイスに展開する場合、デバイスが、メンテナンス期間が構成されたコレクションのメンバーであることを確認します。 これによって、書き込みフィルターを無効または有効にするタイミングや、デバイスを再起動するタイミングを管理できます。  
>   
>  メンテナンス期間以外でクライアントがタスク シーケンスをダウンロードする場合、タスク シーケンスは 2 度ダウンロードされます。 このシナリオでは、クライアントはタスク シーケンスをダウンロードし、書き込みフィルターを無効にし、コンピューターを再起動してから、タスク シーケンスをもう一度ダウンロードします。これは、タスク シーケンスが一時オーバーレイにダウンロードされ、デバイスの再起動時にクリアされるためです。  

 タスク シーケンスの展開方法の詳細については、「[タスク シーケンスの展開](../deploy-use/manage-task-sequences-to-automate-tasks.md#BKMK_DeployTS)」を参照してください。  

##  <a name="a-namebkmktsexportimporta-export-and-import-a-task-sequences"></a><a name="BKMK_TSExportImport"></a> タスク シーケンスのエクスポートおよびインポート  
 Configuration Manager ではタスク シーケンスをエクスポートおよびインポートできます。 タスク シーケンスをエクスポートする場合、タスク シーケンスで参照されるオブジェクトを含めることができます。 含めることができるオブジェクトは、オペレーティング システム イメージ、ブート イメージ、クライアント エージェント パッケージ、ドライバー パッケージ、依存関係があるアプリケーションなどです。  

> [!NOTE]  
>  タスク シーケンスのエクスポートとインポートの処理は Configuration Manager のアプリケーションのエクスポートとインポートの処理とほぼ同じです。  

 タスク シーケンスをエクスポートおよびインポートする方法については、「[タスク シーケンスのエクスポートおよびインポート](../deploy-use/manage-task-sequences-to-automate-tasks.md#BKMK_ExportImport)」を参照してください。  

##  <a name="a-namebkmktsruna-run-a-task-sequence"></a><a name="BKMK_TSRun"></a> タスク シーケンスの実行  
 既定では、タスク シーケンスは常にローカル システム アカウントを使用して実行されます。 タスク シーケンスのコマンドライン ステップでは、別のアカウントとしてタスク シーケンスを実行できます。 タスク シーケンスを実行するときに、Configuration Manager クライアントはタスク シーケンスのステップを開始する前に、参照されているパッケージを最初に確認します。 参照されているパッケージが検証されていない場合や配布ポイントで使用できない場合、タスク シーケンスは関連付けられているタスク シーケンスのステップについてエラーを返します。  

 配布されたタスク シーケンスがダウンロードと実行を行うように構成されている場合、すべての依存パッケージとアプリケーションが Configuration Manager クライアント キャッシュにダウンロードされます。 必要なパッケージとアプリケーションは配布ポイントから取得されます。Configuration Manager クライアント キャッシュ サイズが小さすぎる場合や、パッケージまたはアプリケーションが見つからなかった場合、タスク シーケンスは失敗し、ステータス メッセージが生成されます。 **[実行中のタスク シーケンスでコンテンツが必要になったときにローカルにダウンロードする]**を選ぶと、必要になったときにのみクライアントでコンテンツをダウンロードするように指定できます。または、 **[配布ポイントからプログラムを実行する]** オプションを使用して、クライアントで最初にキャッシュにファイルをダウンロードせずに、配布ポイントから直接ファイルをインストールするように指定できます。 **[配布ポイントからプログラムを実行する]** オプションは、参照されているパッケージで、**[パッケージ]** プロパティの **[データ アクセス]** タブの **[このパッケージのコンテンツを配布ポイントのパッケージ共有にコピーする]** 設定が有効にされている場合にのみ使用できます。  

 タスク シーケンスを実行しているクライアントが依存パッケージまたは依存アプリケーションを見つけることができず、展開が **[利用可能]** として構成されている場合、クライアントは直ちにエラーを送信します。 ただし、展開が **[必須]** として構成されているときに、クライアントがアクセスできる配布ポイントにコンテンツがレプリケートされていない場合、Configuration Manager クライアントは待機して、期限までコンテンツのダウンロードを再試行します。  

 タスク シーケンスが正常に完了または失敗した場合、Configuration Manager はこの記録を Configuration Manager のクライアント履歴に追加します。 タスク シーケンスがコンピューターで開始された後で、キャンセルまたは停止することはできません。  

> [!IMPORTANT]  
>  タスク シーケンスのステップでクライアント コンピューターを再起動する必要がある場合、クライアントはフォーマット済みのディスク パーティションに起動できる必要があります。 そうしないと、タスク シーケンスに指定されているエラー処理に関係なく、タスク シーケンスは失敗します。  

 ソフトウェアの配布パッケージなど、タスク シーケンスの依存オブジェクトが新しいバージョンに更新されると、そのパッケージを参照するタスク シーケンスも自動的に更新され、展開された更新プログラムの数に関係なく、最新のバージョンを参照します。  

> [!NOTE]  
>  Configuration Manager クライアントでは、タスク シーケンスを実行する前に、すべてのタスク シーケンスで依存関係があるかどうかと、その依存関係を配布ポイントで使用できるかどうかを確認します。 タスク シーケンスが依存するオブジェクトが削除されていることがクライアントで検出された場合、クライアントはエラーを生成し、タスク シーケンスを実行しません。  

###  <a name="a-namebkmkrunprograma-run-a-program-before-the-task-sequence-is-run"></a><a name="BKMK_RunProgram"></a> タスク シーケンスの実行前にプログラムを実行する  
 タスク シーケンスの実行前に実行するプログラムを選択できます。 最初に実行するプログラムを指定するには、タスク シーケンスの **[プロパティ]** ダイアログ ボックスを開き、**[詳細設定]** タブを選択して次のオプションを設定します。  

> [!IMPORTANT]  
>  タスク シーケンスを実行する前にプログラムを実行するには、タスク シーケンスとプログラムのすべてのコンテンツをパッケージのパッケージ共有で使用できるようにする必要があります。 パッケージのプロパティの **[データ アクセス]** タブでパッケージ共有を構成します。  

-   **別のプログラムを最初に実行する**: タスク シーケンスの実行前に実行する別のプログラムを指定します。  

    > [!IMPORTANT]  
    >  この設定は、完全なオペレーティング システムで実行されるタスク シーケンスにのみ適用されます タスク シーケンスが PXE またはブート メディアを使用して開始される場合、Configuration Manager ではこの設定が無視されます。  

-   **パッケージ**: プログラムが含まれているパッケージを指定します。  

-   **プログラム**: 実行するプログラムを指定します。  

-   **このプログラムを必ず最初に実行する**: 同じクライアントでタスク シーケンスを実行するたびに、Configuration Manager でこのプログラムを実行するように指定します。 既定では、プログラムが正常に実行された後、同じクライアントでタスク シーケンスが再実行されても、そのプログラムが再び実行されることはありません。  

 選択したプログラムをクライアントで実行するのに失敗した場合、タスク シーケンスは実行されません。  

##  <a name="a-namebkmktsmaintenancewindowa-use-a-maintenance-window-to-specify-when-a-task-sequence-can-run"></a><a name="BKMK_TSMaintenanceWindow"></a> メンテナンス期間を使用して、タスク シーケンスをいつ実行できるかを指定する  
 対象コンピューターを含むコレクションのメンテナンス期間を定義することで、タスク シーケンスが実行するタイミングを指定できます。 メンテナンス期間の開始日、開始時刻、終了時刻、および繰り返しパターンを構成します。 さらに、メンテナンス期間のスケジュールを設定するときに、メンテナンス期間がタスク シーケンスにのみ適用されることを指定できます。 詳細については、「[メンテナンス期間を使用する方法](../../core/clients/manage/collections/use-maintenance-windows.md)」を参照してください。  

> [!IMPORTANT]  
>  タスク シーケンスを実行するメンテナンス期間を構成した場合、タスク シーケンスが開始された後は、メンテナンス期間が終了してもタスク シーケンスは続行されます。 タスク シーケンスは正常に完了するか、失敗します。  

##  <a name="a-namebkmktsnetworkaccessaccounta-task-sequences-and-the-network-access-account"></a><a name="BKMK_TSNetworkAccessAccount"></a> タスク シーケンスとネットワーク アクセス アカウント  
 タスク シーケンスはローカル システム アカウントのコンテキストでのみ実行されます。次のような状況では、ネットワーク アクセス アカウントの構成が必要になることがあります。  

-   ネットワーク アクセス アカウントを正しく構成しないと、タスクを完了するために配布ポイントの Configuration Manager パッケージにアクセスしようとしたときにタスク シーケンスが失敗する場合。 ネットワーク アクセス アカウントの詳細については、「[ネットワーク アクセス アカウント](../../core/plan-design/hierarchy/manage-accounts-to-access-content.md#a-namebkmknaaa-network-access-account)」を参照してください。  

    > [!NOTE]  
    >  ネットワーク アクセス アカウントは、プログラムの実行、アプリケーションのインストール、更新プログラムのインストール、タスク シーケンスの実行のセキュリティ コンテキストとして使用されることはなく、ネットワーク上の関連付けられているリソースにアクセスするために使用されます。  

-   オペレーティング システムの展開の開始にブート イメージを使用している場合、Configuration Manager は、フルバージョンのオペレーティング システムではない Windows PE 環境を使用します。 Windows PE 環境では、自動的に生成されたランダムな名前が使用されます。この名前はどのドメインのメンバーでもありません。 ネットワーク アクセス アカウントが適切に構成されていない場合、タスク シーケンスの完了に必要な Configuration Manager パッケージにアクセスするためのアクセス許可がコンピューターにない可能性があります。  

##  <a name="a-namebkmktscreatemediaa-create-media-for-task-sequences"></a><a name="BKMK_TSCreateMedia"></a> タスク シーケンス用のメディアの作成  
 タスク シーケンスおよび関連するファイル、依存関係を複数の種類のメディアに書き込むことができます。 これには、キャプチャ メディア、スタンドアロン メディア、起動可能なメディアを DVD セット、CD セット、USB メモリなどのリムーバブル メディアに書き込む方法や、事前設定されたメディアを Windows Imaging Format (WIM) ファイルに書き込む方法などがあります。  

 次の種類のメディアを作成できます。  

-   **キャプチャ メディア**。 キャプチャ メディアは、Configuration Manager インフラストラクチャ外で構成および作成されたオペレーティング システム イメージをキャプチャします。 キャプチャ メディアには、タスク シーケンスの実行前に実行できるカスタム プログラムを収録できます。 カスタム プログラムを使用すると、デスクトップと通信したり、ユーザーに値の入力を要求したり、タスク シーケンスが使用する変数を作成したりできます。  

     詳細については、「[キャプチャ メディアを作成する](../deploy-use/create-capture-media.md)」を参照してください。  

-   **スタンドアロン メディア**: スタンドアロン メディアには、タスク シーケンスと、そのタスク シーケンスの実行に必要なすべての関連オブジェクトが含まれます。 スタンドアロン メディアのタスク シーケンスは、Configuration Manager からネットワークへの接続に制限があるか、ネットワーク接続できない場合に実行します。 スタンドアロン メディアは、次の方法で実行できます。  

    -   対象のコンピューターが起動されていない場合に、タスク シーケンスに関連付けられている Windows PE イメージをスタンドアロン メディアから使用して、タスク シーケンスを開始する。  

    -   ユーザーがネットワークにログオンしてインストールを開始する場合に、スタンドアロン メディアを手動で開始する。  

    > [!IMPORTANT]  
    >  スタンドアロン メディアのタスク シーケンスのステップは、ネットワークからデータを取得せずに実行できる必要があります。そうでない場合、データ取得を試行するタスク シーケンスのステップは失敗します。 たとえば、パッケージを取得するために配布ポイントが必要なタスク シーケンス ステップは失敗します。一方、必要なパッケージがスタンドアロン メディアに収録されている場合、タスク シーケンスのステップは正常に実行されます。  

     詳細については、「[スタンドアロン メディアの作成](../deploy-use/create-stand-alone-media.md)」を参照してください。  

-   **起動可能なメディア**。 起動可能なメディアには、対象のコンピューターの起動に必要なファイルが収録され、セットアップ先のコンピューターは Configuration Manager インフラストラクチャに接続し、実行するタスク シーケンスを、コレクションに対するメンバーシップに基づいて判断できます。 タスク シーケンスと依存オブジェクトはメディアには収録されておらず、Configuration Manager クライアントからネットワーク経由で取得されます。 この方法は、新しいコンピューターやベア メタルの展開、または対象のコンピューターに Configuration Manager クライアントまたはオペレーティング システムがない場合に便利です。  

     詳細については、「[起動可能なメディアの作成](../deploy-use/create-bootable-media.md)」を参照してください。  

-   **事前設定されたメディア**。 事前設定されたメディアは、事前準備されていない対象のコンピューターにオペレーティング システム イメージを展開します。 事前設定されたファイルは、Windows Imaging Format (WIM) ファイル形式で保存され、製造元によるベア メタル コンピューター、または Configuration Manager 環境に接続していない企業の準備センターにインストールすることができます。  

     詳細については、「[事前設定されたメディアの作成](../deploy-use/create-prestaged-media.md)」を参照してください。  

 メディアを作成する場合は、メディアに格納されているファイルへのアクセスを制御するために、メディアのパスワードを指定します。 パスワードを設定する場合は、タスク シーケンスを実行するときに、パスワードを入力するために対象コンピューターの近くにいる必要があります。  

 メディアを使用してタスク シーケンスを実行する場合、メディアに収録されている指定コンピューター チップ アーキテクチャは確認されず、指定されているアーキテクチャが対象のコンピューターに実装されているものと一致しなくても、タスク シーケンスの実行が試行されます。 メディアに収録されているチップ アーキテクチャが、対象のコンピューターに実装されているチップ アーキテクチャと一致しなかった場合、インストールは失敗します。  

 メディアを使用してオペレーティング システムを展開する方法の詳細については、「[タスク シーケンス メディアの作成](../deploy-use/create-task-sequence-media.md)」を参照してください。  



<!--HONumber=Dec16_HO3-->



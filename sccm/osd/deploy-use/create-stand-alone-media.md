---
title: スタンドアロン メディアの作成
titleSuffix: Configuration Manager
description: ネットワークに接続せずにコンピューターにオペレーティング システムを展開するには、スタンドアロン メディアを使用します。
ms.date: 02/09/2018
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: c6b9ccd2-78d9-4f0e-b25a-70d0866300ba
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: e2a9c4a1d2feba0c96dcbe3a2f7ee03c7c5a4555
ms.sourcegitcommit: 48098f9fb2f447672bf36d50c9f58a3d26acb9ed
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/14/2018
ms.locfileid: "53418698"
---
# <a name="create-stand-alone-media-with-system-center-configuration-manager"></a>System Center Configuration Manager を使用したスタンドアロン メディアを作成する

「オブジェクトの*適用対象: System Center Configuration Manager (Current Branch)*

Configuration Manager のスタンドアロン メディアには、ネットワークに接続せずにコンピューターにオペレーティング システム (OS) を展開するために必要なすべてが含まれています。 次の OS 展開シナリオでは、スタンドアロン メディアを使用します。  

-   [新しいバージョンの Windows で既存のコンピューターを更新する](refresh-an-existing-computer-with-a-new-version-of-windows.md)  

-   [新しいコンピューター (ベア メタル) に新しいバージョンの Windows をインストールする](install-new-windows-version-new-computer-bare-metal.md)  

-   [Windows を最新バージョンにアップグレードする](upgrade-windows-to-the-latest-version.md)  

スタンドアロン メディアには、OS、およびその他の必要なすべてのコンテンツをインストールするためのステップを自動化するタスク シーケンスが含まれています。 このコンテンツには、ブート イメージ、オペレーティング システム イメージ、およびデバイス ドライバーが含まれます。 スタンドアロン メディアには OS を展開するためのすべてが格納されるため、他の種類のメディアに必要なディスク領域よりも多くのディスク領域が必要になります。 中央管理サイトにスタンドアロン メディアを作成すると、クライアントは割り当てられたサイト コードを Active Directory から取得します。 子サイトで作成されたスタンドアロン メディアは、そのサイトのサイト コードをクライアントに自動的に割り当てます。  

##  <a name="BKMK_CreateStandAloneMedia"></a> スタンドアロン メディアの作成  
タスク シーケンス メディアの作成ウィザードを使用してスタンドアロン メディアを作成する前に、次の条件が満たされていることを確認します。  

### <a name="create-a-task-sequence-to-deploy-an-operating-system"></a>オペレーティング システムを展開するタスク シーケンスを作成する
スタンドアロン メディアの一部として、オペレーティング システムを展開するタスク シーケンスを指定する必要があります。 新しいタスク シーケンスを作成する手順については、「[System Center Configuration Manager のオペレーティング システムをインストールするタスク シーケンスを作成する](create-a-task-sequence-to-install-an-operating-system.md)」を参照してください。

スタンドアロン メディアでは、次の操作はサポートされていません。
- タスク シーケンスの **[ドライバーの自動適用]** ステップ。 スタンドアロン メディアでは、ドライバー カタログからのデバイス ドライバーの自動適用はサポートされません。 指定された一連のドライバーを Windows セットアップで使用できるようにするには、**[ドライバー パッケージの適用]** ステップを使用します。
- タスク シーケンスの **[パッケージ コンテンツのダウンロード]** ステップ。 スタンドアロン メディアでは管理ポイントの情報は使用できません。そのため、コンテンツの場所を列挙しようとするこのステップは失敗します。
- ソフトウェア更新プログラムのインストール
- オペレーティング システム展開前のソフトウェアのインストール
- オペレーティング システム以外の展開用タスク シーケンス
- ユーザーとデバイスのアフィニティをサポートする展開先のコンピューターとユーザーの関連付け
- 動的なパッケージは**パッケージのインストール** タスクを使用してインストールします。
- 動的なアプリケーションは**アプリケーションのインストール** タスクを使用してインストールします。

> [!NOTE]    
> タスク シーケンスに [[パッケージのインストール]](../../osd/understand/task-sequence-steps.md#BKMK_InstallPackage) ステップが含まれる場合に、中央管理サイトでスタンドアロン メディアを作成すると、エラーが発生する可能性があります。 中央管理サイトには、必要なクライアント構成ポリシーがありません。 これらのポリシーは、タスク シーケンスの実行中にソフトウェア配布エージェントを有効にするために必要になります。 CreateTsMedia.log ファイルに次のエラーが表示される場合があります。    
>     
> `WMI method SMS_TaskSequencePackage.GetClientConfigPolicies failed (0x80041001)`    
> 
> **[パッケージのインストール]** ステップを含むスタンドアロン メディアの場合は、ソフトウェア配布エージェントが有効になっているプライマリ サイトでスタンドアロン メディアを作成します。 
>
> または、タスク シーケンスの [[Windows と ConfigMgr のセットアップ]](../understand/task-sequence-steps.md#BKMK_SetupWindowsandConfigMgr) ステップの後で、かつ、最初の **[パッケージのインストール]** ステップの前に [[コマンド ラインの実行]](../understand/task-sequence-steps.md#BKMK_RunCommandLine) ステップを追加します。 **[コマンド ラインの実行]** ステップでは、最初の [パッケージのインストール] ステップの前に、以下の WMIC コマンドを実行してソフトウェア配布エージェントを有効にします。    
>    
> `WMIC /namespace:\\\root\ccm\policy\machine\requestedconfig path ccm_SoftwareDistributionClientConfig CREATE ComponentName="Enable SWDist", Enabled="true", LockSettings="TRUE", PolicySource="local", PolicyVersion="1.0", SiteSettingsKey="1" /NOINTERACTIVE`


> [!IMPORTANT]    
> スタンドアロン メディアに対しては、**[Windows と ConfigMgr のセットアップ]** タスク シーケンス ステップの **[使用可能な場合は、実稼働前クライアント パッケージを使用する]** 設定を選択しないでください。 スタンドアロン メディアでは、この設定の使用はサポートされていません。 この設定の詳細については、「[Windows と ConfigMgr のセットアップ](/sccm/osd/understand/task-sequence-steps#BKMK_SetupWindowsandConfigMgr)」を参照してください。


### <a name="distribute-all-content-associated-with-the-task-sequence"></a>タスク シーケンスに関連付けられているすべてのコンテンツを配布する
少なくとも 1 つの配布ポイントに対して、タスク シーケンスで必要なすべてのコンテンツを配布します。 このコンテンツには、ブート イメージ、オペレーティング システム イメージ、およびその他の関連するファイルが含まれます。 スタンドアロン メディアの作成時に、ウィザードによって配布ポイントから情報が収集されます。 配布ポイントのコンテンツ ライブラリへの **読み取り** アクセス権を持っている必要があります。 詳細については、「[タスク シーケンスによって参照されるコンテンツの配布](manage-task-sequences-to-automate-tasks.md#BKMK_DistributeTS)」を参照してください。

### <a name="prepare-the-removable-usb-drive"></a>リムーバブル USB ドライブを準備する
*リムーバブル USB ドライブの場合:*

リムーバブル USB ドライブを使用している場合は、ウィザードを実行しているコンピューターに USB ドライブを接続します。 USB ドライブは、リムーバブル デバイスとして Windows で検出できる必要があります。 メディアの作成時に、ウィザードによって USB ドライブに直接書き込まれます。 スタンドアロン メディアでは FAT32 ファイル システムが使用されています。 スタンドアロン メディアは、サイズが 4 GB を超えるコンテンツが入っている USB フラッシュ ドライブには作成できません。

### <a name="create-an-output-folder"></a>出力フォルダーを作成する
*CD/DVD セットの場合:*

タスク シーケンス メディアの作成ウィザードを実行して CD または DVD セット用のメディアを作成する前に、ウィザードで作成される出力ファイル用のフォルダーを作成する必要があります。 CD または DVD セット用に作成されるメディアは、そのフォルダーに .iso ファイルとして直接書き込まれます。


 リムーバブル USB ドライブまたは CD/DVD セット用のスタンドアロン メディアを作成するには、次の手順に従います。  

## <a name="to-create-stand-alone-media"></a>スタンドアロン メディアを作成するには  

1. Configuration Manager コンソールで、**[ソフトウェア ライブラリ]** をクリックします。  

2. **[ソフトウェア ライブラリ]** ワークスペースで **[オペレーティング システム]** を展開して、**[タスク シーケンス]** をクリックします。  

3. **[ホーム]** タブの **[作成]** グループで **[タスク シーケンス メディアの作成]** をクリックして、タスク シーケンス メディアの作成ウィザードを起動します。  

4. **[メディアの種類の選択]** ページで次のオプションを指定し、**[次へ]** をクリックします。  

   -   **[スタンドアロン メディア]** を選択します。  

   -   必要に応じて、ユーザーの入力なしにオペレーティング システムを展開できるようにするには、**[オペレーティング システムの無人展開を許可する]** を選択します。 このオプションを選択すると、ユーザーはネットワーク構成情報やオプションのタスク シーケンスについてプロンプトされません。 メディアでパスワード保護が構成されている場合、ユーザーは引き続きパスワードの入力を求められます。  

5. **[メディアの種類]** ページで、メディアがリムーバブル USB ドライブと CD/DVD セットのいずれであるかを指定します。  

   > [!IMPORTANT]  
   >  既定では、スタンドアロン メディアで FAT32 ファイル システムが使用されます。 スタンドアロン メディアは、サイズが 4 GB を超えるファイルがコンテンツとして含まれるリムーバブル USB ドライブには作成できません。  

   - **[リムーバブル USB ドライブ]** を選択した場合は、コンテンツを格納するドライブを指定します。  

     - **[リムーバブル USB ドライブをフォーマットし (FAT32)、起動可能にする]**:既定では、Configuration Manager によって USB ドライブが準備されます。 多くの新しい UEFI デバイスには起動可能な FAT32 パーティションが必要です。 ただし、このフォーマットではファイルのサイズとドライブの全体的な容量も制限されます。 リムーバブル ドライブを既にフォーマットして構成している場合は、このオプションを無効にします。 

   - **CD/DVD セット**を選択した場合は、メディアの容量および出力ファイルの名前とパスを指定します。 この場所に出力ファイルが書き込まれます。 例: **\\\servername\folder\outputfile.iso**  

      メディアにコンテンツ全体を保存しきれない場合は、複数のファイルが作成されます。この場合、複数の CD または DVD を使用してコンテンツを保存する必要があります。 複数のメディアが必要な場合は、Configuration Manager が作成する各出力ファイルの名前に連番が付けられます。 さらに、オペレーティング システムと共にアプリケーションを展開し、アプリケーションが 1 つのメディアに収まらない場合、Configuration Manager は複数のメディアでアプリケーションを保存します。 スタンドアロン メディアを実行している場合、Configuration Manager は、アプリケーションを保存する次のメディアの指定をユーザーに求めます。   

      > [!IMPORTANT]  
      >  既存の .iso イメージを選択した場合は、タスク シーケンス メディア ウィザードの次のページに進むと、ドライブまたは共有フォルダーからイメージが削除されます。 既存のイメージは、ウィザードをキャンセルしても削除されます。  

     **[次へ]** をクリックします。  

6. **[セキュリティ]** ページで、次のいずれかの設定を選び、**[次へ]** をクリックします。
   - **[メディアをパスワードで保護する]**: 強力なパスワードを入力してメディアを保護します。 パスワードを指定した場合は、メディアを使用する際にパスワードが必要になります。  

       > [!IMPORTANT]  
       >  スタンドアロン メディアでは、タスク シーケンス ステップとその変数のみが暗号化されます。 メディアの残りのコンテンツは暗号化されません。このため、機密情報をタスク シーケンスのスクリプトに含めないでください。 機密情報はすべて、タスク シーケンスの変数を使用して保存し、実装します。  

   - **このスタンドアロン メディアが有効な日付の範囲を選択する** (バージョン 1702 から):メディアに任意の開始日付/有効期限を設定します。 これらの設定は既定では無効になっています。 スタンドアロン メディアが実行される前に、この日付はコンピューター上のシステム時刻と比較されます。 システム時刻が開始時刻より前か、有効期限より後の場合、スタンドアロン メディアは開始されません。 これらのオプションは、New-CMStandaloneMedia PowerShell コマンドレットを使用して利用することもできます。
7. **[スタンドアロン CD/DVD]** ページで、オペレーティング システムを展開するタスク シーケンスを指定して **[次へ]** をクリックします。 アプリケーションの依存関係のスタンドアロン メディアにコンテンツを追加するには、**[関連するアプリケーションの依存関係を検出し、このメディアに追加する]** を選択します。
   > [!TIP]
   > 予想したアプリケーションの依存関係が表示されない場合は、**[関連するアプリケーションの依存関係を検出し、このメディアに追加する]** の設定の選択を解除してから再度選択し、一覧を更新します。

   ウィザードでは、ブート イメージに関連付けられたタスク シーケンスのみを選択できます。  

8. **[アプリケーションの選択]** ページ (バージョン 1702 以降) で、メディア ファイルの一部として含めるアプリケーション コンテンツを指定し、**[次へ]** をクリックします。
9. **[パッケージの選択]** ページ (バージョン 1702 以降) で、メディア ファイルの一部として含めるパッケージ コンテンツを指定し、**[次へ]** をクリックします。
10. **[ドライバー パッケージの選択]** ページ (バージョン 1702 以降) で、メディア ファイルの一部として含めるドライバー パッケージ コンテンツを指定し、**[次へ]** をクリックします。
11. **[配布ポイント]** ページで、必要なコンテンツを含む配布ポイントを指定して、**[次へ]** をクリックします。  

    Configuration Manager には、コンテンツが含まれる配布ポイントのみが表示されます。 続行する前に、タスク シーケンスに関連付けられているすべてのコンテンツを少なくとも 1 つの配布ポイントに配布します。 コンテンツを配布した後、配布ポイントの一覧を更新します。 このページで既に選択している配布ポイントをすべて削除し、前のページに移動して **[配布ポイント]** ページに戻ります。 または、ウィザードを再起動します。 詳細については、「[タスク シーケンスによって参照されるコンテンツの配布](manage-task-sequences-to-automate-tasks.md#BKMK_DistributeTS)」と「[コンテンツとコンテンツ インフラストラクチャの管理](../../core/servers/deploy/configure/manage-content-and-content-infrastructure.md)」を参照してください。  

    > [!NOTE]  
    >  配布ポイントのコンテンツ ライブラリへの **読み取り** アクセス権限を持っている必要があります。  

12. **[カスタマイズ]** ページで、次の情報を指定して **[次へ]** をクリックします。  

    -   オペレーティング システムを展開するためにタスク シーケンスで使用する変数を指定します。  

    -   タスク シーケンスの前に実行する起動前コマンドを指定します。 起動前コマンドは、タスク シーケンスの開始前に Windows PE で実行されるスクリプトまたは実行可能ファイルです。 詳細については、「[タスク シーケンス メディアの起動前コマンド](../understand/prestart-commands-for-task-sequence-media.md)」を参照してください。  

         必要に応じて、 **[起動前コマンドのファイル]** を選択して、起動前コマンドに必要なファイルを含めます。  

        > [!TIP]  
        >  タスク シーケンス メディアの作成中に、Configuration Manager はパッケージ ID と起動前コマンドラインを、Configuration Manager コンソールを実行しているコンピューターの **CreateTSMedia.log** ファイルに書き込みます。 この出力には、任意のタスク シーケンス変数の値が含まれています。 このログ ファイルで、タスク シーケンス変数の値を確認します。  

13. ウィザードを完了します。  

    スタンドアロンのメディア ファイル (.iso) は、対象フォルダーに作成されます。 **[スタンドアロン CD/DVD]** を選択すると、一連の CD または DVD に出力ファイルをコピーできるようになります。  

##  <a name="BKMK_StandAloneMediaTSExample"></a> スタンドアロン メディアのタスク シーケンス例  
 スタンドアロン メディアを使用してオペレーティング システムを展開するタスク シーケンスを作成する場合は、次の表をガイドとして使用してください。 この表は、タスク シーケンス ステップの一般的なシーケンスを決定するのに役立ちます。 また、タスク シーケンス ステップを論理グループに整理して構造化するのにも役立ちます。 実際に作成するタスク シーケンスは、この例とは異なり、タスク シーケンス ステップやグループの数が違う場合があります。  

> [!NOTE]  
>  スタンドアロン メディアを作成するには、タスク シーケンス メディア ウィザードを常に使用する必要があります。  

|タスク シーケンス グループまたはステップ|説明|  
|---------------------------------|-----------------|  
|ファイルと設定のキャプチャ **(新しいタスク シーケンス グループ)**|タスク シーケンス グループを作成します。 タスク シーケンス グループを使用すると、類似のタスク シーケンス ステップをまとめて、整理とエラー制御を向上させることができます。|  
|Windows 設定のキャプチャ|このタスク シーケンス ステップを使用して、再イメージ化の前に対象コンピューターから Windows 設定をキャプチャします。 コンピューター名、ユーザーと組織の情報、およびタイム ゾーン設定をキャプチャします。|  
|ネットワーク設定のキャプチャ|このタスク シーケンス ステップを使用して、タスク シーケンスを受信するコンピューターからネットワーク設定をキャプチャできます。 コンピューターのドメインまたはワークグループのメンバーシップ、およびネットワーク アダプター設定情報をキャプチャできます。|  
|ユーザー ファイルと設定のキャプチャ **(新しいタスク シーケンス サブグループ)**|タスク シーケンス グループ内にタスク シーケンス グループを作成します。 このサブグループには、再イメージ化の前に対象コンピューターからユーザー状態データをキャプチャするステップが含まれています。 追加した最初のグループと同様に、このサブグループは類似のタスク シーケンス ステップをまとめて、整理とエラー制御を向上させることができます。|  
|ローカルの状態の場所の設定|このタスク シーケンス ステップを使用して、保護されたパス タスク シーケンス変数によりローカルの場所を指定できます。 ユーザーの状態は、ハード ドライブの保護されたディレクトリに保存されます。|  
|ユーザー状態のキャプチャ|このタスク シーケンス ステップを使用して、新しいオペレーティング システムに移行するユーザー ファイルおよび設定をキャプチャできます。|  
|オペレーティング システムのインストール - **(新規タスク シーケンス グループ)**|別のタスク シーケンス サブグループを作成します。 このサブグループには、オペレーティング システムのインストールに必要なステップが含まれています。|  
|Windows PE またはハード ディスクでの再起動|このタスク シーケンス ステップを使用して、このタスク シーケンスを受信するコンピューターの再起動オプションを指定できます。 このステップでは、インストールを続行するためにコンピューターを再起動していることを示すメッセージがユーザーに表示されます。<br /><br /> このステップでは、読み取り専用の **_SMSTSInWinPE** タスク シーケンス変数が使用されます。 関連する値が **false** の場合に、タスク シーケンス ステップが続行されます。|  
|オペレーティング システムの適用|このタスク シーケンス ステップを使用して、オペレーティング システム イメージを対象のコンピューターにインストールできます。 このステップでは、Configuration Manager 固有のコントロール ファイルを除く、ボリューム上のすべてのファイルが削除されます。 その後、WIM ファイルに含まれるすべてのボリューム イメージが、対応する順次ディスク ボリュームに適用されます。 また、**sysprep** 応答ファイルを指定したり、インストールに使用するディスク パーティションを構成することもできます。|  
|Windows 設定の適用|このタスク シーケンス ステップを使用して、対象コンピューターの Windows 設定の構成情報を構成できます。 これらの設定には、ユーザーと組織の情報、製品またはライセンス キーの情報、タイム ゾーン、およびローカル管理者パスワードが含まれます。|  
|ネットワーク設定の適用|このタスク シーケンス ステップを使用して、対象コンピューターのネットワークまたはワークグループの構成情報を指定できます。 コンピューターが DHCP サーバーを使用するかどうか、または IP アドレス情報を静的に割り当てられるかどうかも指定できます。|  
|ドライバー パッケージの適用|このタスク シーケンス ステップを使用して、ドライバー パッケージ内のデバイス ドライバーをすべて Windows セットアップで使用できるようにします。 すべての必要なデバイス ドライバーをスタンドアロン メディアに含める必要があります。|  
|オペレーティング システムのセットアップ - **(新規タスク シーケンス グループ)**|別のタスク シーケンス サブグループを作成します。 このサブグループには、Configuration Manager クライアントのインストールに必要なステップが含まれています。|  
|Windows と ConfigMgr のセットアップ|このタスク シーケンス ステップを使用して Configuration Manager クライアント ソフトウェアをインストールします。 Configuration Manager は、Configuration Manager クライアントの GUID をインストールして登録します。 必要なインストール パラメーターは、 **[インストールのプロパティ]** ウィンドウで割り当てることができます。|  
|ユーザーファイルと設定の復元 - **(新規タスク シーケンス グループ)**|別のタスク シーケンス サブグループを作成します。 このサブグループには、ユーザー状態の復元に必要なステップが含まれています。|  
|ユーザー状態の復元|ユーザー状態移行ツール (USMT) を開始するには、このタスク シーケンス ステップを使用します。 USMT は、[ユーザー状態のキャプチャ] ステップでキャプチャ済みのユーザー状態と設定を対象のコンピューターに復元します。|  

---
title: "オペレーティング システムの展開用のサイト システムの役割を準備する | Microsoft Docs"
description: "System Center Configuration Manager でオペレーティング システムを展開する前に、サイト システムの役割を構成します。"
ms.custom: na
ms.date: 10/06/2016
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: configmgr-osd
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: 0ef5f3ce-b0e4-4775-b5c2-b245e45b4194
caps.latest.revision: "11"
caps.handback.revision: "0"
author: Dougeby
ms.author: dougeby
manager: angrobe
ms.openlocfilehash: 11c0f169afebdb071fefb5ce300fd1ae3481a94f
ms.sourcegitcommit: 51fc48fb023f1e8d995c6c4eacfda7dbec4d0b2f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2017
---
# <a name="prepare-site-system-roles-for-operating-system-deployments-with-system-center-configuration-manager"></a>System Center Configuration Manager でのオペレーティング システム展開のサイト システムの役割の準備

*適用対象: System Center Configuration Manager (Current Branch)*

System Center Configuration Manager でオペレーティング システムを展開するには、まず特定の構成と考慮が必要な次のサイト システムの役割を準備する必要があります。

##  <a name="BKMK_DistributionPoints"></a> 配布ポイント  
 配布ポイントのサイト システムの役割には、クライアントがダウンロードするソース ファイルが含まれます。このソース ファイルには、アプリケーションのコンテンツ、ソフトウェア更新プログラム、オペレーティング システム イメージ、ブート イメージなどがあります。 帯域幅、調整、およびスケジュールのオプションを使って、コンテンツの配布を制御できます。  

 コンピューターへのオペレーティング システムの展開をサポートできるだけの十分な配布ポイントを用意することが重要です。 さらに、階層内でこれらの配布ポイントをどのように配置するかについて計画を立てることも重要です。 この計画に関する情報の大部分は、「[コンテンツとコンテンツ インフラストラクチャの管理](../../core/servers/deploy/configure/manage-content-and-content-infrastructure.md)」にあります。 ただし、オペレーティング システムの展開に応じて、配布ポイントの計画時にはさらに考慮すべき事項があります。  

###  <a name="BKMK_AdditionalPlanning"></a> 配布ポイントの計画に関する追加の考慮事項  
 配布ポイントの計画時にさらに考慮すべき事項は次のとおりです。  

-   **不要なオペレーティング システムの展開を行わないようにする方法**  

     Configuration Manager は、サイト サーバーと、コレクション内の他の展開先のコンピューターを区別しません。 サイト サーバーが含まれているコレクションに、必要なタスク シーケンスを展開すると、そのサイト サーバーは、コレクション内の他のコンピューターと同じ方法でタスク シーケンスを実行します。 オペレーティング システムの展開では、展開を実行するクライアントを含むコレクションを必ず使用してください。  

     危険度の高いタスク シーケンスの展開については、その動作を管理することができます。 危険度の高い展開はクライアントに自動的にインストールされ、望ましくない結果が生じる可能性があります。 たとえば、オペレーティング システムを展開する "必須" の目的を持つタスク シーケンスなどがこれに該当します。 望ましくない危険度の高い展開のリスクを減らすためには、展開検証設定を構成します。 詳細については、「[危険度の高い展開を管理するための設定](../../protect/understand/settings-to-manage-high-risk-deployments.md)」を参照してください。  

-   **1 つの配布ポイントからオペレーティング システム イメージを一度に受信できるコンピューターの数**  

     必要な配布ポイントの数を見積もるときには、処理速度とディスク I/O、ネットワークの利用可能な帯域幅、およびイメージ パッケージのサイズがこれらのリソースに及ぼす影響について考慮してください。 たとえば、100 メガバイト (MB) のイーサネット ネットワークでは、他のサーバー リソース要因をまったく考慮しない場合、1 時間で 4 ギガバイト (GB) のイメージ パッケージを処理できるコンピューターの最大台数は 11 台になります。  

     `100 Megabits/sec = 12.5 Megabytes/sec = 750 Megabytes/min = 45 Gigabytes/hour = 11 images @ 4GB per image.`  

     一定の時間内に特定の台数のコンピューターにオペレーティング システムを展開する必要がある場合は、適切な数の配布ポイントにイメージを配布します。  

-   **配布ポイントにオペレーティング システムを展開できるかどうか**  

     オペレーティング システムを配布ポイントに展開することはできますが、オペレーティング システム イメージは別の配布ポイントから受信する必要があります。  

###  <a name="BKMK_PXEDistributionPoint"></a> PXE 要求を受け入れるための配布ポイントの構成  
 PXE ブート要求を作成する Configuration Manager クライアントにオペレーティング システムを展開するには、PXE 要求を受け入れるように 1 つ以上の配布ポイントを構成する必要があります。 構成された配布ポイントは、PXE ブート要求に応答し、実行する適切な展開アクションを決定します。

> [!IMPORTANT]  
>  すべての PXE 対応配布ポイントに[Windows Deployment Services](../plan-design/infrastructure-requirements-for-operating-system-deployment.md#BKMK_WDS) をインストールする必要があります。  

 既存の配布ポイントが PXE 要求を受け入れるように変更するには、以下の手順に従います。 新しい配布ポイントのインストール方法の詳細については、「 [Install or modify a distribution point](../../core/servers/deploy/configure/install-and-configure-distribution-points.md)」を参照してください。  

#### <a name="to-modify-an-existing-distribution-point-to-accept-pxe-requests"></a>既存の配布ポイントが PXE 要求を受け入れるように変更するには  

1.  Configuration Manager コンソールにおいて、**[管理]** をクリックし、**[概要]** を展開して、**[配布ポイント]** をクリックします。  

2.  構成する配布ポイントを選択してから、 **[ホーム]** タブの **[プロパティ]** グループで、 **[プロパティ]**をクリックします。  

3.  配布ポイントの [プロパティ] ページで、[PXE] タブをクリックします。 **** **[クライアントの PXE サポートを有効にする]** を選択して、この配布ポイントの PXE を有効にします。  

4.  [スケジュールされたマルチキャストを有効にする] をクリックし、次のオプションを選択します。 **[PXE の必須ポートの確認]** ダイアログ ボックスで **[はい]** をクリックし、PXE を有効にすることを確認します。 Configuration Manager は、Windows ファイアウォールに自動的に既定のポートを構成します。 別のファイアウォールを使用する場合は、手動でポートを構成する必要があります。  

    > [!NOTE]  
    >  WDS と DHCP が同じサーバー上にインストールされている場合は、別のポートでリッスンするように WDS を構成する必要があります (DHCP が同じポートをリッスンするため)。 詳細については、「[同じサーバー上に WDS と DHCP がある場合の考慮事項](../plan-design/infrastructure-requirements-for-operating-system-deployment.md#BKMK_WDSandDHCP)を参照してください。  

5.  **[この配布ポイントが受信 PXE 要求に応答できるようにする]** を選択して、WDS が受信 PXE サービス要求に応答できるようにします。 この設定を使用して、配布ポイントから PXE 機能を削除せずにサービスを有効/無効にすることができます。  

6.  **[不明なコンピューターのサポートを有効にする]** を選択して、Configuration Manager で管理されていないコンピューターにオペレーティング システムを展開します。  

7.  **[コンピューターで PXE を使用する場合にパスワードを要求する]**を選択して、強力なパスワードを指定して PXE 展開のセキュリティを強化します。  

8.  In the **[ユーザーとデバイスのアフィニティ]** 一覧から、配布ポイントで PXE 展開先のコンピューターとユーザーをどのように関連付けるかを選択します。  

    -   ユーザーと展開先のコンピューターを関連付けない場合は、 **[ユーザーとデバイスのアフィニティを使用しない]** を選択します。  

    -   [ユーザーとデバイスのアフィニティを手動で承認する] を選択すると、ユーザーが対象コンピューターと関連付けられる前に、管理者の承認が必要になります。 ****  

    -   [ユーザーとデバイスのアフィニティを自動的に承認する] を選択すると、許可を待たずにユーザーと対象コンピューターが自動的に関連付けられます。 ****  

     詳細については、「[System Center Configuration Manager でユーザーをセットアップ先のコンピューターに関連付ける](../get-started/associate-users-with-a-destination-computer.md)」を参照してください。  

9. 配布ポイントがすべてのネットワーク インターフェイスまたは特定のネットワーク インターフェイスからの PXE 要求に応答することを指定します。 配布ポイントを特定のネットワーク インターフェイスに応答させる場合は、各ネットワーク インターフェイスの MAC アドレスを指定します。  

10. PXE 対応配布ポイントが複数ある場合に、コンピューターの要求に応答するまでに、この配布ポイントが何秒間待機する必要があるのかを指定します。  

11. [OK] をクリックし、配布ポイントのプロパティを更新します。 ****  

###  <a name="BKMK_RamDiskTFTP"></a> PXE 対応配布ポイント上の RamDisk TFTP ブロック サイズとウィンドウ サイズのカスタマイズ  
Configuration Manager バージョン 1606 では、PXE 対応配布ポイントの RamDisk TFTP ブロック サイズとウィンドウ サイズをカスタマイズできます。 ネットワークをカスタマイズしている場合、ブロックまたはウィンドウのサイズが大きすぎるために、ブート イメージのダウンロードがタイムアウト エラーで失敗する可能性があります。 RamDisk TFTP ブロック サイズとウィンドウ サイズのカスタマイズにより、特定のネットワーク要件に対応する PXE を使用する場合に、TFTP トラフィックを最適化できます。   
最も効率的な内容を確認するために、環境内でカスタマイズした設定をテストする必要があります。  

-   **TFTP ブロック サイズ**: ブロック サイズは、ファイルをダウンロードしているクライアントにサーバーによって送信されるデータ パケットのサイズです (RFC 2347 に記載)。 ブロック サイズを大きくすると、サーバーとクライアントの間のラウンド トリップ遅延が少なくなるように、サーバーが送信するパケットを少なくすることができます。 ただし、大きいサイズのブロックにより、ほとんどの PXE クライアントの実装がサポートしていない、断片化されたパケットが生成されます。  

-   **TFTP ウィンドウ サイズ**: TFTP では、送信されるデータの各ブロックの確認 (ACK) パケットが必要です。 前のブロックの ACK パケットを受信するまで、サーバーは、シーケンス内の次のブロックを送信しません。 TFTP ウィンドウは、ウィンドウがいっぱいになるまでのデータ ブロックの数を定義できる、Windows 展開サービスの機能です。 サーバーは、ウィンドウがいっぱいになるまでデータ ブロックを連続で送信し、その後クライアントが ACK パケットを送信します。 このウィンドウのサイズを増やすことで、クライアントとサーバーの間のラウンド トリップ遅延回数が減少し、ブート イメージをダウンロードするために必要な全体の時間が短縮します。  


#### <a name="to-modify-the-ramdisk-tftp-window-size"></a>RamDisk TFTP ウィンドウ サイズを変更するには  

-   RamDisk TFTP ウィンドウ サイズをカスタマイズするには、PXE 対応配布ポイント上に次のレジストリ キーを追加します。  

     **場所**: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SMS\DP  
    名前: RamDiskTFTPWindowSize  

     **型**: REG_DWORD  

     **値**: &lt;カスタマイズされたウィンドウのサイズ>  

 既定値は 1 (1 つのデータ ブロックでウィンドウがいっぱいになります)  

#### <a name="to-modify-the-ramdisk-tftp-block-size"></a>RamDisk TFTP ブロック サイズを変更するには  

-   RamDisk TFTP ウィンドウ サイズをカスタマイズするには、PXE 対応配布ポイント上に次のレジストリ キーを追加します。  

     **場所**: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SMS\DP  
    名前: RamDiskTFTPBlockSize  

     **型**: REG_DWORD  

     **値**: &lt;カスタマイズされたブロック サイズ>  

 既定値は 4096 (4k) です。  


###  <a name="BKMK_DPMulticast"></a> マルチキャストをサポートする配布ポイントの構成  
 マルチキャストは、複数のクライアントが同じオペレーティング システム イメージを同時にダウンロードすることが多い配布ポイントで使用できるネットワーク最適化の方法です。 マルチキャストを使用すると、配布ポイントがデータのコピーを各々のクライアントに別々の接続で送信する代わりに、マルチキャストするため、複数のコンピューターが同時にオペレーティング システム イメージをダウンロードできます。 マルチキャストをサポートするように、1 つ以上の配布ポイントを構成する必要があります。 詳細については、「[Use multicast to deploy Windows over the network](../deploy-use/use-multicast-to-deploy-windows-over-the-network.md)」(マルチキャストを使用した、ネットワーク経由での Windows の展開) を参照してください。  

 オペレーティング システムを展開する前に、マルチキャストをサポートするように配布ポイントを構成する必要があります。 次の手順に従って、マルチキャストサポート用の既存の配布ポイントを変更します。 新しい配布ポイントのインストール方法の詳細については、「 [Install and configure distribution points](../../core/servers/deploy/configure/install-and-configure-distribution-points.md)」(配布ポイントのインストールと構成) を参照してください。

#### <a name="to-enable-multicast-for-a-distribution-point"></a>配布ポイントでマルチキャストを有効にするには  

1.  Configuration Manager コンソールで、[ **管理**] をクリックします。  

2.  [ **管理** ] ワークスペースで、[ **概要**] を展開し、[ **配布ポイント** ] ノードを選択します。  

3.  オペレーティング システムのイメージをマルチキャスト用に使用する配布ポイントを選択します。  

4.  **[ホーム]** タブの **[プロパティ]** グループで、 **[プロパティ]**をクリックします。  

5.  [マルチキャスト] タブを選択し、次のオプションを構成します。 ****  

    -   **マルチキャストを有効にする**: 配布ポイントでマルチキャストをサポートするには、このオプションを選択する必要があります。  

    -   **マルチキャスト接続アカウント**: サイト データベースに接続するアカウントを指定します。  

    -   **マルチキャスト アドレス設定**: 展開先のコンピューターにデータを送信するための IP アドレスを指定します。 既定では、マルチキャスト アドレスの配布が有効になっている DHCP サーバーから IP アドレスを取得します。 ネットワーク環境によって、239.0.0.0 ～ 239.255.255.255 の範囲の IP アドレスを指定できます。  

        > [!IMPORTANT]  
        >  IP アドレスは、オペレーティング システムのイメージを要求する対象コンピューターがアクセスできることが必要です。 このため、対象コンピューターとサイト サーバー間のルーターやファイアウォールは、マルチキャスト トラフィックを許可するように構成する必要があります。  

    -   UDP ポートの範囲:****対象コンピューターにデータを送信する UDP ポートの範囲を指定します。  

        > [!IMPORTANT]  
        >  これらのポートは、オペレーティング システムのイメージを要求する対象コンピューターからアクセスできることが必要です。 このため、対象コンピューターとサイト サーバー間のルーターやファイアウォールは、マルチキャスト トラフィックを許可するように構成する必要があります。  

    -   **スケジュールされたマルチキャストを有効にする**: Configuration Manager がどのように展開先コンピューターへのオペレーティング システムの展開開始日時を制御するかを指定します。 [スケジュールされたマルチキャストを有効にする] をクリックし、次のオプションを選択します。 ****  

         **[セッション開始の待ち時間]** ボックスに、最初の展開要求に応答する前に Configuration Manager が待機する時間 (分) を指定します。  

         **[最小セッション サイズ]** ボックスで、Configuration Manager がオペレーティング システムの展開を開始する前に受信しなければならない要求数を指定します。  

    -   転送速度:****ダウンロード先コンピューターにデータをダウンロードする際の転送速度を選択します。  

    -   **最大クライアント数**: この配布ポイントからオペレーティング システムをダウンロードできる展開先のコンピューターの最大数を指定します。  

6.  **[OK]**をクリックします。  

##  <a name="BKMK_StateMigrationPoints"></a> 状態移行ポイント  
 状態移行ポイントには、あるコンピューターでキャプチャされて別のコンピューターで復元されるユーザー状態データが保存されます。 ただし、セットアップ先のコンピューターでオペレーティング システムを更新する展開など、同じコンピューター上のオペレーティング システム展開のユーザー設定をキャプチャする場合、データをハードリンクを使用して同じコンピューターに保存するか、または状態移行ポイントを使用して保存するかを選択することができます。 一部のコンピューター展開では、状態ストアを作成すると、Configuration Manager によって状態ストアと対象コンピューターの関連付けが自動的に作成されます。 状態移行ポイントを計画する際には、以下の点を検討してください。  

### <a name="user-state-size"></a>ユーザー状態のサイズ  
 ユーザー状態のサイズは、状態移行ポイントのディスク記憶域や移行中のネットワーク パフォーマンスに直接影響します。 ユーザー状態のサイズおよび移行するコンピューターの台数について検討します。 また、どの設定をコンピューターから移行するのかについても検討します。 たとえば、 **[マイ ドキュメント]** がサーバーに既にバックアップされている場合、通常、イメージの展開の一部として移行する必要はありません。 不必要な移行を避けると、ユーザー状態の全体的なサイズを小さく保ち、ネットワーク パフォーマンスや状態移行ポイントのディスク記憶域に与える影響を軽減できます。  

### <a name="user-state-migration-tool"></a>ユーザー状態移行ツール  
 オペレーティング システムの展開中にユーザー状態をキャプチャして復元するには、USMT ソース ファイルをポイントするユーザー状態移行ツール (USMT) パッケージを使用する必要があります。 Configuration Manager コンソールの **[ソフトウェア ライブラリ]** > **[アプリケーション管理]** > **[パッケージ]** でこのパッケージが自動的に作成されます。 Configuration Manager では Windows アセスメント &amp; デプロイメント キット (Windows ADK) で配布される USMT 10.0 を使用して、ユーザー状態を 1 つのオペレーティング システムからキャプチャし、別のオペレーティング システムに復元します。  

 USMT 10.0 のさまざまな移行シナリオの詳細については、「 [移行の一般的なシナリオ](https://technet.microsoft.com/library/mt299169\(v=vs.85\).aspx)」を参照してください。  

### <a name="retention-policy"></a>ポリシーの保存  
 状態移行ポイントを構成するときに、状態移行ポイントに格納されたユーザー状態データを保存する期間を指定することができます。 状態移行ポイントにデータを保存する期間を決定するには、次の 2 つの点を考慮する必要があります。  

-   格納されたデータがディスク記憶域に与える影響  

-   データの移行が再度必要になる場合に備えて、データを一時的に保存するための要件  

 状態移行は、データのキャプチャとデータの復元の 2 段階で行われます。 データをキャプチャするときに、ユーザー状態データが収集されて状態移行ポイントに保存されます。 データを復元するときに、ユーザー状態データが状態移行ポイントから取得されて対象コンピューターに書き込まれてから、[状態ストアのリリース **** ] タスク シーケンス ステップによって、格納されたデータがリリースされます。 データがリリースされるときに、保存期間の開始として認識されます。 移行データを即時削除するオプションを選択している場合、リリース直後にユーザー状態データが削除されます。 一定期間データを保存するオプションを選択している場合、状態データのリリース後、データは指定期間が経過すると削除されます。 設定した保存期間が長くなるほど、必要なディスク容量も大きくなります。  

### <a name="select-drive-to-store-user-state-migration-data"></a>ユーザー状態移行データを格納するドライブの選択  
 状態移行ポイントを構成するときに、ユーザー状態移行データの格納に使用するサーバー上のドライブを指定する必要があります。 ドライブは、固定リストから選択します。 ただし、CD ドライブなどの書き込みできないドライブや、ネットワーク共有でないドライブが表示されることがあります。 また、コンピューター上のどのドライブにもマップされていないドライブ文字が表示されることもあります。 状態移行ポイントを構成するときには、書き込み可能な共有ドライブを指定する必要があります。  

### <a name="configure-a-state-migration-point"></a>状態移行ポイントを構成する  
 次の方法を使用して、ユーザー移行ポイントがユーザー状態データを保存するように構成できます。  

-   サイト システム サーバーの作成ウィザードを使用して、状態移行ポイント用の新しいサイト システム サーバーを作成します。 ****  

-   サイト システムの役割の追加ウィザードを使用して、状態移行ポイントを既存のサーバーに追加します。 ****  

 これらのウィザードを使用すると、次の状態移行ポイント情報の入力を求められます。  

-   ユーザー状態データを保存するフォルダー  

-   状態移行ポイントにデータを保存できる最大クライアント数  

-   ユーザー状態データを保存するための状態移行ポイントの最低空き領域  

-   役割の削除ポリシー。 (ユーザー状態データがコンピューターに復元された後、またはユーザー データがコンピューターに復元されて特定の日数が経過した後、直ちにユーザー状態データを削除するように指定できます。)  

-   状態移行ポイントがユーザー状態データの復元要求にのみ応答するかどうか (このオプションを有効にすると、状態移行ポイントを使用してユーザー状態データを保存できません。)  

 サイト システムの役割をインストールする手順については、「[Add site system roles](../../core/servers/deploy/configure/add-site-system-roles.md)」(サイト システムの役割の追加) を参照してください。  

---
title: OSD のサイト システムのための役割を準備する
titleSuffix: Configuration Manager
description: オペレーティング システムを展開する前に、サイト システムの役割を構成します。
ms.date: 03/22/2018
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: 0ef5f3ce-b0e4-4775-b5c2-b245e45b4194
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: c30c843c1b454b45483a2719eecf37334c8897e5
ms.sourcegitcommit: 0b0c2735c4ed822731ae069b4cc1380e89e78933
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/03/2018
ms.locfileid: "32352952"
---
# <a name="prepare-site-system-roles-for-operating-system-deployments-with-system-center-configuration-manager"></a>System Center Configuration Manager でのオペレーティング システム展開のサイト システムの役割の準備

*適用対象: System Center Configuration Manager (Current Branch)*

Configuration Manager でオペレーティング システムを展開するには、まず特定の構成と考慮が必要な次のサイト システムの役割を準備する必要があります。



##  <a name="BKMK_DistributionPoints"></a> 配布ポイント  
 配布ポイント サイト システムの役割は、クライアントがダウンロードするソース ファイルをホストします。 このコンテンツは、アプリケーション、ソフトウェア更新プログラム、OS イメージ、ブート イメージ、およびドライバー パッケージを対象としています。 帯域幅、調整、およびスケジュールのオプションを使って、コンテンツの配布を制御できます。  

 コンピューターへのオペレーティング システムの展開をサポートできるだけの十分な配布ポイントを用意することが重要です。 さらに、階層内でこれらの配布ポイントをどのように配置するかについて計画を立てることも重要です。 詳細については、「[コンテンツ管理インフラストラクチャの展開と管理](../../core/servers/deploy/configure/manage-content-and-content-infrastructure.md)」をご覧ください。 この記事には、OS の展開に応じて、配布ポイントの計画時にはさらに考慮すべき事項があります。  


###  <a name="BKMK_AdditionalPlanning"></a> 配布ポイントの計画に関する追加の考慮事項  
 配布ポイントの計画時にさらに考慮すべき事項は次のとおりです。  

-   **不要な OS の展開を行わないようにする方法**  

     Configuration Manager は、サイト サーバーと、コレクション内の他の展開先のコンピューターを区別しません。 サイト サーバーが含まれているコレクションに、必要なタスク シーケンスを展開すると、そのサイト サーバーは、コレクション内の他のコンピューターと同じ方法でタスク シーケンスを実行します。 OS の展開では必ず、目的のクライアントが含まれているコレクションを使用します。  

     危険度の高いタスク シーケンスの展開については、その動作を管理します。 危険度の高い展開はクライアントに自動的にインストールされ、望ましくない結果が生じる可能性があります。 たとえば、OS を展開する必須の目的を持つタスク シーケンスなどがこれに該当します。 望ましくない危険度の高い展開のリスクを減らすためには、展開検証設定を構成します。 詳細については、「[危険度の高い展開を管理するための設定](../../protect/understand/settings-to-manage-high-risk-deployments.md)」を参照してください。  

-   **1 つの配布ポイントから OS イメージを一度に受信できるコンピューターの数**  

     必要な配布ポイントの数を見積もるには、次の変数を考慮してください。  
       - 配布ポイントの処理速度
       - 配布ポイントのディスク速度
       - ネットワークで使用できる帯域幅
       - イメージ パッケージのサイズ   
  
    たとえば、他のサーバー リソース要因をまったく考慮しない場合、100 メガバイト/秒のイーサネット ネットワークにおいて 1 時間で 4 ギガバイト (GB) のイメージ パッケージを処理できるコンピューターの最大台数は 11 台になります。  

    `100 megabits/sec = 12.5 megabytes/sec = 750 megabytes/min = 45 gigabytes/hour = 11 images @ 4 GB per image`  

    一定の時間内に特定の台数のコンピューターに OS を展開する必要がある場合は、適切な数の配布ポイントにイメージを配布します。  

-   **配布ポイントに OS を展開できるかどうか**  

     OS を配布ポイントに展開することはできますが、OS イメージは別の配布ポイントから受信する必要があります。  


###  <a name="BKMK_PXEDistributionPoint"></a> PXE 要求を受け入れるための配布ポイントの構成  
 PXE ブート要求を作成する Configuration Manager クライアントにオペレーティング システムを展開するには、PXE 要求を受け入れるように 1 つ以上の配布ポイントを構成する必要があります。 構成された配布ポイントは、PXE ブート要求に応答し、実行する適切な展開アクションを決定します。 詳細については、[配布ポイントのインストールと変更に関するトピック](../../core/servers/deploy/configure/install-and-configure-distribution-points.md#pxe)を参照してください。  


###  <a name="BKMK_RamDiskTFTP"></a> PXE 対応配布ポイント上の RamDisk TFTP ブロック サイズとウィンドウ サイズのカスタマイズ  
PXE 対応配布ポイントの RamDisk TFTP ブロック サイズとウィンドウ サイズをカスタマイズできます。 ネットワークをカスタマイズしている場合、ブロックまたはウィンドウのサイズが大きいと、ブート イメージのダウンロードがタイムアウト エラーで失敗する可能性があります。 RamDisk TFTP ブロック サイズとウィンドウ サイズのカスタマイズにより、特定のネットワーク要件に対応する PXE を使用する場合に、TFTP トラフィックを最適化できます。 最も効率的な構成を判断するには、環境内でカスタマイズした設定をテストします。  

-   **TFTP ブロック サイズ**: ブロック サイズは、ファイルをダウンロードしているクライアントにサーバーが送信するデータ パケットのサイズです。 ブロック サイズを大きくすると、サーバーとクライアントの間のラウンド トリップ遅延が少なくなるように、サーバーが送信するパケットを少なくすることができます。 ただし、大きいサイズのブロックにより、ほとんどの PXE クライアントの実装がサポートしていない、断片化されたパケットが生成されます。  

-   **TFTP ウィンドウ サイズ**: TFTP では、送信されるデータの各ブロックの確認 (ACK) パケットが必要です。 前のブロックの ACK パケットを受信するまで、サーバーは、シーケンス内の次のブロックを送信しません。 TFTP のウィンドウ化では、ウィンドウをいっぱいにするのに要するデータ ブロックの数を定義することができます。 サーバーは、ウィンドウがいっぱいになるまでデータ ブロックを連続で送信し、その後クライアントが ACK パケットを送信します。 このウィンドウのサイズを増やすと、クライアントとサーバーの間のラウンド トリップ遅延回数が減少し、ブート イメージをダウンロードするために必要な全体の時間が短縮します。  
  


#### <a name="modify-the-ramdisk-tftp-window-size"></a>RamDisk TFTP ウィンドウ サイズを変更する  
RamDisk TFTP ウィンドウ サイズをカスタマイズするには、PXE 対応配布ポイント上に次のレジストリ キーを追加します。  

  - **場所**: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SMS\DP  
  - **名前**: RamDiskTFTPWindowSize  
  - **型**: REG_DWORD  
  - **値**: &lt;カスタマイズされたウィンドウのサイズ>  </br>
     既定値は **1** (1 つのデータ ブロックでウィンドウがいっぱいになります)  

#### <a name="modify-the-ramdisk-tftp-block-size"></a>RamDisk TFTP ブロック サイズを変更する  
RamDisk TFTP ウィンドウ サイズをカスタマイズするには、PXE 対応配布ポイント上に次のレジストリ キーを追加します。  

  - **場所**: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SMS\DP  
  - **名前**: RamDiskTFTPBlockSize  
  - **型**: REG_DWORD  
  - **値**: &lt;カスタマイズされたブロック サイズ>  </br>
     既定値は **4096** です。  


###  <a name="BKMK_DPMulticast"></a> マルチキャストをサポートする配布ポイントの構成  
 マルチキャストはネットワーク最適化の方法です。 複数のクライアントが同じ OS イメージを同時にダウンロードする可能性が高い場合は、配布ポイント上でマルチキャストを使用することができます。 マルチキャストを使用すると、複数のコンピューターが同時に OS イメージをダウンロードすることができます。これは OS イメージが配布ポイントによってマルチキャストされるからです。 マルチキャストを使用しない場合、配布ポイントは各クライアントに個別の接続を介してデータのコピーを送信します。 詳細については、「[Use multicast to deploy Windows over the network](../deploy-use/use-multicast-to-deploy-windows-over-the-network.md)」(マルチキャストを使用した、ネットワーク経由での Windows の展開) を参照してください。  

 OS を展開する前に、マルチキャストをサポートするように配布ポイントを構成します。 詳細については、[配布ポイントのインストールと構成](/sccm/core/servers/deploy/configure/install-and-configure-distribution-points#multicast)に関するページを参照してください。


##  <a name="BKMK_StateMigrationPoints"></a> 状態移行ポイント  
 状態移行ポイントには、USMT があるコンピューターでキャプチャし、別のコンピューターで復元するユーザー状態データが保存されます。 ただし、セットアップ先のコンピューターで Windows を更新する展開など、同じコンピューター上の OS 展開のユーザー設定をキャプチャする場合、データをハードリンクを使用して同じコンピューターに保存するか、または状態移行ポイントを使用して保存するかを選択することができます。 一部のコンピューター展開では、状態ストアを作成すると、Configuration Manager によって状態ストアと対象コンピューターの関連付けが自動的に作成されます。 状態移行ポイントを計画する際には、以下の点を検討してください。    

### <a name="user-state-size"></a>ユーザー状態のサイズ  
 ユーザー状態のサイズは、状態移行ポイントのディスク記憶域や移行中のネットワーク パフォーマンスに直接影響します。 ユーザー状態のサイズおよび移行するコンピューターの台数について検討します。 また、どの設定をコンピューターから移行するのかについても検討します。 たとえば、 **[マイ ドキュメント]** フォルダーがサーバーに既にバックアップされている場合、通常、イメージの展開の一部として移行する必要はありません。 不必要な移行を避けると、ユーザー状態の全体的なサイズが小さく保たれ、ネットワーク パフォーマンスや状態移行ポイントのディスク記憶域に与える影響が軽減されます。  

### <a name="user-state-migration-tool"></a>ユーザー状態移行ツール  
 オペレーティング システムの展開中にユーザー状態をキャプチャして復元するには、USMT ソース ファイルをポイントするユーザー状態移行ツール (USMT) パッケージを使用する必要があります。 Configuration Manager コンソールの **[ソフトウェア ライブラリ]** > **[アプリケーション管理]** > **[パッケージ]** でこのパッケージが自動的に作成されます。 Configuration Manager では USMT 10 を使用して、ある OS からユーザー状態をキャプチャし、それを別の OS に復元します。 Windows 10 用の Windows アセスメント & デプロイメント キット (Windows ADK) には USMT 10 が含まれています。

 USMT 10.0 のさまざまな移行シナリオの詳細については、Windows ドキュメントの「[Common Migration Scenarios](/windows/deployment/usmt/usmt-common-migration-scenarios)」(移行の一般的なシナリオ) を参照してください。  

### <a name="retention-policy"></a>ポリシーの保存  
 状態移行ポイントを構成する場合は、状態移行ポイントに格納されたユーザー状態データを保存する期間を指定します。 状態移行ポイントにデータを保存する期間を決定するには、次の 2 つの点を考慮する必要があります。  

-   格納されたデータがディスク記憶域に与える影響  

-   データの移行が再度必要になる場合に備えて、データを一時的に保存するための要件
  
  
状態移行は、データのキャプチャとデータの復元の 2 段階で行われます。 データをキャプチャするときに、ユーザー状態データが収集されて状態移行ポイントに保存されます。 データを復元するときに、ユーザー状態データが状態移行ポイントから取得されて対象コンピューターに書き込まれてから、**[状態ストアのリリース]** タスク シーケンス ステップによって、格納されたデータがリリースされます。 データがリリースされるときに、保存期間の開始として認識されます。 移行データを即時削除するオプションを選択している場合、リリース直後にユーザー状態データが削除されます。 一定期間データを保存するオプションを選択している場合、状態データのリリース後、データは指定期間が経過すると削除されます。 設定したリテンション期間が長くなるほど、必要なディスク容量も大きくなります。  

### <a name="select-drive-to-store-user-state-migration-data"></a>ユーザー状態移行データを格納するドライブの選択  
 状態移行ポイントを構成するときに、ユーザー状態移行データの格納に使用するサーバー上のドライブを指定する必要があります。 ドライブは、固定リストから選択します。 ただし、CD ドライブなどの書き込みできないドライブや、ネットワーク共有でないドライブが表示されることがあります。 また、コンピュータ上のどのドライブにもマップされていないドライブ文字が表示されていることもあります。 状態移行ポイントを構成するときには、書き込み可能な共有ドライブを指定します。  

### <a name="configure-a-state-migration-point"></a>状態移行ポイントを構成する  
 次の方法を使用して、ユーザー移行ポイントがユーザー状態データを保存するように構成できます。  

-   **サイト システム サーバーの作成ウィザード**を使用して、状態移行ポイント用の新しいサイト システム サーバーを作成します。  

-   **サイト システムの役割の追加ウィザード**を使用して、状態移行ポイントを既存のサーバーに追加します。  

 これらのウィザードを使用すると、次の状態移行ポイント情報の入力を求められます。  

-   ユーザー状態データを保存するフォルダー  

-   状態移行ポイントにデータを保存できる最大クライアント数  

-   ユーザー状態データを保存するための状態移行ポイントの最低空き領域  

-   役割の削除ポリシー。 ユーザー状態データがコンピューターに復元された後、またはユーザー データがコンピューターに復元されて特定の日数が経過した後のいずれかで、直ちにユーザー状態データが削除されるように指定します。  

-   状態移行ポイントがユーザー状態データの復元要求にのみ応答するかどうか (このオプションを有効にすると、状態移行ポイントを使用してユーザー状態データを保存できません。)  

 サイト システムの役割をインストールする手順については、「[Add site system roles](../../core/servers/deploy/configure/add-site-system-roles.md)」(サイト システムの役割の追加) を参照してください。  

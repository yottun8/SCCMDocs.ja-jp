---
title: 'ユーザー状態の管理 '
titleSuffix: Configuration Manager
description: System Center Configuration Manager では、ユーザー状態移行ツールを使用してオペレーティング システムの展開シナリオでのユーザー状態データをキャプチャして復元します。
ms.date: 01/23/2017
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: d8d5c345-1e91-410b-b8a9-0170dcfa846e
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 676131965165acda9633e7fbceaee7f25d823efe
ms.sourcegitcommit: 48098f9fb2f447672bf36d50c9f58a3d26acb9ed
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/14/2018
ms.locfileid: "53420381"
---
# <a name="manage-user-state-in-system-center-configuration-manager"></a>System Center Configuration Manager でのユーザー状態の管理

「オブジェクトの*適用対象: System Center Configuration Manager (Current Branch)*

オペレーティング システムを展開するときに、現在のオペレーティング システムのユーザー状態を維持したい場合は、System Center Configuration Manager のタスク シーケンスを使って、ユーザー状態データをキャプチャして復元します。 次に例を示します。  

- あるコンピューターのユーザー状態をキャプチャし、別のコンピューターで復元する展開。  

- 同じコンピューターでユーザー状態をキャプチャして復元する更新プログラムの展開。  

  オペレーティング システムのインストールが完了した後、Configuration Manager では、ユーザー状態移行ツール (USMT) 10.0 を使用して、ソース コンピューターからセットアップ先のコンピューターへのユーザー状態データの移行を管理します。 USMT 10.0 の一般的な移行シナリオの詳細については、「  [一般的な移行シナリオ](https://technet.microsoft.com/library/mt299169\(v=vs.85\).aspx)」を参照してください。  

  以下のセクションを参照して、ユーザー データをキャプチャして復元してください。


##  <a name="BKMK_StoringUserData"></a> ユーザー状態データの保存  
 ユーザー状態をキャプチャするとき、セットアップ先のコンピューターまたは状態移行ポイントにユーザー状態データを保存できます。 ユーザー状態移行ポイント上にユーザー状態を保存するには、状態移行ポイント サイト システムの役割をホストする Configuration Manager サイト システム サーバーを使用する必要があります。 展開先コンピューター上にユーザー状態を保存するには、タスク シーケンスを構成し、リンクを使用してローカルにデータを保存する必要があります。  

> [!NOTE]  
>  ユーザー状態をローカルに保存するために使用されるリンクはハードリンクと呼ばれます。 ハードリンクは USMT 10.0 機能であり、コンピューターのユーザー ファイルと設定をスキャンし、これらのファイルに対するハードリンクのディレクトリを作成します。 次に、新しいオペレーティング システムの展開後に、ハードリンクを使用して、ユーザー データを復元します。  

> [!IMPORTANT]  
>  状態移行ポイントとハードリンクを使用して、同時にユーザー状態データを保存することはできません。  

 ユーザー状態情報をキャプチャしたら、次のいずれかの方法でこの情報を保存できます。  

-   状態移行ポイントを構成することによって、リモートにユーザー状態データを保存することができます。 **キャプチャ** のタスク シーケンスが状態移行ポイントへデータを送信します。 そして、オペレーティング システムが展開された後、 **復元** のタスク シーケンスがデータを取得し、セットアップ先のコンピューターにユーザー状態を復元します。  

-   ユーザー状態データは特定の場所にローカルに保存できます。 このシナリオでは、 **キャプチャ** のタスク シーケンスはユーザー データをセットアップ先のコンピューターの特定の場所にコピーします。 そして、オペレーティング システムが展開された後、 **復元** のタスク シーケンスがその場所からユーザー データを取得します。  

-   ユーザー データを元の場所に復元するために使用するハード リンクを指定できます。 このシナリオでは、古いオペレーティング システムが消去されてもユーザー状態データはドライブに保持されます。 そして、新しいオペレーティング システムが展開された後、 **復元** のタスク シーケンスがハードリンクを使用して、元の場所にユーザー状態データを復元します。  

###  <a name="BKMK_UserDataSMP"></a> 状態移行ポイントにユーザー状態データを保存する  
 状態移行ポイントにユーザー状態データを保存するには、次の操作を行う必要があります。  

1.  ユーザー状態データを保存するために、[Configure a state migration point](#BKMK_StateMigrationPoint) 。  

2.  ソース コンピューターとセットアップ先のコンピューターの間に、[Create a computer association](#BKMK_ComputerAssociation) 。 ソース コンピューター上でユーザー状態をキャプチャする前に、この関連付けを作成する必要があります。  

3.  [System Center Configuration Manager でユーザー状態をキャプチャおよび復元するためのタスク シーケンスを作成する](../deploy-use/create-a-task-sequence-to-capture-and-restore-user-state.md)。 具体的には、コンピューターからユーザー データをキャプチャし、状態移行ポイントにユーザーのデータを保存し、ユーザー データをコンピューターに復元するために、次のタスク シーケンスのステップを追加する必要があります。  

    -   [状態ストアの要求](../understand/task-sequence-steps.md#BKMK_RequestStateStore)で、コンピューターから状態をキャプチャするときに、状態移行ポイントへのアクセスを要求します。  

    -   [ユーザー状態のキャプチャ](../understand/task-sequence-steps.md#BKMK_CaptureUserState)で、ユーザー状態データをキャプチャし、状態移行ポイントに保存します。  

    -   [ユーザー状態の復元](../understand/task-sequence-steps.md#BKMK_RestoreUserState)で、ユーザー状態移行ポイントからデータを取得して、セットアップ先のコンピューターにユーザー状態を復元します。  

    -   [状態ストアのリリース](../understand/task-sequence-steps.md#BKMK_ReleaseStateStore)で、キャプチャ アクションまたは復元アクションが完了した状態移行ポイントを通知します。  

###  <a name="BKMK_UserDataDestination"></a> ユーザー データをローカルに保存する  
 ユーザー状態データをローカルに保存するには、次の操作を行う必要があります。  

-   [ユーザー状態をキャプチャおよび復元するタスク シーケンスの作成](../deploy-use/create-a-task-sequence-to-capture-and-restore-user-state.md)。 具体的には、コンピューターからユーザー データをキャプチャし、ハードリンクを使用してユーザー データをコンピューターに復元するために、次のタスク シーケンスのステップを追加する必要があります。  

    -   [ユーザー状態のキャプチャ](../understand/task-sequence-steps.md#BKMK_CaptureUserState) で、ユーザー状態データをキャプチャし、ハードリンクを使用して、ローカル フォルダーに保存します。  

    -   [ユーザー状態の復元](../understand/task-sequence-steps.md#BKMK_RestoreUserState) で、ハードリンクを使用してデータを取得し、セットアップ先のコンピューターにユーザー状態を復元します。  

        > [!NOTE]  
        >  タスク シーケンスが古いオペレーティング システムを削除した後、ハードリンクが参照するユーザー状態データがコンピューターに残ります。 新しいオペレーティング システムが展開される際、このデータを使用してユーザー状態を復元します。  

##  <a name="BKMK_StateMigrationPoint"></a> Configure a state migration point  
 状態移行ポイントには、あるコンピューターでキャプチャされて別のコンピューターで復元されるユーザー状態データが保存されます。 ただし、セットアップ先のコンピューターでオペレーティング システムを更新する展開など、同じコンピューター上のオペレーティング システム展開のユーザー設定をキャプチャする場合、データは、ハードリンクを使用して同じコンピューターに保存したり、状態移行ポイントに保存したりすることができます。 一部のコンピューター展開では、状態ストアを作成すると、Configuration Manager によって状態ストアと対象コンピューターの関連付けが自動的に作成されます。 次の方法を使用して、ユーザー移行ポイントがユーザー状態データを保存するように構成できます。  

- **サイト システム サーバーの作成**ウィザードを使用して、状態移行ポイント用の新しいサイト システム サーバーを作成します。   

- **サイト システムの役割の追加ウィザード**を使用して、状態移行ポイントを既存のサーバーに追加します。   

  これらのウィザードを使用すると、次の状態移行ポイント情報の入力を求められます。  

- ユーザー状態データを保存するフォルダー  

- 状態移行ポイントにデータを保存できる最大クライアント数  

- ユーザー状態データを保存するための状態移行ポイントの最低空き領域  

- 役割の削除ポリシー。 (ユーザー状態データがコンピューターに復元された後、またはユーザー データがコンピューターに復元されて特定の日数が経過した後、直ちにユーザー状態データを削除するように指定できます。)  

- 状態移行ポイントがユーザー状態データの復元要求にのみ応答するかどうか (このオプションを有効にすると、状態移行ポイントを使用してユーザー状態データを保存できません。)  

  状態移行ポイントおよびそれを構成する手順の詳細については、「[State migration point](prepare-site-system-roles-for-operating-system-deployments.md#BKMK_StateMigrationPoints)」 (状態移行ポイント) を参照してください。  

##  <a name="BKMK_ComputerAssociation"></a> Create a computer association  
 新しいハードウェアにオペレーティング システムをインストールするときに、ユーザー データの設定をキャプチャおよび復元する場合は、ソース コンピューターとセットアップ先のコンピューターの間の関係を定義するために、コンピューターの関連付けを作成します。 ソース コンピューターは、Configuration Manager で管理される既存のコンピューターです。 新しいオペレーティング システムを展開先コンピューターに展開する際、ソース コンピューターには、展開先コンピューターに移行されるユーザー状態が含まれます。  

> [!NOTE]  
>  Configuration Manager の親サイトにあるコンピューターと子サイトにあるコンピューターの間では、コンピューターの関連付けを作成できません。 コンピューターの関連付けはサイト固有であり、レプリケートされません。  

#### <a name="to-create-a-computer-association"></a>コンピューターの関連付けを作成するには  

1.  Configuration Manager コンソールで、**[資産とコンプライアンス]** をクリックします。  

2.  **[資産とコンプライアンス]** ワークスペースで **[ユーザー状態の移行]** をクリックします。  

3.  **[ホーム]** タブの **[作成]** グループで、**[コンピューターの関連付けの作成]** をクリックします。  

4.  **[コンピューターの関連付けのプロパティ]** ダイアログ ボックスの **[コンピューターの関連付け]** のタブで、ユーザー状態のキャプチャ元のコンピューターと、ユーザー状態データの復元先のコンピューターを指定します。  

5.  **[ユーザー アカウント]** タブで、展開先コンピューターに移行するユーザー アカウントを指定します。  次のいずれかの設定を指定します。  

    -   **すべてのユーザー アカウントをキャプチャして復元する**: この設定はすべてのユーザー アカウントをキャプチャして復元します。 この設定を使用して、同じソース コンピューターに対する複数の関連付けを作成します。  

    -   **すべてのユーザー アカウントをキャプチャして指定したアカウントを復元する**:この設定は、ソース コンピューターのすべてのユーザー アカウントをキャプチャし、展開先コンピューターには指定したアカウントのみを復元します。 また、同じソース コンピューターに対する複数の関連付けを作成する場合にもこの設定を使用できます。  

    -   **指定したユーザー アカウントをキャプチャして復元する**: この設定は指定したアカウントのみをキャプチャして復元します。 この設定を選択するときには、同じソース コンピューターに対する複数の関連付けを作成できません。  

##  <a name="BKMK_MigrationFails"></a> オペレーティング システムの展開が失敗したときにユーザー状態データを復元する  
 オペレーティング システムの展開が失敗する場合、USMT 10.0 LoadState 機能を使用して、展開プロセス中にキャプチャされたユーザー状態データを取得します。 このデータには、状態移行ポイントに保存されているデータや、移行先コンピューターのローカルに保存されているデータが含まれます。 この USMT 機能の詳細については、「 [LoadState 構文](https://technet.microsoft.com/library/mt299188\(v=vs.85\).aspx)」をご覧ください。  

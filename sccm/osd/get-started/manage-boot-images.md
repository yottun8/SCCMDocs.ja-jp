---
title: 'ブート イメージの管理 '
titleSuffix: Configuration Manager
description: Configuration Manager で、オペレーティング システムの展開中に使用する Windows PE ブート イメージを管理する方法について説明します。
ms.date: 03/22/2018
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: 97f2d81a-2c58-442c-88bc-defd5a1cd48f
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: b0fa269199f7f3bf4299f90faef9e55766f775d4
ms.sourcegitcommit: 48098f9fb2f447672bf36d50c9f58a3d26acb9ed
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/14/2018
ms.locfileid: "53421333"
---
# <a name="manage-boot-images-with-system-center-configuration-manager"></a>System Center Configuration Manager でのブート イメージの管理

*適用対象:System Center Configuration Manager (Current Branch)*

Configuration Manager のブート イメージは、オペレーティング システムの展開中に使用される [Windows PE](https://docs.microsoft.com/windows-hardware/manufacture/desktop/winpe-intro) (WinPE) のイメージです。 ブート イメージは、コンピューターを WinPE で起動するために使用されます。 この最小限のオペレーティング システムには、限られたコンポーネントとサービスが含まれています。 Configuration Manager では、WinPE を使用して、Windows インストール用にセットアップ先のコンピューターを準備します。 ブート イメージを管理するときは、以下のセクションを参照してください。

## <a name="BKMK_BootImageDefault"></a> 既定のブート イメージ
既定では、Configuration Manager には、x86 プラットフォームをサポートするブート イメージと x64 プラットフォームをサポートするブート イメージの、2 つのブート イメージが用意されています。 これらのイメージは次の場所に格納されています: \\\\*servername*>\SMS_<*sitecode*>\osd\boot\\<*x64*> または <*i386*>。 既定のブート イメージは、実行する操作に応じて更新または再生成されます。

既定のブート イメージに記載されている任意の操作に対して、次の動作を考慮します。
- ソース ドライバー オブジェクトが有効である必要があります。 これらのオブジェクトには、ドライバーのソース ファイルが含まれます。 オブジェクトが有効でない場合、サイトでブート イメージにドライバーが追加されません。
- 既定のブート イメージに基づいていないブート イメージは、同じ Windows PE バージョンを使用する場合でも、変更されません。
- 変更したブート イメージを配布ポイントに再配布します。
- 変更したブート イメージを使用するメディアを再作成します。
- カスタマイズした/既定のブート イメージを自動的に更新しない場合は、既定の場所に保存しないでください。

> [!NOTE]
> **[ソフトウェア ライブラリ]** 内のすべてのブート イメージに対して Configuration Manager トレース ログ ツール (CMTrace) が追加されます。 Windows PE を使用している場合は、コマンド プロンプトから「**CMTrace**」を入力してツールを起動します。 バージョン 1802 以降では、Windows PE で cmtrace.exe の起動時に、このプログラムをログ ファイルの既定のビューアーにするかどうかを選択するように求められることがなくなりました。

### <a name="use-updates-and-servicing-to-install-the-latest-version-of-configuration-manager"></a>更新プログラムとサービスを使用して、Configuration Manager の最新バージョンをインストールする
バージョン 1702 以降、Windows アセスメント & デプロイメント キット (ADK) のバージョンをアップグレードし、更新プログラムとサービスを使用して、Configuration Manager の最新バージョンをインストールするときに、サイトによって既定のブート イメージが再生成されます。 この更新プログラムには、更新された Windows ADK の新しい WinPE バージョン、新しいバージョンの Configuration Manager クライアント、ドライバー、およびカスタマイズが含まれます。 サイトは、カスタム ブート イメージを変更しません。

1702 より前のバージョンでは、Configuration Manager は、クライアント コンポーネント、ドライバー、およびカスタマイズを使用して既存のブート イメージを更新しますが、Windows ADK に含まれる WinPE の最新バージョンは使用されません。 新しいバージョンの Windows ADK を使用するために、ブート イメージを手動で変更します。

### <a name="upgrade-from-configuration-manager-2012-to-configuration-manager-current-branch-cb"></a>Configuration Manager 2012 から Configuration Manager Current Branch (CB) へのアップグレード
セットアップ プロセスを使用して Configuration Manager 2012 を Configuration Manager CB にアップグレードするときに、サイトが既定のブート イメージを再生成します。 この更新プログラムには、更新された Windows ADK の新しい WinPE バージョンと新しいバージョンの Configuration Manager クライアントが含まれます。 すべてのブート イメージのカスタマイズは変更されません。 サイトは、カスタム ブート イメージを変更しません。

### <a name="update-distribution-points-with-the-boot-image"></a>ブート イメージを使用して配布ポイントを更新する
コンソールで、**[ブート イメージ]** ノードから **[配布ポイントの更新]** アクションを使用する場合、サイトは、クライアント コンポーネント、ドライバー、およびカスタマイズを使用して対象のブート イメージを更新します。    

Configuration Manager バージョン 1706 以降、Windows ADK インストール ディレクトリにある最新バージョンの WinPE を使用してブート イメージを再読み込みします。 配布ポイントの更新ウィザードの **[全般]** ページには、次の情報があります。 
 - サイト サーバーにインストールされている Windows ADK のバージョン
 - ブート イメージの WinPE の Windows ADK バージョン
 - Configuration Manager クライアントのバージョン。この情報を使用して、ブート イメージを再読み込みするかどうかを判断します。 **[ブート イメージ]** ノードにも (**クライアント バージョン**) 用の新しい列が含まれています。 この列を使用すると、各ブート イメージで Configuration Manager クライアントのバージョンをすばやく表示できます。    


##  <a name="BKMK_BootImageCustom"></a> ブート イメージのカスタマイズ  
 ブート イメージが Windows ADK のサポートされているバージョンの WinPE バージョンに基づいている場合、コンソールから[ブート イメージを変更](#BKMK_ModifyBootImages)またはカスタマイズできます。 新しいバージョンでサイトがアップグレードされ、新しいバージョンの Windows ADK がインストールされている場合、カスタム ブート イメージ (既定のブート イメージの場所ではない) は新しいバージョンの Windows ADK で更新されません。 このことが発生すると、Configuration Manager コンソールでブート イメージをカスタマイズできません。 ただし、引き続き、アップグレード前と同様に動作します。  

 ブート イメージがサイトにインストールされている Windows ADK の別のバージョンに基づいている場合は、ブート イメージをカスタマイズする必要があります。 展開イメージ サービスと管理 (DISM) コマンドライン ツールを使用するなど、別の方法を使用してこれらのブート イメージをカスタマイズします。 DISM は、Windows SDK の一部です。 詳細については、「[ブート イメージのカスタマイズ](customize-boot-images.md)」を参照してください。  

##  <a name="BKMK_AddBootImages"></a> ブート イメージの追加  

 サイトのインストール中に、Configuration Manager は、Windows ADK のサポートされているバージョンから、WinPE バージョンに基づくブート イメージを自動的に追加します。 Configuration Manager のバージョンによっては、サポートされているバージョンの Windows ADK とは異なるバージョンの WinPE に基づくブート イメージを追加できる場合があります。 サポートされていないバージョンの WinPE が含まれるブート イメージを追加しようとすると、エラーが発生します。 次のリストに、現在サポートされている Windows ADK と WinPE バージョンを示します。 

- **Windows ADK バージョン**  

   Windows 10 用 Windows ADK  

- **Configuration Manager コンソールでカスタマイズできる Windows PE ブート イメージのバージョン**  

   Windows PE 10  

- **Configuration Manager コンソールでカスタマイズできない Windows PE ブート イメージのバージョン**  

   Windows PE 3.1<sup>1</sup> および Windows PE 5  

   <sup>1</sup> Windows PE 3.1 のブートイメージしか Configuration Manager に追加することができません。 Windows AIK for Windows 7 (Windows PE 3.0 の構築用) を Windows AIK Supplement for Windows 7 SP1 (Windows PE 3.1 の構築用) にアップグレードします。 Windows AIK Supplement for Windows 7 SP1 は、 [Microsoft ダウンロード センター](https://www.microsoft.com/download/details.aspx?id=5188)からダウンロードできます。  

   たとえば、Configuration Manager コンソールを使用して、Windows ADK for Windows 10 (Windows PE 10 の構築用) で構築したブート イメージをカスタマイズします。 Windows PE 5 に基づくブート イメージの場合、Windows ADK for Windows 8 の DISM のバージョンを使用して別のコンピューターからカスタマイズします。 その後、カスタム ブート イメージを Configuration Manager コンソールに追加します。 詳細については、「[ブート イメージのカスタマイズ](customize-boot-images.md)」を参照してください。

  ブート イメージを手動で追加するには、次の手順に従います。  

#### <a name="to-add-a-boot-image"></a>ブート イメージを追加するには  

1. Configuration Manager コンソールで、**[ソフトウェア ライブラリ]** をクリックします。  

2. **[ソフトウェア ライブラリ]** ワークスペースで **[オペレーティング システム]** を展開し、**[ブート イメージ]** をクリックします。  

3. **[ホーム]** タブの **[作成]** グループで、**[ブート イメージの追加]** をクリックし、ブート イメージの追加ウィザードを開始します。  

4. **[データ ソース]** ページで以下のオプションを指定し、**[次へ]** をクリックします。  

   -   **[パス]** ボックスで、ブート イメージの WIM ファイルへのパスを指定します。  

        このパスは、UNC 形式の有効なネットワーク パスでなければなりません。 例: \\\\<*servername*\\<*sharename*>\\<*bootimagename*>.wim  

   -   **[ブート イメージ]** ドロップダウン リストで、インポートするブート イメージを選択します。 WIM ファイルに複数のブート イメージが含まれている場合、該当するイメージを選びます。  

5. **[全般]** ページで、以下のオプションを指定して **[次へ]** をクリックします。  

   -   **[名前]** ボックスで、ブート イメージの一意の名前を指定します。  

   -   **[バージョン]** ボックスで、ブート イメージのバージョン番号を指定します。  

   -   **[コメント]** ボックスで、ブート イメージの使用方法について簡単な説明を指定します。  

6. ウィザードを完了します。  

   Configuration Manager コンソールの **[ ブート イメージ]** ノードに、ブート イメージが一覧表示されます。 ブート イメージを使用してオペレーティング システムを展開する前に、配布ポイントにブート イメージを配布します。 

> [!NOTE]  
>  コンソールの **[ブート イメージ]** ノードの **[サイズ (KB)]** 列に、各ブート イメージの圧縮解除後のサイズが表示されます。 サイトは、ネットワーク経由でブート イメージを送信するときに、圧縮コピーを送信します。 このコピーは、通常は **[サイズ (KB)]** 列で表示されているサイズより小さくなります。  

##  <a name="BKMK_DistributeBootImages"></a> 配布ポイントへのブート イメージの配布  
 ブート イメージは、他のコンテンツを配布するのと同じ方法で配布ポイントに配布されます。 ほとんどの場合は、オペレーティング システムを展開する前、およびメディアを作成する前に、少なくとも 1 つの配布ポイントにブート イメージを配布する必要があります。   

> [!NOTE]  
> PXE を使用してオペレーティング システムを展開するには、ブート イメージを配布する前に次の点を考慮します。  
> - PXE 要求を受け入れるための配布ポイントを構成します。  
> - x86 と x64 の両方の PXE 対応ブート イメージを、少なくとも 1 つの PXE 対応配布ポイントに配布します。  
> - Configuration Manager は、ブート イメージを、PXE 対応配布ポイント上の **RemoteInstall** フォルダーに配布します。  
>   
> PXE を使用してオペレーティング システムを展開する方法の詳細については、「[PXE を使用したネットワーク経由での Windows の展開](../deploy-use/use-pxe-to-deploy-windows-over-the-network.md)」を参照してください。  

 ブート イメージを配布する手順については、「 [Distribute content](/sccm/core/servers/deploy/configure/deploy-and-manage-content#bkmk_distribute)」をご覧ください。  

##  <a name="BKMK_ModifyBootImages"></a> ブート イメージの変更  
 デバイス ドライバーをイメージに追加または削除したり、ブート イメージに関連付けられているプロパティを編集したりできます。 追加または削除するデバイス ドライバーには、ネットワーク アダプターまたは大容量記憶装置のデバイス ドライバーが含まれる可能性があります。 ブート イメージを変更する際には、以下の点をご考慮ください。  

- デバイス ドライバーをブート イメージに追加する前に、デバイス ドライバー カタログのデバイス ドライバーをインポートして有効にします。  

- ブート イメージを変更しても、ブート イメージが参照する関連パッケージは一切変更されません。  

- ブート イメージに変更を加えたら、既にある配布ポイントでブート イメージを**更新**します。 このプロセスにより、ブート イメージの最新バージョンがクライアントに使用可能になります。 詳細については、「 [Manage content you have distributed](/sccm/core/servers/deploy/configure/deploy-and-manage-content#bkmk_manage)」を参照してください。  

  ブート イメージを変更するには、次の手順に従います。  

#### <a name="to-modify-the-properties-of-a-boot-image"></a>ブート イメージのプロパティを変更するには  

1.  Configuration Manager コンソールで、**[ソフトウェア ライブラリ]** をクリックします。  

2.  **[ソフトウェア ライブラリ]** ワークスペースで **[オペレーティング システム]** を展開し、**[ブート イメージ]** をクリックします。  

3.  変更するブート イメージを選択します。  

4.  **[ホーム]** タブの **[プロパティ]** グループで **[プロパティ]** をクリックして、ブート イメージの **[プロパティ]** ダイアログ ボックスを開きます。  

5.  ブート イメージの動作を変更するには、以下の設定を行います。  

    -   外部ツールを使用してブート イメージのプロパティを変更した場合は、**[イメージ]** タブで **[再読み込み]** をクリックします。  

    -   **[ドライバー]** タブで、WinPE をブートするために必要な Windows デバイス ドライバーを追加します。 デバイス ドライバーを追加する際には、以下の点を考慮してください。  

        -   **[ブート イメージのアーキテクチャに一致しないドライバーを非表示にする]** を選び、ブート イメージのアーキテクチャのドライバーのみを表示します。 アーキテクチャは、製造元が提供する INF で報告されるアーキテクチャに基づいています。  

        -   **[Hide drivers that are not in a storage or network class (for boot images)]\((ブート イメージの) ストレージまたはネットワーク クラスにないドライバーを非表示にする\)** を選択して、ストレージとネットワーク ドライバーのみを表示します。 このオプションは、ビデオやモデム ドライバーなど、通常はブート イメージに必要ない他のドライバーも非表示にします。  

        -   **[デジタル署名されていないドライバーを非表示にする]** を選び、有効なデジタル署名がないドライバーを非表示にします。  

        -   WinPE で他のドライバーの要件がない場合は、最適な方法として、ネットワーク ドライバーと大容量記憶装置ドライバーのみブート イメージに追加します。  

        -   WinPE には多くの組み込みドライバーが既に付属しているため、WinPE で提供されないネットワーク ドライバーと大容量記憶装置ドライバーのみ追加します。  

        -   ブート イメージに追加するドライバーがブート イメージのアーキテクチャと一致していることを確認します。  

        > [!NOTE]  
        >  ブート イメージに追加する前に、デバイス ドライバーをドライバー カタログにインポートする必要があります。 デバイス ドライバーをインポートする方法については、「[ドライバーの管理](manage-drivers.md)」を参照してください。  

    -   **[カスタマイズ]** タブで、以下の設定を選択します。  

        -   **[起動前コマンドを有効にする]** チェック ボックスをオンにして、タスク シーケンスを実行する前に実行するコマンドを指定します。 このオプションを有効にする場合は、実行するコマンド ラインと、コマンドに必要なサポート ファイルも指定します。  

            > [!WARNING]  
            >  **cmd /c** をコマンドラインの先頭に追加します。 **cmd /c** を指定しない場合、実行後にコマンドが閉じられません。 展開がコマンドの完了を待機し続けて、その他の構成済みのコマンドや操作が開始されません。  

            > [!TIP]  
            >  タスク シーケンス メディアの作成中に、ウィザードによって、パッケージ ID と起動前コマンド ライン (タスク シーケンスの変数の値を含む) が、CreateTSMedia.log というログ ファイルに書き込まれます。 このログは、Configuration Manager コンソールを実行しているコンピューター上にあります。 このログ ファイルで、タスク シーケンス変数の値を確認します。  

        -   **[Windows PE の背景]** 設定を構成して、既定の WinPE の背景またはカスタムの背景のいずれを使用するのかを指定します。  

        -   ブート イメージの展開時に **F8** キーを使用してコマンド プロンプトを開くには、 **[コマンド サポートを有効にする (テストのみ)]** を選びます。 このオプションは、展開をテストする際のトラブルシューティングに役立ちます。 実稼働環境の展開でこの設定を使用することは推奨されません。  

        -   Windows PE のスクラッチ領域を構成します。これは、WinPE で使用される一時記憶域 (RAM ドライブ) です。 たとえば、WinPE 内で実行するアプリケーションが一時ファイルに書き込む必要がある場合、WinPE はメモリ内のスクラッチ領域にファイルをリダイレクトすることで、ハード ディスクが存在することをシミュレートします。 既定で、WinPE は 32 メガバイト (MB) の書き込み可能メモリを割り当てています。  

    -   **[データ ソース]** タブで、以下の設定を更新します。  

        -   ブート イメージのソース ファイルを変更するには、 **[イメージ パス]** と **[イメージ インデックス]** を設定します。  

        -   サイトでブート イメージを更新するスケジュールを作成するには、**[スケジュールに従って配布ポイントを更新する]** を選びます。  

        -   別のコンテンツ用の容量を確保するために、このパッケージのコンテンツのクライアント キャッシュを期限切れにする必要がない場合、 **[クライアント キャッシュの内容を保持する]** を選びます。  

        -   配布ポイントでブート イメージ パッケージが更新された場合に、変更のあったファイルのみ配布するように指定するには、 **[バイナリ差分レプリケーションを有効にする]** (BDR) を選びます。 この設定は、サイト間のネットワーク トラフィックを最小限に抑えます。 BDR は、ブート イメージ パッケージが大きく、変更が比較的少ない場合に特に便利です。  

        -   ブート イメージを PXE 対応の展開で使用する場合、**[このブート イメージを PXE 対応の配布ポイントから展開する]** を選びます。  

            > [!NOTE]  
            >  詳細については、「[PXE を使用したネットワーク経由での Windows の展開](../deploy-use/use-pxe-to-deploy-windows-over-the-network.md)」を参照してください。  

    -   **[データ アクセス]** タブで、以下の設定を選択します。  

        -   クライアントでこのパッケージのコンテンツをネットワークからインストールする場合は、**[パッケージ共有の設定]** を設定します。  

        -   **[パッケージの更新設定]** を設定して、Configuration Manager で配布ポイントからユーザーを切断する方法を指定します。 ユーザーが配布ポイントに接続されていると、Configuration Manager がブート イメージを更新できない場合があります。  

    -   **[配布の設定]** タブで、以下の設定を選択します。  

        -   **[配布の優先順位]** リストで、優先度レベルを指定します。 Configuration Manager は、サイトで複数のパッケージを同じ配布ポイントに配布するときに、この優先順位リストを使用します。  

        -   優先配布ポイントへのオンデマンドのコンテンツ配布を有効にする場合、**[このパッケージのコンテンツを優先配布ポイントに配布する]** を選びます。 この設定を有効にすると、クライアントがパッケージのコンテンツを要求し、そのコンテンツが優先配布ポイントにないときは、管理ポイントはすべての優先配布ポイントにコンテンツを配布します。  

        -   事前設定済みコンテンツが有効になっている配布ポイントにブート イメージを配布する方法を指定するには、**[事前設定された配布ポイントの設定]** を設定します。  

            > [!NOTE]  
            >  事前設定済みコンテンツについて詳しくは、「 [Prestage content](/sccm/core/servers/deploy/configure/deploy-and-manage-content#bkmk_prestage)」をご覧ください。  

    -   **[コンテンツの場所]** タブで、配布ポイントまたは配布ポイント グループを選択して、次の操作を実行します。  

        -   選択した配布ポイントまたは配布ポイント グループに再度ブート イメージを配布するには、**[再配布]** をクリックします。  

        -   選択した配布ポイントまたは配布ポイント グループのブート イメージ パッケージの整合性を確認するには、**[検証]** をクリックします。  

    -   **[オプション コンポーネント]** タブで、Configuration Manager で使用するために Windows PE に追加するコンポーネントを指定します。 使用可能なオプション コンポーネントの詳細については、[WinPE: パッケージの追加 (オプション コンポーネント リファレンス)](https://docs.microsoft.com/windows-hardware/manufacture/desktop/winpe-add-packages--optional-components-reference) に関するページを参照してください。  

    -   **[セキュリティ]** タブで、管理ユーザーを選択して、その管理ユーザーが実行できる操作を変更します。  

6.  プロパティを構成したら、**[OK]** をクリックします。  

##  <a name="BKMK_BootImagePXE"></a> PXE 対応の配布ポイントから展開するブート イメージの構成  
 PXE オペレーティング システムの展開用ブート イメージを使用するには、PXE 対応の配布ポイントから展開するブート イメージをあらかじめ構成する必要があります。  

#### <a name="to-configure-a-boot-image-to-deploy-from-a-pxe-enabled-distribution-point"></a>PXE 対応の配布ポイントから展開するブート イメージを構成するには  

1.  Configuration Manager コンソールで、**[ソフトウェア ライブラリ]** をクリックします。  

2.  **[ソフトウェア ライブラリ]** ワークスペースで **[オペレーティング システム]** を展開し、**[ブート イメージ]** をクリックします。  

3.  変更するブート イメージを選択します。  

4.  **[ホーム]** タブの **[プロパティ]** グループで **[プロパティ]** をクリックして、ブート イメージの **[プロパティ]** ダイアログ ボックスを開きます。  

5.  **[データ ソース]** タブで、 **[このブート イメージを PXE 対応の配布ポイントから展開する]** を選びます。  

    > [!NOTE]  
    >  詳細については、「[PXE を使用したネットワーク経由での Windows の展開](../deploy-use/use-pxe-to-deploy-windows-over-the-network.md)」を参照してください。  

6.  プロパティを構成したら、**[OK]** をクリックします。  

##  <a name="BKMK_BootImageLanguage"></a> ブート イメージの展開のための複数言語の構成  
 ブート イメージは言語に依存しません。 この機能により、1 つのブート イメージを使用して、WinPE でタスク シーケンス テキストを複数の言語で表示することができます。 ブート イメージの **[オプション コンポーネント]** タブから適切な言語のサポートを含めます。次に、表示する言語を示すための適切なタスク シーケンス変数を設定します。 展開されたオペレーティング システムの言語は、WinPE の言語に依存しません。 WinPE でユーザーに表示される言語は、次のように決定されます。  

- ユーザーが既存のオペレーティング システムからタスク シーケンスを実行すると、Configuration Manager はユーザー用に構成された言語を自動的に使用します。 必須の展開期限の結果としてタスク シーケンスが自動的に実行された場合、Configuration Manager はオペレーティング システムの言語を使用します。  

- PXE またはメディアを使用するオペレーティング システム展開の場合、起動前コマンドの一部として **SMSTSLanguageFolder** 変数で言語 ID 値を設定します。 コンピューターを WinPE で起動すると、変数で指定した言語でメッセージが表示されます。 指定したフォルダーの言語リソース ファイルにアクセスできない場合、または変数を設定しなかった場合、WinPE ではメッセージが既定の言語で表示されます。  

  > [!NOTE]  
  >  メディアがパスワードで保護されている場合、パスワードの入力をユーザーに求めるテキストは、常に WinPE の言語で表示されます。  

  PXE またはメディアから開始されたオペレーティング システムの展開の場合、次の手順で WinPE の言語を設定します。  

#### <a name="to-set-the-windows-pe-language-for-a-pxe-or-media-initiated-operating-system-deployment"></a>PXE またはメディアから開始されたオペレーティング システムの展開の場合に Windows PE の言語を設定するには  

1.  ブート イメージを更新する前に、適切なタスク シーケンス リソース ファイル (tsres.dll) がサイト サーバーの対応する言語フォルダー内にあることを確認します。 たとえば、英語版のリソース ファイルは <*ConfigMgrInstallationFolder*>\OSD\bin\x64\00000409\tsres.dll にあります。  

2.  起動前コマンドの一部として、SMSTSLanguageFolder 環境変数を適切な言語 ID に設定します。 言語 ID は、16 進数ではなく 10 進数を使用して指定する必要があります。 たとえば、言語 ID を英語に設定するには、フォルダー名の 16 進数の 00000409 ではなく、10 進数の 1033 を指定します。  

---
title: データ ウェアハウス
titleSuffix: Configuration Manager
description: Configuration Manager のデータ ウェアハウス サービス ポイントとデータベース
ms.date: 11/27/2018
ms.prod: configuration-manager
ms.technology: configmgr-other
ms.topic: conceptual
ms.assetid: aaf43e69-68b4-469a-ad58-9b66deb29057
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 0c04ee9a62b6c629060f79df2f4b104fe78ca794
ms.sourcegitcommit: 48098f9fb2f447672bf36d50c9f58a3d26acb9ed
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/14/2018
ms.locfileid: "53418987"
---
#  <a name="the-data-warehouse-service-point-for-configuration-manager"></a>Configuration Manager のデータ ウェアハウス サービス ポイント

「オブジェクトの*適用対象: System Center Configuration Manager (Current Branch)*

<!--1277922--> データ ウェアハウス サービス ポイントを使用して、Configuration Manager 展開の長期的な履歴データを格納およびレポートします。

> [!Note]  
> Configuration Manager では、このオプション機能は既定で無効です。 この機能は、使用する前に有効にする必要があります。 詳細については、「[更新プログラムのオプション機能の有効化](/sccm/core/servers/manage/install-in-console-updates#bkmk_options)」を参照してください。<!--505213-->  


データ ウェアハウスでは、最大 2 TB のデータをサポートし、変更追跡にはタイムスタンプが使用されます。 データ ウェアハウスでは、Configuration Manager サイト データベースからデータ ウェアハウス データベースにデータを自動的に同期することで、データを格納します。 その後、レポート サービス ポイントからこの情報にアクセスできます。 データ ウェアハウス データベースに同期されたデータは、3 年間保持されます。 3 年を経過したデータは、組み込みタスクによって定期的に削除されます。

同期されるデータには、グローバル データ グループとサイト データ グループからの次のデータが含まれます。
- インフラストラクチャの正常性
- セキュリティ
- コンプライアンス
- マルウェア   
- ソフトウェアの展開
- インベントリの詳細 (ただし、インベントリの履歴は同期されない)

サイト システムの役割のインストール時には、データ ウェアハウス データベースがインストールされて構成されます。 いくつかのレポートもインストールされるため、データを簡単に検索してレポートすることができます。

バージョン 1810 以降では、サイト データベースからより多くのテーブルをデータ ウェアハウスに同期できます。 この変更により、お客様のビジネス要件に基づいてより多くのレポートを作成することができます。<!--1358870--> 



## <a name="prerequisites"></a>[前提条件]

- データ ウェアハウス サイト システムの役割は、階層の最上位サイトでのみサポートされます  (たとえば、中央管理サイトやスタンドアロン プライマリ サイト)。  

- サイト システムのロールをインストールするコンピューターには、.NET Framework 4.5.2 以降が必要です。  

- **レポート サービス ポイントのアカウント**に、データ ウェアハウス データベースの **db_datareader** アクセス許可を付与します。  

- データをデータ ウェアハウス データベースと同期するために、Configuration Manager ではサイト システム役割のコンピューター アカウントが使用されます。 このアカウントには次の権限が必要です。  

    - データ ウェアハウス データベースをホストするコンピューターの**管理者**。  

    - データ ウェアハウス データベースの **DB_Creator** 権限。  

    - 最上位サイトのデータベースに対する**実行** が可能な **DB_owner** または **DB_reader** 権限。  

- データ ウェアハウス データベースでは、SQL Server 2012 以降を使用する必要があります。 Standard、Enterprise、または Datacenter Edition が利用できます。 データ ウェアハウスの SQL Server バージョンは、サイト データベース サーバーと同じである必要はありません。<!--SCCMDocs issue 662-->  

- ウェアハウス データベースでは、次の SQL Server 構成がサポートされています。  

    - 既定のインスタンス、または名前付きインスタンス  

    - SQL Server AlwaysOn 可用性グループ  

    - SQL Server フェールオーバー クラスター  

- [分散ビュー](/sccm/core/servers/manage/data-transfers-between-sites#bkmk_distviews)を使用する場合、中央管理サイトのデータベースをホストしているのと同じサーバーに、データ ウェアハウス サービス ポイントをインストールする必要があります。  

SQL Server ライセンスの詳細については、[製品とライセンスに関する FAQ](/sccm/core/understand/product-and-licensing-faq) を参照してください。 <!-- sms500967 -->

データ ウェアハウス データベースのサイズを、ご利用のサイト データベースと同じになるように設定します。 データ ウェアハウスは最初は小さいサイズですが、時間の経過と共に大きくなります。 <!--SCCMDocs issue 756-->



## <a name="install"></a>[インストール]

最上位層サイトのどのサイト システムでも、各階層でこの役割の単一インスタンスがサポートされます。 ウェアハウスのデータベースをホストする SQL Server は、サイト システムの役割に対してローカルまたはリモートに配置できます。 データ ウェアハウスは、同じサイトにインストールされているレポート サービス ポイントで動作します。 同じサーバー上に 2 つのサイト システムの役割をインストールする必要はありません。   

役割をインストールするには、**[サイト システムの役割の追加ウィザード]** または **[サイト システム サーバーの作成ウィザード]** を使用します。 詳しくは、「[サイト システムの役割のインストール](/sccm/core/servers/deploy/configure/install-site-system-roles)」をご覧ください。 ウィザードの **[システムの役割の選択]** ページで、**[データ ウェアハウス サービス ポイント]** の役割を選択します。 

ロールをインストールすると、指定した SQL Server のインスタンス上にデータ ウェアハウス データベースが Configuration Manager によって作成されます。 既存のデータベースの名前を指定すると、Configuration Manager で新しいデータベースが作成されません。 代わりに、ユーザーが指定したものが使用されます。 このプロセスは、[データ ウェアハウス データベースを新しい SQL Server に移動する](#move-the-data-warehouse-database)場合と同じです。


### <a name="configure-properties"></a>プロパティの構成

#### <a name="general-page"></a>全般ページ

- **SQL Server の完全修飾ドメイン名**:データ ウェアハウス サービス ポイント データベースをホストするサーバーの完全修飾ドメイン名 (FQDN) を指定します。  

- **SQL Server インスタンス名 (該当する場合)**:SQL Server の既定のインスタンスを使用しない場合は、名前付きインスタンスを指定します。  

- **データベース名**:データ ウェアハウス データベースの名前を指定します。 Configuration Manager はこの名前を使用して、データ ウェアハウス データベースを作成します。 SQL server のインスタンスに既に存在しているデータベース名を指定した場合、Configuration Manager はそのデータベースを使用します。  

- **接続に使用するSQL Server ポート**:データ ウェアハウス データベースをホストする SQL Server によって使われる TCP/IP ポート番号を指定します。 データ ウェアハウスの同期サービスでは、このポートを使用してデータ ウェアハウス データベースに接続します。 既定では、通信に SQL Server ポート **1433** が使用されます。  

- **データ ウェアハウス サービス ポイント アカウント**:バージョン 1802 以降では、SQL Server Reporting Services でデータ ウェアハウス データベースに接続するときに使用される**ユーザー名**を設定します。  


#### <a name="synchronization-schedule-page"></a>同期のスケジュール ページ
*適用対象: バージョン 1806 以前*

- **開始時刻**:データ ウェアハウスの同期を開始する時刻を指定します。  

- **繰り返しパターン**

    - **毎日**:同期が毎日実行されるように指定します。  

    - **毎週**:各週の曜日を 1 つ指定して、同期が毎週繰り返されるようにします。


#### <a name="synchronization-settings-page"></a>同期の設定ページ
*適用対象: バージョン 1810 以降*

- **データ同期のカスタム設定**:**[テーブルの選択]** オプションを選択します。 [データベース テーブル] ウィンドウで、データ ウェアハウス データベースに同期するテーブル名を選択します。 フィルターを使用して名前で検索するか、ドロップダウン リストを選択して特定のグループを選択します。 完了して保存する場合は、**[OK]** を選択します。  

    > [!Note]  
    > 既定では、役割で選択するテーブルは削除できません。  

- **開始時刻**:データ ウェアハウスの同期を開始する時刻を指定します。  

- **繰り返しパターン**

    - **毎日**:同期が毎日実行されるように指定します。  

    - **毎週**:各週の曜日を 1 つ指定して、同期が毎週繰り返されるようにします。



## <a name="reporting"></a>レポート

データ ウェアハウス サービス ポイントをインストールした後、サイトのレポート サービス ポイントでいくつかのレポートが使用できるようになります。 レポート サービス ポイントをインストールする前にデータ ウェアハウス サービス ポイントをインストールした場合は、後でレポート サービス ポイントをインストールしたときにレポートが自動的に追加されます。

> [!WARNING]  
> バージョン 1802 以降では、データ ウェアハウス ポイントで代替資格情報がサポートされます。<!--507334--> 以前のバージョンの Configuration Manager からアップグレードした場合は、SQL Server Reporting Services でデータ ウェアハウス データベースに接続するために使用される資格情報を指定する必要があります。 資格情報を追加するまで、データ ウェアハウスのレポートは開きません。 
> 
> アカウントを指定するには、役割プロパティでデータ ウェアハウス サービス ポイント アカウントの**ユーザー名**を設定します。 詳細については、「[Configure properties](#configure-properties)」 (プロパティの構成) を参照してください。 

データ ウェアハウス サイト システムの役割には、**データ ウェアハウス** カテゴリの、次のレポートが含まれます。  

- **アプリケーションの展開 - 履歴**:特定のアプリケーションとコンピューターについてアプリケーション展開の詳細を表示します。  

- **EndPoint Protection とソフトウェア更新プログラムのコンプライアンス - 履歴**:ソフトウェアの更新プログラムが欠落しているコンピューターを表示します。  

- **全般的なハードウェアのインベントリ - 履歴**:特定のコンピューターのすべてのハードウェア インベントリを表示します。  

- **全般的なソフトウェアのインベントリ - 履歴**:特定のコンピューターのすべてのソフトウェア インベントリを表示します。  

- **インフラストラクチャの正常性の概要 - 履歴**:Configuration Manager のインフラストラクチャの正常性の概要を表示します。  

- **検出されたマルウェアの一覧 - 履歴**:  組織内で検出されたマルウェアを表示します。  

- **ソフトウェア配布の概要 - 履歴**:特定の提供情報を目的とし特定のコンピューターを対象としたソフトウェアの配布の概要。  



## <a name="site-expansion"></a>サイトの拡張

中央管理サイトをインストールして既存のスタンドアロン プライマリ サイトを拡張する前に、まず、データ ウェアハウス サービス ポイントの役割をアンインストールします。 中央管理サイトをインストールした後に、中央管理サイトでサイト システムの役割をインストールすることができます。  

データ ウェアハウス データベースの移動とは異なり、この変更によって以前にプライマリ サイトで同期した履歴データが失われます。 プライマリ サイトからデータベースをバックアップして、中央管理サイトで復元することはサポートされていません。



## <a name="move-the-database"></a>データベースの移動

データ ウェアハウス データベースを新しい SQL Server に移動するには、次の手順に従います。  

1. SQL Server Management Studio を使用して、データ ウェアハウス データベースをバックアップします。 次に、そのデータベースをデータ ウェアハウスをホストしている新しいコンピューター上の SQL Server に復元します。  

    > [!NOTE]  
    > 新しいサーバーにデータベースを復元した後、新しいデータ ウェアハウス データベースに対するデータベース アクセス許可が、元のデータ ウェアハウス データベースの場合と同じであることを確認します。  

2. Configuration Manager コンソールを使用して、データ ウェアハウス サービス ポイントの役割を現在のサーバーから削除します。  

3. データ ウェアハウス サービス ポイントを再インストールします。 新しい SQL Server の名前と、復元されたデータ ウェアハウス データベースをホストするインスタンスを指定します。  

4. サイト システムのロールがインストールされたら、移動は完了です。  



## <a name="troubleshooting"></a>トラブルシューティング 

### <a name="log-files"></a>ログ ファイル 

データ ウェアハウス サービス ポイントのインストールまたはデータの同期に関する問題を調査するには、次のログを使用します。

- **DWSSMSI.log** と **DWSSSetup.log**:データ ウェアハウス サービス ポイントのインストール時に発生したエラーを調査する場合に、これらのログを使用します。  

- **Microsoft.ConfigMgrDataWarehouse.log**:サイト データベースとデータ ウェアハウス データベースの間のデータ同期について調査する場合に、このログを使用します。  


### <a name="set-up-failure"></a>セットアップの失敗 

データ ウェアハウス サービス ポイントの役割が、リモート サーバーにインストールする最初のものである場合、データ ウェアハウスのインストールは失敗します。  

#### <a name="workaround"></a>回避策 
データ ウェアハウス サービス ポイントをインストールするコンピューターで、既に他の 1 つ以上の役割がホストされていることを確認します。  


### <a name="synchronization-failed-to-populate-schema-objects"></a>同期でスキーマ オブジェクトを取り込めない 

同期に失敗し、**Microsoft.ConfigMgrDataWarehouse.log** に `failed to populate schema objects` というメッセージが表示されます。

#### <a name="workaround"></a>回避策 
サイト システム役割のコンピューター アカウントが、データ ウェアハウス データベースで **db_owner** であることを確認します。


### <a name="reports-fail-to-open"></a>レポートが開けない

データ ウェアハウス データベースとレポート サービス ポイントが別のサイト システムにあるとき、データ ウェアハウスのレポートを開くことができません。  

#### <a name="workaround"></a>回避策
**レポート サービス ポイントのアカウント**に、データ ウェアハウス データベースの **db_datareader** アクセス許可を付与します。


### <a name="error-opening-reports"></a>レポートを開くときのエラー

データ ウェアハウス レポートを開くと、次のエラーが返されます。

```
An error has occurred during report processing. (rsProcessingAborted)
Cannot create a connection to data source 'AutoGen__39B693BB_524B_47DF_9FDB_9000C3118E82_'. (rsErrorOpeningConnection)
A connection was successfully established with the server, but then an error occurred during the pre-login handshake. (provider: SSL Provider, error: 0 - The certificate chain was issued by an authority that is not trusted.)
```

#### <a name="workaround"></a>回避策 
次の手順を使用して、証明書を構成します。

1. データ ウェアハウス データベースをホストするコンピューターで、  

    1. IIS を開き、**[サーバー証明書]** を選択してから **[自己署名入り証明書の作成]** を右クリックします。 次に、証明書名の "フレンドリ名" を **Data Warehouse SQL Server Identification Certificate (データ ウェアハウス SQL サーバーの識別証明書)** に指定します。 証明書ストアを **[個人]** として選択します。  

    2. **[SQL Server 構成マネージャー]** を開きます。 **[SQL Server ネットワークの構成]** の下にある **[MSSQLSERVER のプロトコル]** で、右クリックして **[プロパティ]** を選択します。 **[証明書]** タブに切り替え、**[Data Warehouse SQL Server Identification Certificate] (データ ウェアハウス SQL サーバーの識別証明書)** を証明書として選択し、変更を保存します。  

    3. **SQL Server 構成マネージャー**の **[SQL Server サービス]** で、**SQL Server サービス**と**レポート サービス**の各サービスを再開します。  

    4. Microsoft 管理コンソール (MMC) を開き、**証明書**スナップインを追加します。 ローカル コンピューターの **[コンピューター アカウント]** を選択します。 **[個人用]** フォルダーを展開し、**[証明書]** を選択します。 **Data Warehouse SQL Server Identification Certificate (データ ウェアハウス SQL サーバーの識別証明書)** を **DER encoded binary X.509 (.CER)** ファイルとしてエクスポートします。  

2. SQL Server Reporting Services をホストするコンピューターで、MMC を開いて**証明書**スナップインを追加します。 **[コンピューター アカウント]** を選択します。 **[信頼されたルート証明機関]** フォルダーで、**Data Warehouse SQL Server Identification Certificate (データ ウェアハウス SQL サーバーの識別証明書)** をインポートします。  



## <a name="data-flow"></a>データ フロー   

![データ ウェアハウスのサイト コンポーネント間の論理的なデータフローを示す図](./media/datawarehouse.png)

#### <a name="data-storage-and-synchronization"></a>データの格納と同期

| 手順   | 詳細  |
|--------|----------|  
| **1**  | サイト サーバーは、サイト データベースにデータを転送して格納します。 |  
| **2**  | データ ウェアハウス サービス ポイントでは、スケジュールと構成に基づいて、サイト データベースからデータを取得します。 |  
| **3**  | データ ウェアハウス サービス ポイントでは、同期されたデータのコピーをデータ ウェアハウス データベースに転送して保存します。 |  


#### <a name="reporting"></a>レポート

| 手順   | 詳細  |
|--------|----------|  
| **A**  | 組み込みのレポート機能を使用して、ユーザーがデータを要求します。 この要求は SQL Server Reporting Services を使用して Reporting Services ポイントに渡されます。 |  
| **B**  | レポートの大部分は最新の情報に関するものです、これらの要求は、サイト データベースに対して実行されます。 |  
| **C**  | レポートで、*カテゴリ* が**データ ウェアハウス**になっているレポートの 1 つを使用して、履歴データを要求する場合、データ ウェアハウス データベースに対して要求が実行されます。 |  

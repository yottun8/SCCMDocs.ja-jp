---
title: クライアントをウェイク アップする
titleSuffix: Configuration Manager
description: Wake On LAN (WOL) を使用して System Center Configuration Manager でクライアントをウェイク アップする方法を計画します。
ms.date: 05/23/2018
ms.prod: configuration-manager
ms.technology: configmgr-client
ms.topic: conceptual
ms.assetid: 52ee82b2-0b91-4829-89df-80a6abc0e63a
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.collection: M365-identity-device-management
ms.openlocfilehash: 8ad20f88d6296a45c97e7c04d94624f9341d369e
ms.sourcegitcommit: 874d78f08714a509f61c52b154387268f5b73242
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/12/2019
ms.locfileid: "56125978"
---
# <a name="plan-how-to-wake-up-clients-in-system-center-configuration-manager"></a>System Center Configuration Manager でクライアントをウェイク アップする方法を計画します

*適用対象: System Center Configuration Manager (Current Branch)*

 Configuration Manager では、ソフトウェア更新プログラムやアプリケーションなど、必要なソフトウェアをインストールするときにコンピューターをスリープ モードから復帰させる、従来のウェイクアップ パケットがサポートされています。  

ウェイクアップ プロキシ クライアント設定を使用して、従来のウェイクアップ パケット方式を補うことができます。 ウェイクアップ プロキシは、ピアツーピア プロトコルと選択されたコンピューターを使用して、サブネットの他のコンピューターが起動状態かどうかを確認し、必要に応じて起動できます。 サイトで Wake On LAN が構成され、クライアントでウェイクアップ プロキシが構成されている場合、処理は次のようになります。  

1. Configuration Manager クライアントがインストールされていて、スリープ中ではないサブネットのコンピューターが、サブネットのその他のコンピューターが起動状態かどうかを確認します。 この確認は、互いに TCP/IP ping コマンドを 5 秒ごとに送信することで行われます。  

2. その他のコンピューターから応答がない場合、スリープ中と判断します。 起動状態のコンピューターは、サブネットの*管理コンピューター*になります。  

    スリープ以外の理由 (たとえば、電源オフ、ネットワークからの削除、プロキシ ウェイクアップ クライアント設定が適用されていないなど) でコンピューターが応答しない可能性もあるため、毎日ローカル時刻の 午後 2 時に、コンピューターにウェイクアップ パケットが送信されます。 応答しないコンピューターは、以降、スリープ状態ではないと判断され、ウェイクアップ プロキシで起動されなくなります。  

    ウェイクアップ プロキシをサポートするには、サブネットごとに少なくとも 3 台のコンピューターが起動状態である必要があります。 この要件を満たすため、3 台のコンピューターが、サブネットの*ガーディアンのコンピューター*として無作為に選択されます。 つまり、対象のコンピューターは、一定の非アクティブ期間後にスリープまたはハイバネーションに移行する電源ポリシーが構成されているかどうかに関係なく、起動状態が継続されます。 ガーディアンのコンピューターでは、メンテナンス作業などで発生するシャットダウンまたは再起動のコマンドは実行されます。 シャットダウンまたは再起動が実行された場合、残りのガーディアンのコンピューターは、サブネットに 3 台のガーディアンのコンピューターが存在する状態を維持するため、サブネットの別のコンピューターをウェイク・アップします。  

3. 管理コンピューターは、スリープ中のコンピューターへのトラフィックを管理コンピューターにリダイレクトするように、ネットワーク スイッチに通知します。  

    このリダイレクトは、スリープ状態のコンピューターの MAC アドレスをソース アドレスとして使用するイーサネット フレームをブロードキャストする、マネージャー コンピューターが行います。 この動作により、ネットワーク スイッチは、マネージャー コンピューターが配置されているのと同じポートにスリープ状態のコンピューターが移動したかのように動作します。 また、マネージャー コンピューターは、スリープ状態のコンピューターで ARP キャッシュ内のエントリが常に最新の状態になるように、ARP パケットを送信します。 さらに、マネージャー コンピューターは、スリープ状態のコンピューターに代わって ARP 要求に応答し、スリープ状態のコンピューターの MAC アドレスで応答します。  

   > [!WARNING]  
   >  この処理の間、スリープ状態のコンピューターの IP と MAC 間のマッピングは変更されません。 ウェイクアップ プロキシは、別のネットワーク アダプターで登録されたポートが異なるネットワーク アダプターで使用されていることをネットワーク スイッチに通知することで機能します。 ただし、この動作は MAC フラップと呼ばれ、標準のネットワーク運用では異常となります。 ネットワーク監視ツールには、この動作を検出して、問題が発生したと見なすものもあります。 そのため、ウェイクアップ プロキシを使用すると、これらの監視ツールがアラートを生成したりポートをシャットダウンする可能性があります。  
   >   
   >  使用するネットワーク監視ツールとサービスで MAC フラップを許可していない場合は、ウェイクアップ プロキシを使用しないでください。  

4. マネージャー コンピューターがスリープ状態のコンピューターの新しい TCP 接続要求を検出し、その要求が、スリープ状態のコンピューターがスリープ状態になる前にリッスンしていたポートに対するものである場合、マネージャー コンピューターはスリープ状態のコンピューターにウェイクアップ パケットを送信してから、このコンピューターへのトラフィックのリダイレクトを停止します。  

5. スリープ状態のコンピューターが、ウェイクアップ パケットを受信して起動します。 送信元コンピューターは接続を自動的に再試行し、コンピューターが起動して応答できるようになります。  

   ウェイクアップ プロキシには、次の要件と制限があります。  

> [!IMPORTANT]  
>  別のチームがネットワーク インフラストラクチャとネットワーク サービスを担当している場合は、このチームに通知して、評価期間とテスト期間はこのチームを含めるようにします。 たとえば、802.1X ネットワーク アクセス制御を使用しているネットワークでは、ウェイクアップ プロキシは動作しないため、ネットワーク サービスの中断が生じる可能性があります。 また、ウェイクアップ プロキシのために、一部のネットワーク監視ツールでは、他のコンピューターを起動するトラフィックを検出すると、アラートを生成する可能性があります。  

-   [クライアントとデバイスでサポートされるオペレーティング システム](/sccm/core/plan-design/configs/supported-operating-systems-for-clients-and-devices)に関するページでサポート対象クライアントとして示されているすべての Windows オペレーティング システムは、Wake On LAN に対応しています。  

-   バーチャル マシンで実行されるゲスト オペレーティング システムはサポートされません。  

-   クライアント設定を使ってクライアントでウェイクアップ プロキシが有効になっている必要があります。 ウェイクアップ プロキシ処理はハードウェア インベントリに依存しませんが、クライアントでハードウェア インベントリが有効になっており、少なくとも 1 つのハードウェア インベントリが送信されていない限り、クライアントはウェイクアップ プロキシ サービスのインストールをレポートしません。  

-   ネットワーク アダプター (および、場合によっては BIOS) が有効になっており、ネットワーク アダプターにウェイクアップ パケットが構成されている必要があります。 ネットワーク アダプターにウェイクアップ パケットが構成されていない場合や、この設定が無効になっている場合は、Configuration Manager がウェイクアップ プロキシを有効にするクライアント設定を受信すると、この設定が自動的にコンピューターに構成されて有効になります。  

-   コンピューターに複数のネットワーク アダプターがある場合、どのアダプターをウェイクアップ プロキシに使用するのか構成することはできません。アダプターは無作為に選択されます。 ただし、選択されたアダプターは SleepAgent<DOMAIN\>@SYSTEM_0.log ファイルに記録されます。  

-   ネットワークで ICMP エコー要求を許可 (少なくともサブネット内) する必要があります。 ICMP Ping コマンドの送信に使用する 5 秒間隔を構成することはできません。  

-   通信は暗号化されず、認証されません。また、IPsec はサポートされません。  

-   次のネットワーク構成はサポートされません。  

    -   ポート認証を使用する 802.1X  

    -   ワイヤレス ネットワーク  

    -   MAC アドレスを特定のポートとバインドするネットワーク スイッチ  

    -   IPv6 のみのネットワーク  

    -   24 時間未満の DHCP リース期間  

スケジュールに従ってソフトウェアをインストールするときにコンピューターをウェイクアップしたい場合は、各プライマリ サイトでウェイクアップ パケットを使用するよう構成する必要があります。  

 ウェイクアップ プロキシを使用するには、プライマリ サイトを構成することに加えて、電源管理のウェイクアップ プロキシ クライアント設定も展開する必要があります。  

サブネット向けのブロードキャスト パケットとユニキャスト パケットのどちらを使用するか、またどの UDP ポート番号を使用するかを決定します。 既定では、従来のウェイクアップ パケットは UDP 9 番ポートを使用して送信されます。ただし、介在するルーターとファイアウォールが別のポートをサポートしている場合は、そのポートを選択してセキュリティを強化することができます。  

### <a name="choose-between-unicast-and-subnet-directed-broadcast-for-wake-on-lan"></a>Wake-on-LAN におけるユニキャストとサブネット向けブロードキャストの比較  
 従来のウェイクアップ パケットでコンピューターをウェイクアップする場合は、ユニキャスト パケットとサブネット向けのブロードキャスト パケットのどちらを送信するかを決める必要があります。 ウェイクアップ プロキシを使用する場合、ユニキャスト パケットを使用する必要があります。 そうでない場合は、どの送信方法を選択するか判断するときに、次の表をご覧ください。  

|送信方法|長所|短所|  
|-------------------------|---------------|------------------|  
|ユニキャスト|パケットが、サブネット上のすべてのコンピューターにではなく、1 台のコンピューターに直接送信されるので、サブネット向けのブロードキャストより安全です。<br /><br /> ルーターを再構成しなくてもよい場合があります (ARP キャッシュを構成しなければならない可能性があります)。<br /><br /> サブネット向けのブロードキャスト送信よりも、使用するネットワーク帯域幅が小さくて済みます。<br /><br /> IPv4 と IPv6 でサポートされています。|最後に実行された定期ハードウェア インベントリの後で、送信先コンピューターのサブネット アドレスが変更された場合は、ウェイクアップアップ パケットが、そのコンピューターを見つけられなくなります。<br /><br /> UDP パケットを転送するために、スイッチを構成しなければならない場合があります。<br /><br /> ネットワーク アダプターによっては、ユニキャストのウェイクアップ パケットに応答しないスリープ モードを持っている場合があります。|  
|サブネット向けブロードキャスト|コンピューターの IP アドレスが同じサブネット内で頻繁に変わる場合は、ユニキャストよりも成功率が高くなります。<br /><br /> スイッチの再構成は必要ありません。<br /><br /> コンピューターのアダプターのすべてのスリープ モードに対応している可能性が高くなります。これは、元々、サブネット向けブロードキャストが、ウェイクアップ パケットの送信方法だったからです。|ユニキャストより安全性が低くなります。これは、攻撃者が偽のソース アドレスからサブネット向けブロードキャスト アドレスに ICMP エコー要求の連続ストリームを送信可能なためです。 この場合は、すべてのホストがそのソース アドレスに応答することになります。 ルーターでサブネット向けブロードキャストが許可される場合は、セキュリティを強化するために、次のように構成することをお勧めします。<br /><br /> -   Configuration Manager サイト サーバーからは指定した UDP ポート番号を使用する IP 向けのブロードキャストのみを許可するようにルーターを構成します。<br />-   既定以外の指定したポート番号を使用するように Configuration Manager を構成します。<br /><br /> サブネット向けのブロードキャストを有効にするために、すべての中間ルーターの再構成が必要になることがあります。<br /><br /> ユニキャストよりも、必要なネットワーク帯域幅が大きくなります。<br /><br /> IPv4 だけがサポートされています。IPv6 はサポートされていません。|  

> [!WARNING]  
>  サブネット向けブロードキャストを使用するときは、セキュリティ上のリスクを伴うことに注意してください。攻撃者は、偽のソース アドレスからブロードキャスト アドレスに ICMP (Internet Control Message Protocol) エコー要求の連続ストリームを送信することが可能です。これにより、すべてのホストがそのソース アドレスに応答することになります。 この種のサービス拒否攻撃のことをスマーフ攻撃といいます。通常、サブネット向けブロードキャストを有効にしないことで防止できます。

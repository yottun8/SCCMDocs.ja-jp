---
title: 暗号化コントロールのテクニカル リファレンス
titleSuffix: Configuration Manager
description: System Center Configuration Manager で、署名と暗号化を使用して、攻撃者によるデータの読み取りを防ぐ方法について説明します。
ms.date: 12/8/2017
ms.prod: configuration-manager
ms.technology: configmgr-protect
ms.topic: conceptual
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 6d25c6a11821b73f34c8a3cd6aa95d4a78c86587
ms.sourcegitcommit: 48098f9fb2f447672bf36d50c9f58a3d26acb9ed
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/14/2018
ms.locfileid: "53418400"
---
# <a name="cryptographic-controls-technical-reference"></a>暗号化コントロールのテクニカル リファレンス

「オブジェクトの*適用対象: System Center Configuration Manager (Current Branch)*


System Center Configuration Manager では、署名と暗号化を使用して、Configuration Manager 階層内のデバイスの管理を効果的に保護することができます。 署名を使用した場合、転送中にデータが改変されると、そのデータは破棄されます。 暗号化は、攻撃者がネットワーク プロトコル アナライザーを使用してデータを読み取ることを防ぐのに有効です。  

 Configuration Manager で使用する署名のハッシュ アルゴリズムは SHA-256 です。 2 つの Configuration Manager サイトが互いに通信するときは、SHA-256 を使用して通信に署名します。 Configuration Manager に実装される主な暗号化アルゴリズムは 3DES です。 このアルゴリズムは、Configuration Manager にデータを格納する場合、およびクライアント HTTP 通信の場合に使用されます。 HTTPS を介したクライアント通信を使用する場合は、公開キー基盤 (PKI) を構成して、「[PKI 証明書の要件](/sccm/core/plan-design/network/pki-certificate-requirements)」で説明している最も強力なハッシュ アルゴリズムおよびキーの最大長を使用した RSA 証明書を使用できます。  

 Windows ベースのオペレーティング システムの大部分の暗号化操作で、Configuration Manager は、Windows CryptoAPI ライブラリ rsaenh.dll の SHA-2、3DES と AES、RSA アルゴリズムを使用します。  

> [!IMPORTANT]  
>  「[SSL の脆弱性について](#about-ssl-vulnerabilities)」における SSL の脆弱性に対応する推奨される変更点に関する情報をご覧ください。  

##  <a name="cryptographic-controls-for-configuration-manager-operations"></a>Configuration Manager の操作での暗号化の制御  
 Configuration Manager で PKI 証明書を使用するかどうかに関係なく、Configuration Manager 内の情報に署名および暗号化することができます。  

### <a name="policy-signing-and-encryption"></a>ポリシーの署名と暗号化  
 クライアントのポリシー割り当ては、証明書に署名する自己署名サイト サーバーによって署名されています。これは、侵害された管理ポイントから改ざんされたポリシーが送信されるというセキュリティ上の危険を防止するためです。 この防御策はインターネットベースのクライアント管理を使用している場合に重要となります。これは、この環境ではインターネット接続に公開されている管理ポイントが必要となるためです。  

 ポリシーに機密データが含まれている場合は、3DES を使用して暗号化されます。 機密データが含まれているポリシーは、承認されているクライアントにのみ送信されます。 機密データが含まれていないポリシーは暗号化されません。  

 ポリシーがクライアントに保存されるときは、データ保護アプリケーション プログラミング インターフェイス (DPAPI) を使って暗号化されます。  

### <a name="policy-hashing"></a>ポリシーのハッシュ  
 Configuration Manager クライアントがポリシーを要求する場合、まずポリシー割り当てを受け取るので、自身に適用されるポリシーを認識できます。次に、そのポリシーの本文のみを要求します。 各ポリシー割り当てには、対応するポリシー本文用の算出されたハッシュが含まれます。 クライアントは適切なポリシー本文を取得してから、その本文上でハッシュを計算します。 ダウンロードしたポリシー本文のハッシュがポリシー割り当てのハッシュと一致しない場合、クライアントはポリシー本文を廃棄します。  

 ポリシー用のハッシュ アルゴリズムは SHA-1 と SHA-256 です。  

### <a name="content-hashing"></a>コンテンツのハッシュ  
 サイト サーバー上の配布マネージャー サービスは、すべてのパッケージのコンテンツ ファイルをハッシュします。 ポリシー プロバイダーには、ソフトウェア配布ポリシーのハッシュが含まれます。 Configuration Manager クライアントがコンテンツをダウンロードすると、クライアントはローカルでハッシュを再生成し、ポリシー内のハッシュと比較します。 ハッシュが一致した場合は、コンテンツが改変されていないので、クライアントはコンテンツをインストールします。 コンテンツが 1 バイトでも改変されていると、ハッシュが一致しなくなるため、ソフトウェアはインストールされません。 このチェック機能により、実際のコンテンツがポリシーでクロスチェックされるため、正しいソフトウェアを確実にインストールすることができます。  

 コンテンツの既定のハッシュ アルゴリズムは SHA-256 です。 この既定値を変更する場合は、Configuration Manager ソフトウェア開発キット (SDK) のドキュメントを参照してください。  

 コンテンツのハッシュをサポートしないデバイスもあります。 この例外には、次のことが含まれます。  

-   App-V コンテンツをストリーミングするときの Windows クライアント。  

-   Windows Phone クライアント: ただし、これらのクライアントは、信頼できるソースで署名されたアプリケーションの署名を検証します。  

-   Windows RT クライアント: ただし、これらのクライアントは、信頼できるソースで署名されたアプリケーションの署名を検証し、パッケージの完全名 (PFN) の検証も使用します。  

-   iOS: ただし、これらのデバイスは、信頼できるソースの任意の開発者証明書で署名されたアプリケーションの署名を検証します。  

-   Nokia クライアント: ただし、これらのクライアントは、自己署名証明書を使用するアプリケーションの署名を検証します。 または、信頼できるソースの証明書の署名と証明書によって、Nokia Symbian Installation Source (SIS) アプリケーションに署名することができます。  

-   Android。 さらに、これらのデバイスは、アプリケーションのインストールに署名の検証を使用しません。  

-   SHA-256 をサポートしていない Linux および UNIX のバージョンで実行されるクライアント。 詳細については、「[Linux および UNIX コンピューターへのクライアント展開の計画](/sccm/core/clients/deploy/plan/planning-for-client-deployment-to-linux-and-unix-computers)」を参照してください。  

### <a name="inventory-signing-and-encryption"></a>インベントリの署名と暗号化  
 クライアントが管理ポイントに送信するインベントリは、管理ポイントとの通信に HTTP または HTTPS のどちらが使用されていても、デバイスによって必ず署名されます。 HTTP が使用される場合は、このデータを暗号化することを選択できます。これは、推奨されるセキュリティのベスト プラクティスです。  

### <a name="state-migration-encryption"></a>状態移行の暗号化  
 オペレーティング システム展開用の状態移行ポイントに保存されているデータは、必ずユーザー状態移行ツール (USMT) で 3DES を使用して暗号化されます。  

### <a name="encryption-for-multicast-packages-to-deploy-operating-systems"></a>オペレーティング システムを展開するマルチキャスト パッケージの暗号化  
 マルチキャストを使用してパッケージをコンピューターに送信する場合、すべてのオペレーティング システムの展開パッケージに対して、暗号化を有効にすることができます。 この暗号化では Advanced Encryption Standard (AES) が使用されます。 暗号化を有効にする場合は、証明書を追加で構成する必要はありません。 マルチキャスト対応の配布ポイントは、パッケージの暗号化のために自動的に対称キーを生成します。 各パッケージには、異なる暗号化キーがあります。 キーは、標準的な Windows API を使用して、マルチキャスト対応の配布ポイントに格納されます。 クライアントがマルチキャスト セッションに接続するとき、PKI 発行のクライアント認証証明書 (クライアントが HTTPS を使用する場合) または自己署名入り証明書 (クライアントが HTTP を使用する場合) で暗号化されたチャネルを通じてキーの交換が実行されます。 クライアントは、マルチキャスト セッション中の場合のみメモリにキーを格納します。  

### <a name="encryption-for-media-to-deploy-operating-systems"></a>オペレーティング システムを展開するメディアの暗号化  
 メディアを使用してオペレーティング システムを展開し、メディアを保護するためにパスワードを指定する場合、環境変数は Advanced Encryption Standard (AES) を使用して暗号化されます。 メディア上のその他のデータ (パッケージおよびアプリケーションのコンテンツを含む) は暗号化されません。  

### <a name="encryption-for-content-that-is-hosted-on-cloud-based-distribution-points"></a>クラウドベースの配布ポイントでホストされているコンテンツの暗号化  
 System Center 2012 Configuration Manager SP1 以降では、クラウドベースの配布ポイントを使用する場合、その配布ポイントにアップロードしたコンテンツは、Advanced Encryption Standard (AES) を使用して 256 ビットのキー サイズで暗号化されます。 コンテンツは、更新するたびに再暗号化されます。 クライアントがコンテンツをダウンロードすると、暗号化され、HTTPS 接続で保護されます。  

### <a name="signing-in-software-updates"></a>ソフトウェア更新プログラムの署名  
 どのソフトウェア更新プログラムにも、改変を防ぐために、発行元による署名が必要です。 クライアント コンピューターでは、Windows Update エージェント (WUA) がカタログにある更新プログラムをスキャンしますが、ローカル コンピューターの [信頼された発行元] ストアにデジタル証明書が見つからない場合は、更新プログラムはインストールされません。 更新カタログ (WSUS Publishers Self-signed など) の発行時に自己署名入り証明書が使用された場合、証明書の有効性を検証するために、ローカル コンピューターの [信頼されたルート証明機関] 証明書ストアに証明書がある必要があります。 また、WUA では、ローカル コンピューターで **[イントラネットの Microsoft 更新サービスの場所からの署名済みコンテンツを許可する]** グループ ポリシー設定が有効になっているかどうかも確認されます。 Updates Publisher で作成および発行された更新プログラムをスキャンするには、WUA でこのポリシー設定が有効になっている必要があります。  

 ソフトウェア更新プログラムが System Center Updates Publisher で発行されると、アップデート サーバーに発行されるときに、デジタル証明書によってソフトウェア更新プログラムに署名されます。 ソフトウェア更新プログラムに署名するには、PKI 証明書を指定するか、Updates Publisher によって自己署名入り証明書が生成されるように構成します。  

### <a name="signed-configuration-data-for-compliance-settings"></a>コンプライアンス設定のための署名入り構成データ  
 Configuration Manager では、構成データをインポートするときに、ファイルのデジタル署名を検証します。 ファイルが署名されていない場合、またはデジタル署名の検証チェックが失敗した場合は、警告およびインポートを続行するかどうかを尋ねるメッセージが表示されます。 発行元とファイルの整合性が信頼できる場合にのみ、構成データのインポートを続行します。  

### <a name="encryption-and-hashing-for-client-notification"></a>クライアント通知の暗号化とハッシュ  
 クライアント通知を使用する場合、すべての通信は、サーバーとクライアントのオペレーティング システムがネゴシエートできる TLS および最高レベルの暗号化を使用します。 たとえば、Windows 7 を実行するクライアント コンピューターと、Windows Server 2008 R2 を実行する管理ポイントは、128 ビット AES 暗号化をサポートできます。一方、Vista を実行するクライアント コンピューターは同じ管理ポイントに対して、3DES 暗号化まで下げてネゴシエートします。 SHA-1 または SHA-2 を使用してクライアント通知中に転送されるパケットをハッシュする場合、同じネゴシエーションが発生します。  

##  <a name="certificates-used-by-configuration-manager"></a>Configuration Manager で使用される証明書  
 Configuration Manager で使用できる公開キー基盤 (PKI) 証明書の一覧、特別な要件または制限、および証明書の使用方法の詳細については、「[PKI 証明書の要件](/sccm/core/plan-design/network/pki-certificate-requirements)」を参照してください。 この一覧には、サポートされるハッシュ アルゴリズムとキーの長さが含まれています。 ほとんどの証明書は、SHA-256 および 2048 ビットのキー長をサポートしています。  

> [!NOTE]  
>  Configuration Manager を使用するすべての証明書のサブジェクト名またはサブジェクトの別名には、1 バイト文字しか使用できません。  

 次の場合に、PKI 証明書が必要です。  

- インターネット上の Configuration Manager クライアントを管理する場合。  

- モバイル デバイス上の Configuration Manager クライアントを管理する場合。  

- Mac コンピューターを管理する場合  

- クラウドベースの配布ポイントを使用する場合  

- Intel AMT 搭載コンピューターを帯域外で管理する場合。  

  認証、署名、または暗号化に証明書を必要とするその他ほとんどの Configuration Manager 通信では、Configuration Manager は、使用可能な場合は自動的に PKI 証明書を使用します。 証明書を使用できない場合は、Configuration Manager により自己署名入り証明書が生成されます。  

  Exchange Server コネクタを使用してモバイル デバイスを管理する場合、Configuration Manager は PKI 証明書を使用しません。  

### <a name="mobile-device-management-and-pki-certificates"></a>モバイル デバイスの管理および PKI 証明書  
 モバイル デバイスが携帯電話会社によってロックされていない場合は、Configuration Manager または Microsoft Intune を使用してクライアント証明書を要求してインストールできます。 この証明書は、モバイル デバイス上のクライアントと Configuration Manager サイト システムまたは Microsoft Intune サービスとの間に相互認証を提供します。 モバイル デバイスがロックされている場合は、Configuration Manager または Microsoft Intune を使用して証明書を展開することはできません。  

 モバイル デバイスのハードウェア インベントリを有効にすると、Configuration Manager または Microsoft Intune ではモバイル デバイスにインストールされている証明書もインベントリされます。   

### <a name="operating-system-deployment-and-pki-certificates"></a>オペレーティング システムの展開と PKI 証明書  
 Configuration Manager を使用してオペレーティング システムを展開していて、管理ポイントが HTTPS を使用したクライアント接続を要求している場合、クライアント コンピューターには管理ポイントと通信するための証明書も必要となります。移行段階にある場合 (タスク シーケンス メディアや PXE 対応配布ポイントから起動中である場合など) でも同様です。 この場合は、PKI クライアント認証証明書を作成し、秘密キーを使用してエクスポートしてから、サイト サーバーのプロパティにインポートし、管理ポイントの信頼されたルート CA の証明書も追加する必要があります。  

 起動可能なメディアを作成する場合は、起動可能なメディアの作成時にクライアント認証証明書をインポートします。 タスク シーケンスで構成した秘密キーやその他の機密データを保護するには、起動可能なメディアにパスワードを構成します。 起動可能なメディアから起動されるすべてのコンピューターは、クライアント ポリシーの要求などのクライアント機能で必要な場合に、同じ証明書を管理ポイントに提示します。  

 PXE ブートを使用する場合は、PXE 対応の配布ポイントにクライアント認証証明書をインポートします。PXE 対応の配布ポイントは、PXE 対応の配布ポイントから起動を行うすべてのクライアントに同じ証明書を使用します。 推奨されるセキュリティのベスト プラクティスとして、タスク シーケンス内の秘密キーおよびその他の機密データを保護するためには、PXE サービスにコンピューターを接続するユーザーに、パスワードの入力を要求します。  

 これらのいずれかのクライアント認証証明書が改ざんされた場合、 **[管理]** ワークスペースの **[証明書]** ノードおよび **[セキュリティ]** ノード内の証明書をブロックします。 これらの証明書を管理するには、 **[オペレーティング システム展開証明書の管理]** 権限が必要です。  

 オペレーティング システムが展開され、Configuration Manager がインストールされた後は、クライアントが HTTPS クライアント通信を行うために独自の PKI クライアント認証証明書が必要になります。  

### <a name="isv-proxy-solutions-and-pki-certificates"></a>ISV プロキシ ソリューションと PKI 証明書  
 Independent Software Vendor (ISV) では、Configuration Manager を拡張するアプリケーションを作成できます。 たとえば、ISV では、Windows 以外のクライアント プラットフォーム (Macintosh や UNIX コンピューターなど) をサポートする拡張アプリケーションを作成できます。 ただし、サイト システムに HTTPS クライアント接続が必要な場合、これらのクライアントは、サイトとの通信に PKI 証明書を使用する必要もあります。 Configuration Manager には、ISV プロキシ クライアントと管理ポイントの間の通信を可能にする ISV プロキシに証明書を割り当てる機能が含まれています。 ISV プロキシ証明書を必要とする拡張アプリケーションを使用する場合は、その製品のマニュアルを参照してください。 ISV プロキシ証明書を作成する方法の詳細については、Configuration Manager Software Developer Kit (SDK) を参照してください。  

 ISV 証明書が改ざんされた場合は、 **[管理]** ワークスペースの **[証明書]** ノードおよび **[セキュリティ]** ノード内の証明書をブロックします。  

### <a name="asset-intelligence-and-certificates"></a>資産インテリジェンスと証明書  
 Configuration Manager は、Microsoft に接続するために資産インテリジェンス同期ポイントで使用される X.509 証明書と共にインストールされます。 Configuration Manager は、この証明書を使用して、Microsoft 証明書サービスからクライアント認証証明書を要求します。 クライアント認証証明書は、資産インテリジェンス同期ポイント サイト システム サーバーにインストールされます。これは、Microsoft に対してサーバーを認証するときに使用されます。 Configuration Manager は、クライアント認証証明書を使用して、資産インテリジェンス カタログをダウンロードし、ソフトウェア タイトルをアップロードします。  

 この証明書のキーの長さは 1024 ビットです。  

### <a name="cloud-based-distribution-points-and-certificates"></a>クラウドベースの配布ポイントと証明書  
 System Center 2012 Configuration Manager SP1 以降では、クラウドベースの配布ポイントには、Microsoft Azure にアップロードする管理証明書 (自己署名または PKI) が必要です。 この管理証明書には、サーバー認証機能とキー長が 2,048 ビットの証明書が必要です。 さらに、各クラウドベースの配布ポイントでサービス証明書を構成する必要があります。このとき、自己署名証明書ではなく、サーバー認証機能があり、キー長が 2,048 ビット以上の証明書を構成する必要があります。  

> [!NOTE]  
>  自己署名管理証明書はテスト目的専用であり、運用ネットワークには使用できません。  

 クライアントがクラウドベースの配布ポイントを使用するには、クライアント PKI 証明書は必要ありません。クライアントは管理ポイントに対して、自己署名証明書またはクライアント PKI 証明書を使用して認証します。 次に、管理ポイントは Configuration Manager アクセス トークンをクライアントに発行し、クライアントはそのトークンをクラウドベースの配布ポイントに提示します。 トークンの有効期間は 8 時間です。  

### <a name="the-microsoft-intune-connector-and-certificates"></a>Microsoft Intune コネクタと証明書  
 Microsoft Intune でモバイル デバイスを登録すると、Microsoft Intune コネクタを作成することにより、Configuration Manager でモバイル デバイスを管理できるようになります。 コネクタは PKI 証明書とクライアント認証機能を使用して Microsoft Intune に対して Configuration Manager を認証し、SSL を使用してすべての情報を転送します。 証明書のキーのサイズは 2,048 ビットであり、SHA-1 ハッシュ アルゴリズムを使用します。  

 コネクタをインストールするときに、サイドローディング キーの署名証明書を作成してサイト サーバーに保存し、Simple Certificate Enrollment Protocol (SCEP) チャレンジを暗号化するための暗号化証明書を作成して証明書登録ポイントに保存します。 これらの証明書のキーのサイズは 2048 ビットで、SHA-1 ハッシュ アルゴリズムを使用します。  

 Microsoft Intune でモバイル デバイスを登録すると、PKI 証明書がモバイル デバイスにインストールされます。 この証明書にはクライアント認証機能があり、2,048 ビットのキー サイズを使用し、SHA-1 ハッシュ アルゴリズムを使用します。  

 このような PKI 証明書は、Microsoft Intune によって要求、生成、およびインストールが自動的に行われます。  

### <a name="crl-checking-for-pki-certificates"></a>PKI 証明書の CRL チェック  
 PKI の証明書失効リスト (CRL) を使用すると、管理や処理のオーバーヘッドが増加しますが、安全性が高まります。 ただし、CRL チェックが有効にされていて、CRL にアクセスできない場合、PKI 接続は失敗します。 詳細については、「[System Center Configuration Manager のセキュリティとプライバシー](/sccm/core/plan-design/security/security-and-privacy)」を参照してください。  

 IIS では、証明書失効リスト (CRL) が既定で有効になっています。このため、PKI の展開で CRL を使用している場合、IIS を実行するほとんどの Configuration Manager サイト システムでは追加で構成する項目はありません。 ただし、ソフトウェア更新プログラムは例外です。ソフトウェア更新プログラム ファイルの署名を検証するには、手動で CRL チェックを有効にする必要があります。  

 クライアント コンピューターで HTTPS クライアント接続を使用する場合、CRL チェックは既定で有効にされます。 帯域外管理コンソールを実行して AMT ベースのコンピューターに接続する場合、CRL チェックは既定で有効になりませんが、このオプションを有効にすることができます。 Configuration Manager SP1 以降では、Mac コンピューターのクライアントで CRL チェックを無効にすることはできません。  

 CRL チェックは、Configuration Manager の次の接続ではサポートされません。  

-   サーバー間の接続。  

-   Configuration Manager に登録されたモバイル デバイス。  

-   Microsoft Intune に登録されたモバイル デバイス。  

##  <a name="cryptographic-controls-for-server-communication"></a>サーバー通信の暗号化制御  
 Configuration Manager は、サーバー通信のために次の暗号化制御を使用します。  

### <a name="server-communication-within-a-site"></a>サイト内でのサーバーの通信  
 各サイト システム サーバーは、同じ Configuration Manager サイト内の他のサイト システムにデータを転送するために証明書を使用します。 一部のサイト システムの役割は、認証に証明書も使用します。 たとえば、あるサーバーに登録プロキシ ポイントを、別のサーバーに登録ポイントをインストールした場合、この識別証明書を使用することにより相互に認証することができます。 Configuration Manager がこの通信に証明書を使用するときに、サーバー認証機能がある PKI 証明書を使用できる場合、Configuration Manager はその証明書を自動的に使用します。使用できない場合、Configuration Manager は自己署名証明書を生成します。 この自己署名証明書にはサーバー認証機能があり、SHA-256 を使用します。また、キーの長さは 2048 ビットです。 Configuration Manager は、他のサイト システム サーバー上の信頼されたユーザー ストアに証明書をコピーします。このサーバーは、サイト システムを信頼する必要がある場合があります。 サイト システムは、これらの証明書と PeerTrust を使用することにより、相互に信頼することができます。  

 各サイト システム サーバーのこの証明書に加えて、Configuration Manager は、ほとんどのサイト システムの役割に対して、自己署名入り証明書を生成します。 同じサイトに複数のサイト システムの役割のインスタンスがある場合、それらは同じ証明書を共有します。 たとえば、同じサイトに複数の管理ポイントまたは複数の登録ポイントがある場合があります。 この自己署名入り証明書も、SHA-256 を使用し、キーの長さは 2048 ビットです。 これは、それを信頼する必要があるサイト システム サーバー上の信頼されたユーザー ストアにもコピーされます。 次のサイト システムの役割はこの証明書を生成します。  

- アプリケーション カタログ Web サービス ポイント  

- アプリケーション カタログ Web サイト ポイント  

- 資産インテリジェンス同期ポイント  

- 証明書登録ポイント  

- Endpoint Protection ポイント  

- 登録ポイント  

- フォールバック ステータス ポイント  

- 管理ポイント  

- マルチキャスト対応の配布ポイント  

- 帯域外サービス ポイント  

- レポート サービス ポイント  

- ソフトウェアの更新ポイント  

- 状態移行ポイント  

- システム正常性検証ツール ポイント  

- Microsoft Intune コネクタ  

  これらの証明書は、Configuration Manager によって自動的に管理され、必要に応じて自動的に生成されます。  

  また、Configuration Manager は配布ポイントから管理ポイントにステータス メッセージを送信するために、クライアント認証証明書も使用します。 管理ポイントが HTTPS クライアント接続用のみに構成されている場合は、PKI 証明書を使用する必要があります。 管理ポイントが HTTP 接続を受け入れる場合は、PKI 証明書を使用するか、自己署名入り証明書 (クライアント認証機能があり、SHA-256 を使用し、キーの長さが 2048 ビット) を使用するオプションを選択できます。  

### <a name="server-communication-between-sites"></a>サイト間のサーバー通信  
 Configuration Manager は、データベースのレプリケーションとファイルベースのレプリケーションを使ってサイト間でデータを転送します。 詳細については、「[System Center Configuration Manager でのエンドポイント間の通信](/sccm/core/plan-design/hierarchy/communications-between-endpoints)」をご覧ください。  

 Configuration Manager は、サイト間のデータベース レプリケーションを自動的に構成し、サーバー認証機能を持つ PKI 証明書を使用します (利用できる場合)。利用できない場合、Configuration Manager はサーバー認証のために自己署名入り証明書を作成します。 どちらの場合も、PeerTrust を使用する信頼されたユーザー ストアの証明書を使用して、サイト間の認証が行なわれます。 この証明書ストアは、Configuration Manager 階層で使用される SQL Server コンピューターのみがサイト間レプリケーションに加わるようにするために使用します。 プライマリ サイトと中央管理サイトは、構成の変更を階層内のすべてのサイトにレプリケートできますが、セカンダリ サイトは、親サイトにのみ構成の変更をレプリケートできます。  

 サイト サーバーは、自動的に行われるセキュリティ キーの交換を使用して、サイト間通信を確立します。 送信側のサイト サーバーは、ハッシュを生成し、秘密キーで署名します。 受信側のサイト サーバーは公開キーを使用して署名を確認し、受信したハッシュをローカルで生成された値と比較します。 値が一致した場合、受信側のサイトはレプリケートされたデータを受け入れます。 値が一致しない場合、Configuration Manager はレプリケーション データを拒否します。  

 Configuration Manager のデータベース レプリケーションは、SQL Server Service Broker を使用し、次のメカニズムを使用して、サイト間でデータを転送します。  

- SQL Server 間の接続:これは、サーバー認証および自己署名入り証明書 (1024 ビット) に Windows 資格情報を使用し、Advanced Encryption Standard (AES) を使用してデータに署名および暗号化します。 サーバー認証機能を持つ PKI 証明書を利用できる場合は、それらが使用されます。 証明書は、コンピューター証明書ストアの個人用ストアに保存されている必要があります。  

- SQL サービス ブローカー:これは、認証に 2048 ビットの自己署名入り証明書を使用し、Advanced Encryption Standard (AES) を使用してデータに署名および暗号化します。 この証明書は、SQL Server マスター データベースに保存されている必要があります。  

  ファイル ベースのレプリケーションは、サーバー メッセージ ブロック (SMB) プロトコルを使用しており、SHA-256 を使用してこのデータ (暗号化されていないが、機密データが含まれていない) に署名します。 このデータを暗号化する場合は、IPsec を使用できますが、Configuration Manager とは別にそれを実装する必要があります。  

##  <a name="cryptographic-controls-for-clients-that-use-https-communication-to-site-systems"></a>サイト システムに対して HTTPS 通信を使用するクライアントの暗号化制御  
 サイト システムの役割がクライアント接続を受け入れる場合は、HTTPS 接続および HTTP 接続を受け入れるように、または HTTPS 接続のみを受け入れるように構成できます。 インターネットからの接続を受け入れるサイト システムの役割は、HTTPS を使用したクライアント接続のみを受け入れます。  

 HTTPS 経由のクライアント接続では、クライアント/サーバー間の通信を保護するための公開キー基盤 (PKI) と統合することにより高いレベルのセキュリティが実現されています。 ただし、PKI の計画、展開、および操作をよく理解せずに HTTPS クライアント接続を構成すると、脆弱性が改善されないことがあります。 たとえば、ルート CA を保護していない場合は、攻撃者によって PKI 基盤全体の信頼性が侵害される恐れがあります。 管理されて保護された処理を使用して PKI 証明書を展開および管理できない場合、クライアントが管理されていないクライアントとなり、重要なソフトウェア更新プログラムまたはパッケージを受け取ることができないことがあります。  

> [!IMPORTANT]  
>  クライアント通信に使用される PKI 証明書は、クライアントといくつかのサイト システム間の通信のみを保護します。 PKI 証明書は、サイト サーバーとサイト システムの間や、サイト サーバー間の通信チャネルを保護しません。  

### <a name="communication-that-is-unencrypted-when-clients-use-https-communication"></a>クライアントが HTTPS 通信を使用する場合に暗号化されない通信  
 クライアントが HTTPS を使用してサイト システムと通信する場合、通常、通信は SSL を使用して暗号化されます。 ただし、次のような状況では、クライアントは暗号化を使用せずにサイト システムと通信します。  

- クライアントがイントラネット上での HTTPS 接続に失敗し、代替で HTTP を使用する (サイト システムがこの構成を許可する場合)。  

- 次のサイト システムの役割への通信:  

  -   クライアントが状態メッセージをフォールバック ステータス ポイントに送信する。  

  -   クライアントが PXE 要求を PXE 対応配布ポイントに送信する。  

  -   クライアントが通知データを管理ポイントに送信する  

  レポート サービス ポイントは、クライアントの通信モードに関係なく、HTTP または HTTPS を使用するように構成されています。  

##  <a name="cryptographic-controls-for-clients-chat-use-http-communication-to-site-systems"></a>サイト システムに対して HTTP 通信を使用するクライアントの暗号化制御  
 クライアントがサイト システムの役割に対して HTTP 通信を使用する場合、クライアント認証に PKI 証明書、または Configuration Manager が生成した自己署名入り証明書を使用できます。 Configuration Manager が生成した自己署名入り証明書には、署名と暗号化用のカスタム オブジェクト識別子が付いており、この証明書によってクライアントが識別されます。 Windows Server 2003 を除き、サポートされているすべてのオペレーティング システムの自己署名入り証明書で SHA-256 アルゴリズムが使用され、キーの長さは 2048 ビットです。 Windows Server 2003 では、SHA1 アルゴリズムが使用され、キーの長さは 1024 ビットです。  

### <a name="operating-system-deployment-and-self-signed-certificates"></a>オペレーティング システムの展開と自己署名入り証明書  
 Configuration Manager を使用し、自己署名入り証明書を使用してオペレーティング システムを展開している場合、クライアント コンピューターには管理ポイントと通信するための証明書も必要となります。コンピューターが移行段階にある場合 (タスク シーケンス メディアや PXE 対応配布ポイントから起動中である場合など) でも同様です。 HTTP クライアント接続に対してこのシナリオをサポートするために、Configuration Manager は、署名と暗号化用のカスタム オブジェクト識別子の付いた自己署名入り証明書を生成し、この証明書によってクライアントが識別されるようにします。 Windows Server 2003 を除き、サポートされているすべてのオペレーティング システムの自己署名入り証明書で SHA-256 アルゴリズムが使用され、キーの長さは 2048 ビットです。 Windows Server 2003 では、SHA1 アルゴリズムが使用され、キーの長さは 1024 ビットです。 自己署名証明書が改ざんされた場合は、攻撃者がこれを使用して信頼されたクライアントになりすますことを防ぐため、 **[管理]** ワークスペースの **[証明書]** ノードおよび **[セキュリティ]** ノードで証明書をブロックします。  

### <a name="client-and-server-authentication"></a>クライアントおよびサーバーの認証  
 クライアントが HTTP を使用して接続する場合は、管理ポイントでの認証に Active Directory Domain Services または Configuration Manager の信頼されたルート キーを使用します。 状態移行ポイントやソフトウェアの更新ポイントなどのその他のサイト システムの役割では、クライアントの認証は行なわれません。  

 管理ポイントが最初に自己署名入りクライアント証明書を使用してクライアントを認証する場合、すべてのコンピューターは自己署名入り証明書を生成できるため、このメカニズムでのセキュリティは最低限のものとなります。 この場合は、クライアントを承認することによって、識別プロセスを強化する必要があります。 信頼されたコンピューターのみを、Configuration Manager によって自動的に承認するか、管理ユーザーによって手動で承認する必要があります。 詳細については、「[System Center Configuration Manager でのエンドポイント間の通信](/sccm/core/plan-design/hierarchy/communications-between-endpoints)」の承認のセクションをご覧ください。  

## <a name="about-ssl-vulnerabilities"></a>SSL の脆弱性について
Configuration Manager クライアントとサーバーのセキュリティを強化するには、次の操作を行います。

-   TLS 1.2 の有効化

    Configuration Manager の TLS 1.2 を有効にするは、次のサポート技術情報の記事「[TLS 1.2 の構成マネージャーを有効にする方法](https://support.microsoft.com/en-us/help/4040243/how-to-enable-tls-1-2-for-configuration-manager)」をご覧ください。
-   SSL 3.0、TLS 1.0 および TLS 1.1 の無効化 
-   TLS 関連の暗号スイートを調整する 

詳細については、「[Schannel.dll において特定の暗号化アルゴリズムおよびプロトコルの使用を制限する方法](https://support.microsoft.com/en-us/kb/245030/)」と「[Prioritizing Schannel Cipher Suites](https://msdn.microsoft.com/library/windows/desktop/bb870930.aspx)」 (Schannel 暗号スイートの優先順位設定) を参照してください。 これらの操作は、Configuration Manager の機能には影響しません。


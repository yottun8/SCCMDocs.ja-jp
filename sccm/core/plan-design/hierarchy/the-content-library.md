---
title: コンテンツ ライブラリ
titleSuffix: Configuration Manager
description: 分散型コンテンツの全体的なサイズを小さくするために Configuration Manager が使用するコンテンツ ライブラリについて説明します。
ms.date: 09/19/2018
ms.prod: configuration-manager
ms.technology: configmgr-other
ms.topic: conceptual
ms.assetid: 65c88e54-3574-48b0-a127-9cc914a89dca
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 4587549ef2f43be3dcc5e18021f60c42770f5800
ms.sourcegitcommit: 48098f9fb2f447672bf36d50c9f58a3d26acb9ed
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/14/2018
ms.locfileid: "53415519"
---
# <a name="the-content-library-in-configuration-manager"></a>Configuration Manager のコンテンツ ライブラリ

「オブジェクトの*適用対象: System Center Configuration Manager (Current Branch)*

コンテンツ ライブラリは、Configuration Manager でのコンテンツの単一インスタンス ストアです。 サイトではこれを使用して配布するコンテンツの合計サイズを減らします。 コンテンツ ライブラリにはソフトウェア更新プログラム、アプリケーション、OS の展開などのソフトウェア展開に使用するすべてのコンテンツ ファイルが格納されます。  

- サイトではコンテンツ ライブラリのコピーが、各サイト サーバーと各配布ポイントで自動的に作成および保持されます。  

- Configuration Manager はコンテンツ ファイルをサイト サーバーにダウンロードするか、配布ポイントにコピーする前に、各コンテンツ ファイルが既にコンテンツ ライブラリにあるかどうかを確認します。  

- コンテンツのファイルがある場合、Configuration Manager は、ファイルをコピーしません。 代わりに、既存のコンテンツ ファイルをアプリケーションまたはパッケージに関連付けます。  

配布ポイントのサーバー上で、次のオプションを構成します。

- コンテンツ ライブラリを作成する 1 つまたは複数のディスク ドライブ。  

- 使用する各ドライブの優先順位。  

Configuration Manager は、優先順位が最も高いドライブの空き領域が指定の最小値を下回るまで、そのドライブにコンテンツ ファイルをコピーします。  

- ドライブ設定は、配布ポイントをインストールするときに構成します。  

- インストールの完了後は、配布ポイントのプロパティでドライブ設定を構成することはできません。  


配布ポイントのドライブ設定の構成方法については、[コンテンツとコンテンツ インフラストラクチャの管理](/sccm/core/servers/deploy/configure/manage-content-and-content-infrastructure)に関するページを参照してください。  


> [!IMPORTANT]
>  インストール後にコンテンツ ライブラリを配布ポイントの別の場所に移動するには、Configuration Manager Toolkit の **Content Library Transfer** ツールを使用します。 詳細については、[Content Library Transfer ツール](/sccm/core/support/content-library-transfer)に関するページを参照してください。  



## <a name="about-the-content-library-on-the-central-administration-site"></a>中央管理サイトのコンテンツ ライブラリについて  
Configuration Manager の既定では、サイトのインストール時に中央管理サイトにコンテンツ ライブラリを作成します。 コンテンツ ライブラリは、空きディスク領域が最も多いサイト サーバーのドライブに配置します。 配布ポイントは中央管理サイトにインストールできないため、コンテンツ ライブラリで使用するドライブを優先することはできません。 他のサイト サーバーおよび配布ポイントのコンテンツ ライブラリと同様に、コンテンツ ライブラリを含むドライブに空きディスク領域がなくなったら、コンテンツ ライブラリは次の空き領域があるドライブを自動的に使用します。  

Configuration Manager は、次のシナリオで中央管理サイトのコンテンツ ライブラリを使用します。  

- 中央管理サイトでコンテンツを作成する  

- 別の Configuration Manager サイトからコンテンツを移行し、そのコンテンツを管理するサイトとして中央管理サイトを割り当てる  

> [!NOTE]  
>  プライマリ サイトにコンテンツを作成してから、別のプライマリ サイトまたは別のプライマリ サイトの下のセカンダリ サイトに配布すると、中央管理サイトは、中央管理サイトのスケジューラの受信トレイにコンテンツを一時的に保存しますが、そのコンテンツをコンテンツ ライブラリに追加しません。  

次のオプションを使用して、中央管理サイトのコンテンツ ライブラリを管理します。  

- コンテンツ ライブラリが特定のドライブにインストールされていることを防ぐには、**no_sms_on_drive.sms** という名前の空のファイルを作成します。 コンテンツ ライブラリを作成する前に、これをドライブのルートにコピーします。  

- コンテンツ ライブラリを作成したら、Configuration Manager ツールの **Content Library Transfer** ツールを使用して、コンテンツ ライブラリの場所を管理します。 詳細については、[Content Library Transfer ツール](/sccm/core/support/content-library-transfer)に関するページを参照してください。  

> [!Note]  
> クラウド配布ポイントは、単一インスタンス記憶域を使用しません。 パッケージは Azure に送信する前に暗号化され、各パッケージには一意の暗号化キーが含まれます。 2 つのファイルは同じですが、暗号化されたバージョンは同じではありません。  



## <a name="bkmk_remote"></a> サイト サーバーのリモート コンテンツ ライブラリを構成する  
<!--1357525--> バージョン 1806 より、[高可用性サイト サーバー](/sccm/core/servers/deploy/configure/site-server-high-availability)を構成する、または中央管理サーバーやプライマリ サイト サーバー上でハード ドライブ領域を解放するには、コンテンツ ライブラリを別の記憶域の場所に再配置します。 コンテンツ ライブラリは、サイト サーバー上の別のドライブ、別のサーバー、または記憶域ネットワーク (SAN) 内のフォールトトレラント ディスクに移動します。 SAN をお勧めするのは、可用性が高く、時間の経過と共に変化するコンテンツの要件に合わせて拡張または縮小する弾力性記憶域を提供するためです。 詳細については、[高可用性オプション](/sccm/protect/understand/high-availability-options)に関するページを参照してください。

リモート コンテンツ ライブラリは、[サイト サーバー ロールの高可用性](/sccm/core/servers/deploy/configure/site-server-high-availability)に対応するための前提条件です。 

> [!Note]  
> この操作では、サイト サーバー上のコンテンツ ライブラリのみを移動します。 配布ポイント上のコンテンツ ライブラリの場所には影響しません。 

> [!Tip]  
> コンテンツ ライブラリの外部にあるパッケージ ソース コンテンツの管理についても計画してください。 Configuration Manager のすべてのソフトウェア オブジェクトのネットワーク共有にパッケージ ソースがあります。 すべてのソースを 1 つの共有に一元化することを検討してください。ただし、その場所が冗長で高可用性であるようにします。 
> 
> コンテンツ ライブラリをパッケージ ソースと同じストレージ ボリュームに移動する場合、そのボリュームをデータ重複除去の対象として設定できなくなります。 コンテンツ ライブラリはデータ重複除去に対応していますが、パッケージ ソース ボリュームは対応していません。 詳細については、「[データ重複除去](/sccm/core/plan-design/configs/support-for-windows-features-and-networks#bkmmk_datadedup)」をご覧ください。<!--SCCMDOcs issue #831-->  


### <a name="prerequisites"></a>[前提条件]  

- サイト サーバー コンピューター アカウントには、コンテンツ ライブラリの移動先であるネットワーク パスに対して**読み取り**および**書き込み**のアクセス許可が必要です。 リモート システムにコンポーネントはインストールされません。  

- サイト サーバーは配布ポイントの役割を持つことができません。 配布ポイントでもコンテンツ ライブラリを使用し、この役割ではリモート コンテンツ ライブラリをサポートしません。 コンテンツ ライブラリを移動した後は、サイト サーバーに配布ポイントの役割を追加できません。  

> [!Important]  
> 複数のサイト間で共有のネットワーク場所を再利用しないでください。 たとえば、中央管理サイトと子プライマリ サイトの両方に同じパスを使用しないでください。 この構成によりコンテンツ ライブラリが破損し、再構築しなければならなくなる可能性があります。<!--SCCMDocs-pr issue 2764-->  


### <a name="process-to-manage-the-content-library"></a>コンテンツ ライブラリを管理するプロセス

1. コンテンツ ライブラリのターゲットとしてネットワーク共有にフォルダーを作成します。 たとえば、`\\server\share\folder` となります。  

    > [!Warning]  
    > コンテンツを含む既存のフォルダーを再利用しないでください。 たとえば、パッケージ ソースと同じフォルダーを使用しないでください。 コンテンツ ライブラリをコピーする前に、Configuration Manager によって、指定した場所から既存のコンテンツが削除されます。  

2. Configuration Manager コンソールで、**[管理]** ワークスペースに切り替えます。 **[サイトの構成]** を展開し、**[サイト]** ノードを選択し、サイトを選びます。 詳細ウィンドウの下部にある **[概要]** タブに **[コンテンツ ライブラリ]** の新しい列が表示されます。  

3. リボンの **[コンテンツ ライブラリの管理]** をクリックします。   

4. [コンテンツ ライブラリの管理] ウィンドウの **[現在の場所]** フィールドに、ローカル ドライブとパスが表示されます。 **[新しい場所]** に有効なネットワーク パスを入力します。 このパスは、サイトがコンテンツ ライブラリを移動する先の場所です。 共有に既に存在するフォルダー名を含める必要があります (`\\server\share\folder` など)。 **[OK]** をクリックします。  

5. 詳細ウィンドウの [概要] タブで [コンテンツ ライブラリ] 列の **[状態]** の値に注目してください。 コンテンツ ライブラリの移動時には、サイトの進行状況に合わせて更新されます。  

   - **[進行中]** の間は、**[移動の進行状況 (%)]** の値に完了率が表示されます。  

   - エラー状態がある場合、状態にエラーが表示されます。 一般的なエラーには、**アクセスが拒否されました**や、**ディスクがいっぱいです**が含まれます。  

   - 完了すると、**[完了]** と表示されます。  
    
     詳細については、**distmgr.log** を参照してください。 詳細については、「[サイト サーバーとサイト システムのログ ファイル](/sccm/core/plan-design/hierarchy/log-files#BKMK_SiteSiteServerLog)」を参照してください。  

このプロセスの詳細については、「[Flowchart - Manage content library](/sccm/core/plan-design/hierarchy/manage-content-library-flowchart)」(フローチャート - コンテンツ ライブラリの管理) を参照してください。

サイトでは実際にコンテンツ ライブラリ ファイルがリモートの場所に*コピー*されます。 このプロセスでは、サイト サーバーの元の場所にあるコンテンツ ライブラリ ファイルは削除されません。 領域を解放するには、管理者がこれらの元のファイルを手動で削除する必要があります。

コンテンツ ライブラリをサイト サーバーに戻す必要がある場合は、このプロセスを繰り返しますが、ローカル ドライブとパスを **[新しい場所]** に入力します。 ドライブに既に存在するフォルダー名を含める必要があります (`D:\SCCMContentLib` など)。 元のコンテンツが残っている場合、このプロセスによって、サイト サーバーのローカルの場所に構成が迅速に移動します。 

> [!Tip]  
> コンテンツをサイト サーバー上の別のドライブに移動するには、**Content Library Transfer** ツールを使用します。 詳細については、[Content Library Transfer ツール](/sccm/core/support/content-library-transfer)に関するページを参照してください。  



## <a name="inside-the-content-library"></a>コンテンツ ライブラリの内部

> [!Warning]  
> 次のセクションは参考のためにのみ提供するものです。 コンテンツ ライブラリ内のファイルまたはフォルダーを変更、追加、または削除しないでください。 これを行うと、パッケージ、コンテンツ、またはコンテンツ ライブラリ全体が破損する可能性があります。 不足、破損、または無効なデータの疑いがある場合は、Configuration Manager コンソールの検証機能を使用してそのような問題を検出してください。 その後、影響を受けたコンテンツを再配布して問題を修正します。 

既定では、コンテンツ ライブラリは **SCCMContentLib** という名前のフォルダーのドライブのルートに保存されます。 既定では、このフォルダーは **SCCMContentLib$** として共有されます。 フォルダーおよび共有のアクセス許可は、誤って破損しないようにするために制限されています。 すべての変更は、Configuration Manager コンソールから行ってください。 このフォルダー内には、次のオブジェクトがあります。  

- パッケージ ライブラリ (**PkgLib** フォルダー): 配布ポイントにどのようなパッケージが存在するかに関する情報です。  

- データ ライブラリ (**DataLib** フォルダー): パッケージの元の構造に関する情報です。  

- ライブラリ ファイル (**FileLib**フォルダー): パッケージ内の元のファイルです。 このフォルダーは通常、記憶域の大部分を使用します。  

![Configuration Manager コンテンツ ライブラリの概要の図](media/content-library-overview.png)

> [!Tip]  
> コンテンツ ライブラリの内容を参照するには、Configuration Manager ツールの **Content Library Explorer** を使用します。 このツールは、コンテンツの変更にはできません。 何が存在するかの分析情報を提供し、検証と再配布を許可するものです。 詳細については、「[Content Library Explorer](/sccm/core/support/content-library-explorer)」を参照してください。  


### <a name="package-library"></a>パッケージ ライブラリ
パッケージ ライブラリ フォルダー **PkgLib** には、配布ポイントに配布されたパッケージごとに 1 つのファイルが含まれています。 ファイル名は、`ABC00001.INI` のようなパッケージ ID です。 このファイルの `[Packages]` セクションは、パッケージに含まれるコンテンツ ID と、バージョンなどの他の情報の一覧です。 たとえば、**ABC00001** は、バージョン **1** の従来のパッケージです。 このファイルのコンテンツ ID は `ABC00001.1` です。


### <a name="data-library"></a>データ ライブラリ
データ ライブラリのフォルダー **DataLib** には、各パッケージの内容ごとに 1 つのファイルと 1 つのフォルダーが含まれます。 たとえば、このファイルとフォルダーにはそれぞれ `ABC00001.1.INI` と `ABC00001.1` の名前が付けられます。 ファイルには、検証のための情報が含まれます。 フォルダーは、元のパッケージからのフォルダー構造を再作成します。 

データ ライブラリ内のファイルは、パッケージの元のファイルの名前を持つ INI ファイルによって置き換えられます。 たとえば、`MyFile.exe.INI` となります。 これらのファイルには、サイズ、変更時刻、ハッシュなどの元のファイルに関する情報が含まれます。 ファイル ライブラリ内で元のファイルを検索する場合は、ハッシュの最初の 4 文字を使用します。 たとえば、MyFile.exe.INI のハッシュは **DEF98765** で、最初の 4 文字は **DEF9** です。


### <a name="file-library"></a>ファイル ライブラリ
コンテンツ ライブラリが複数のドライブにまたがっている場合、パッケージファイルはそのいずれかのドライブのファイル ライブラリ フォルダー **FileLib** にあります。

データ ライブラリで見つかったハッシュの最初の 4 文字を使用して、特定のファイルを検索します。 ファイル ライブラリ フォルダー内には多くのフォルダーがあり、それぞれに 4 文字の名前が付けられています。 ハッシュの最初の 4 文字に一致するフォルダーを探します。 見つかったフォルダーには、1 つまたは複数のセットによる 3 つのファイルが含まれています。 これらのファイルは同じ名前を共有しますが、1 つのファイルの拡張子は INI、もう 1 つのファイルの拡張子が SIG で、あと 1 つのファイルには拡張子がありません。 拡張子のないファイルが元のファイルで、その名前はデータ ライブラリのハッシュと同じです。

たとえば、フォルダー **DEF9** には `DEF98765.INI`、`DEF98765.SIG`、および `DEF98765` が含まれています。 `DEF98765` は元の `MyFile.exe` です。 INI ファイルには、同じファイルを共有する "users" と、コンテンツ ID の一覧が含まれています。 これらの内容もすべて削除されない限り、サイトでは、ファイルが削除されません。


### <a name="drive-spanning"></a>複数ドライブにまたがる使用

コンテンツ ライブラリは複数のドライブにまたがることができます。 これらのドライブは、配布ポイントを作成するときに選択します。 既定では、コンテンツ ライブラリが複数のドライブにまたがる場合、Configuration Manager が自動的にドライブを選択します。

自分でドライブを選択する場合は、プライマリとセカンダリのドライブを選択してください。 サイトでは、すべてのメタデータがプライマリ ドライブ上に格納されます。 ファイル ライブラリはセカンダリ ドライブの間でのみまたがります。 セカンダリ ドライブのフォルダーの共有名には、ドライブ文字が含まれます。 たとえば、D: と E: がコンテンツ ライブラリのセカンダリ ドライブである場合、共有名は **SCCMContentLibD$** および **SCCMContentLibE$** です。

**[自動]** オプションを選択した場合、Configuration Manager は、利用可能な空き領域が最も多いドライブをそのプライマリ ドライブとして選択します。 このドライブ上に、すべてのメタデータが格納されます。 サイトではファイル ライブラリがセカンダリ ドライブの間でのみまたがります。 

構成中に予約領域の量を指定します。 この予約領域の量の空きが、空き領域が最も多いディスクにしかなくなると、Configuration Manager はセカンダリ ディスクの使用を試みます。 新しいドライブを使用するように選択されるたびに、空き領域が最も多いドライブが選択されます。

配布ポイントが特定のセットを除くすべてのドライブを使用することは指定できません。 この動作を防ぐには、ドライブのルート上に `NO_SMS_ON_DRIVE.SMS` という空のファイルを作成します。 このファイルは、Configuration Manager が使用するドライブを選択する前に配置してください。 Configuration Manager が、ドライブのルート上でこのファイルを検出した場合、コンテンツ ライブラリのドライブは使用されません。 



## <a name="troubleshooting"></a>トラブルシューティング

コンテンツ ライブラリに関する問題のトラブルシューティングでは、次のヒントが役立つ可能性があります。  

- サイト サーバー上のログ (**distmgr.log** と **PkgXferMgr.log**) および配布ポイント (**smsdpprov.log**) でポインターにエラーがないかを確認する。  

- [Content Library Explorer](/sccm/core/support/content-library-explorer) ツールを使用する。  

- ウイルス対策ソフトウェアなど、他のプロセスによるファイルのロックがないことを確認する。 自動ウイルス対策スキャンからすべてのドライブのコンテンツ ライブラリと、各ドライブの一時ステージング ディレクトリ **SMS_DP$** を除外する。  

- ハッシュの不一致があるかどうかを確認するため、Configuration Manager コンソールからパッケージを検証する。  

- 最後のオプションとして、コンテンツを再配布する。 このアクションで、ほとんどの問題が解決されるはずです。  


---
title: "サイト リソースを検索する |Microsoft Docs"
description: "System Center Configuration Manager クライアントがサービスの場所を使用してサイト リソースを検索する方法とタイミングについて説明します。"
ms.custom: na
ms.date: 10/06/2016
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology:
- configmgr-other
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: ae72df4b-5f5d-4e19-9052-bda28edfbace
caps.latest.revision: 10
author: Brenduns
ms.author: brenduns
manager: angrobe
translationtype: Human Translation
ms.sourcegitcommit: 1a4a9da88caba55d9e340c7fb1f31f4e3b957f3e
ms.openlocfilehash: b006896091901fab7b141f99f4c95eb22ea61b82


---
# <a name="understand-how-clients-find-site-resources-and-services-for-system-center-configuration-manager"></a>クライアントが System Center Configuration Manager のサイト リソースやサービスを検索する方法を理解する

*適用対象: System Center Configuration Manager (Current Branch)*

System Center Configuration Manager クライアントは、そのクライアントが使用するように指示されているサービスを提供する、通信可能なサイト システム サーバーの場所を特定するために、**サービスの場所**と呼ばれるプロセスを使用しています。   クライアントがサービスの場所を使用してサイト リソースを検索する方法とそのタイミングを理解すると、クライアントの操作を正しくサポートするようにサイトを構成することができます。   これらの構成には、サイトで Active Directory ドメイン サービス (AD DS) や DNS などのドメインおよびネットワーク構成とやり取りをするか、さらに複雑な構成を行うことが必要になる場合があります。  

 サービスを提供するサイト システムの役割の例としては、クライアントのコア サイト システム サーバー、管理ポイント、クライアントと通信できる追加のサイト システム サーバー (配布ポイントやソフトウェアの更新ポイントなど) が挙げられます。  



##  <a name="a-namebkmkfunda-fundamentals-of-service-location"></a><a name="bkmk_fund"></a> Fundamentals of service location  
 クライアントは、サービスの場所を使用して通信可能な管理ポイントを検索する際に、現在のネットワークの場所、通信プロトコル設定、および割り当て済みサイトを評価します。  

 **クライアントは、以下の操作を実行するために管理ポイントと通信します。**  
-   将来のサービスの場所のサイクル用の管理パック リストを構築できるように、サイトの他の管理ポイントに関する情報をダウンロードする。  
-   インベントリやステータスなどの構成の詳細をアップロードする。  
-   クライアントに構成を設定し、インストールが可能または必要なソフトウェアや他の関連タスクについてクライアントに通知することができるポリシーをダウンロードする。  
-   インストール可能なソフトウェアの配布ポイントや、更新プログラムの取得元であるソフトウェア更新ポイントなど、クライアントが使用するように構成されているサービスを提供する、追加のサイト システムの役割についての情報を要求する。  

**Configuration Manager クライアントが、サービスの場所要求を作成します。**  
-   継続操作中 25 時間ごと  
-   クライアントでネットワークの構成または場所の変更が検出された場合  
-   コンピューター (コア クライアント サービス) 上で**ccmexec.exe** サービスが開始された場合  
-   クライアントで、必要なサービスを提供するサイト システムの役割を特定する必要が生じた場合  

**サイト システムの役割をホストするサーバーを検索しようとすると**、クライアントはサービスの場所を使用して、クライアントのプロトコル (HTTP または HTTPS) をサポートするサイト システムの役割を検索します。 既定では、クライアントは次のように使用可能な最も安全な方法を使用します。  

-   HTTPS を使用するには、公開キー基盤 (PKI) を導入し、クライアントとサーバーに PKI 証明書をインストールする必要があります。 証明書の使用方法については、「[System Center Configuration Manager での PKI 証明書の要件](../../../core/plan-design/network/pki-certificate-requirements.md)」を参照してください。  

-   インターネット インフォメーション サービス (IIS) を使用し、クライアントからの通信をサポートするサイト システムの役割を展開する場合は、そのサイト システムにクライアントが接続するときに HTTP と HTTPS のどちらを使用するかを指定する必要があります HTTP を使用する場合は、署名と暗号化のオプションについても検討してください。 詳しくは、「[Plan for security in System Center Configuration Manager](../../../core/plan-design/security/plan-for-security.md)」 (System Center Configuration Manager でのセキュリティの計画) の「[Planning for Signing and Encryption](../../../core/plan-design/security/plan-for-security.md#BKMK_PlanningForSigningEncryption)」 (署名および暗号化の計画) を参照してください。  

##  <a name="a-namebkmkplanservicelocationa-service-location-and-how-clients-determine-their-assigned-management-point"></a><a name="BKMK_Plan_Service_Location"></a> サービスの場所とクライアントが割り当て済み管理ポイントを特定する方法  
クライアントが最初にプライマリ サイトへの割り当てを行うときは、そのサイトの既定の管理ポイントが選択されます。 (プライマリ サイトは複数の管理ポイントをサポートしており、各クライアントが 1 つの管理ポイントを既定の管理ポイントとして個別に識別します)。その結果、既定の管理ポイントは、そのクライアントの割り当て済み管理ポイントとなります。 (クライアント インストール コマンドを使用して、インストール時にクライアントの割り当て済み管理ポイントを設定することもできます)。  

-   クライアントは、そのクライアントの現在のネットワークの場所および境界グループの構成に基づき、通信する管理ポイントを選択します。 割り当て済み管理ポイントがある場合でも、その管理ポイントをクライアントが使用するとは限りません。  

    > [!NOTE]  
    >  クライアントは登録メッセージと特定のポリシー メッセージに対して常に割り当て済み管理ポイントを使用します。これは、他の通信がプロキシまたはローカル管理ポイントに送信される場合でも当てはまります。  

-   優先管理ポイントを使用できます。 優先管理ポイントは、配布ポイントや状態移行ポイントを境界グループに関連付けるのと同じような方法で、境界グループにサイト システム サーバーとして関連付けられた管理ポイントです。 階層の優先管理ポイントを有効にすると、クライアントは、割り当て済みサイトの管理ポイントを使用するときに、割り当て済みサイトの他の管理ポイントを使用する前に優先管理ポイントを使用しようとします。  

-   TechNet.com にある次のブログの情報を使用して、管理ポイントのアフィニティを構成することもできます。 管理ポイントのアフィニティは、割り当て済み管理ポイントの既定の動作を上書きし、クライアントが特定の 1 つ以上の管理ポイントを使用できるようにします。[管理ポイントのアフィニティ](http://blogs.technet.com/b/jchalfant/archive/2014/09/22/management-point-affinity-added-in-configmgr-2012-r2-cu3.aspx)  

クライアントは、管理ポイントへの接続が必要になるたびに、WMI にローカルに格納している既知の管理ポイントのリスト ( **管理パック リスト**とも呼ばれる) を確認します。 クライアントはインストール時に最初の管理パック リストを作成してから、階層内の各管理ポイントの詳細で定期的にリストを更新します。  

クライアントはその管理パック リストで有効な管理ポイントを見つけられない場合、使用できる管理ポイントが見つかるまで、次のサービスの場所のソースを順に検索します。  

1.  管理ポイント  
2.  Active Directory ドメイン サービス  
3.  DNS  
4.  WINS  

これらのソースのいずれかで管理ポイントが見つかって接続に成功した後、クライアントは階層内で使用可能な管理ポイントの現在のリストをダウンロードして、そのローカル管理パック リストを更新します。 これは、ドメインに参加しているクライアントと参加していないクライアントに平等に適用されます。  

たとえば、インターネット上にある Configuration Manager クライアントがインターネットベースの管理ポイントに接続した場合、管理ポイントで、サイト内の使用可能なインターネットベースの管理ポイントのリストがそのクライアントに送信されます。 同様に、ドメインに参加しているクライアントまたはワークグループ内のクライアントは、使用できる管理ポイントのリストも受信します。  
-   インターネット用に構成されていないクライアントには、インターネットのみに接続する管理ポイントが提供されません。  
-   インターネット用に構成されたワークグループ クライアントのみが、インターネットに接続する管理ポイントと通信します。  

##  <a name="a-namebkmkmplista-the-mp-list"></a><a name="BKMK_MPList"></a> 管理パック リスト  
管理パック リストは、クライアントが以前に特定した管理ポイントの優先順位リストであるため、クライアントのサービスの場所のソースとして優先されるソースです。 このリストは、クライアントがリストを更新する際に、ネットワークの場所に基づいてクライアントごとにソートされてから、WMI にローカルに保存されます。  

### <a name="building-the-initial-mp-list"></a>最初の管理パック リストの作成  
クライアントのインストール時に、クライアントの最初の **管理パック リスト**を作成するために次の規則が使用されます。  

-   最初のリストにはクライアントのインストール時に指定される管理ポイントが含まれます ( **SMSMP**= または **/MP** オプションを使用する場合)。  
-   クライアントは Active Directory ドメイン サービス (AD DS) に発行された管理ポイントを照会します。 AD DS から特定されるようにするには、管理ポイントがクライアントの割り当てられたサイトにあり、クライアントと同じ製品バージョンである必要があります。  
-   クライアントのインストール時に管理ポイントが指定されておらず、Active Directory スキーマが拡張されていない場合、クライアントは発行された管理ポイントについて DNS と WINS を確認します。  
-   最初のリストの作成時には、階層内のいくつかの管理ポイントに関する情報が認識されていない場合があります。  

### <a name="organizing-the-management-point-list"></a>管理ポイント リストの整理  
クライアントは、次の分類を使用して管理ポイントのリストを整理します。  

-   **プロキシ**: プロキシ管理ポイントは、セカンダリ サイトにおける管理ポイントです。  
-   **ローカル**: サイト境界で定義されている、クライアントの現在のネットワークの場所に関連付けられているすべての管理ポイント。  
    -   クライアントが複数の境界グループに属している場合、ローカル管理ポイントのリストは、クライアントの現在のネットワークの場所を含むすべての境界の和集合から特定されます。  
    -   通常、 **ローカル** 管理ポイントは、クライアントがその境界グループを提供する管理ポイントがある別のサイトに関連付けられているネットワーク上にない限り、クライアントの **割り当て済み** 管理ポイントのサブセットです。   


-   **割り当て済み**: クライアントの割り当て済みサイトのサイト システムであるすべての管理ポイント。  

     優先管理ポイントを使用できます。 優先管理ポイントは、クライアントの割り当て済みサイトの管理ポイントであり、クライアントがサイト システム サーバーを見つけるために使用している境界グループに関連付けられています。  

     サイトの、境界グループに関連付けられていない管理ポイントや、クライアントの現在のネットワークの場所に関連付けられた境界グループに含まれていない管理ポイントは、優先管理ポイントとは見なされず、クライアントが利用可能な優先管理ポイントを識別できないときに使用されます。  

### <a name="selecting-a-management-point-to-use"></a>使用する管理ポイントの選択  
一般的な通信では、クライアントは、クライアントのネットワークの場所に基づいて、次の順序で分類からの管理ポイントの使用を試みます。  

1.  プロキシ  
2.  ローカル  
3.  割り当て済み  

ただし、他の通信がプロキシまたはローカル管理ポイントに送信される場合でも、クライアントは登録メッセージと特定のポリシー メッセージに対して常に割り当て済み管理ポイントを使用します。  

各分類 (プロキシ、ローカル、または割り当て済み) 内で、クライアントは、次の優先順で管理ポイントの使用を試みます。  

1.  信頼されているフォレストまたはローカル フォレストで HTTPS 対応 (HTTPS 通信用にクライアントが構成されている場合)  
2.  信頼されているフォレストまたはローカル フォレスト以外で HTTPS 対応 (HTTPS 通信用にクライアントが構成されている場合)  
3.  信頼されているフォレストまたはローカル フォレストで HTTP 対応  
4.  信頼されているフォレストまたはローカル フォレスト以外で HTTP 対応  

優先順にソートされた一連の管理ポイントから、クライアントはリストの最初の管理ポイントの使用を試みます。  

-   管理ポイントのソートされたリストはランダムであり、順序付けできません。  
-   リストの順序は、クライアントがその管理ポイント リストを更新するたびに変わる場合があります。  

クライアントは、最初の管理ポイントとの接続を確立できない場合、優先されていない管理ポイントを試す前に分類内の各優先管理ポイントを試すことで、リストの連続した各管理ポイントを試します。 クライアントは、分類内の管理ポイントと正常に通信できない場合、使用する管理ポイントが見つかるまで、次の分類の優先管理ポイントとの通信を試みます。  

クライアントは、管理ポイントとの通信を確立した後、次の状態になるまでその同じ管理ポイントを使用し続けます。  

-   25 時間後に、クライアントは使用する新しい管理ポイントをランダムに選択します。  
-   クライアントは、10 分間に管理ポイントとの通信を 5 回試行して通信できなかった時点で、使用する新しい管理ポイントを選択します。  

##  <a name="a-namebkmkada-active-directory"></a><a name="bkmk_ad"></a> Active Directory  
ドメインに参加しているクライアントは、サービスの場所として Active Directory ドメイン サービス (AD DS) を使用できます。 この場合、 [データを Active Directory に発行する](http://technet.microsoft.com/library/hh696543.aspx)ためのサイトが必要になります。  

次のすべての条件に該当する場合、クライアントは Active Directory ドメイン サービスをサービスの場所として使用できます。  

-   Active Directory [スキーマが拡張されている](https://technet.microsoft.com/library/mt345589.aspx)、または System Center 2012 Configuration Manager用に拡張された。  
-   [Active Directory フォレストが発行用に構成されており](http://technet.microsoft.com/library/hh696542.aspx)、Configuration Manager サイトが発行するように構成されている。  
-   クライアント コンピューターが Active Directory ドメインのメンバーであり、グローバル カタログ サーバーにアクセスできる。  

クライアントは、AD DS からサービスの場所として使用する管理ポイントを見つけられない場合、DNS の使用を試みます。 ドメインに参加しているクライアントは、サービスの場所として AD DS を使用できます。 この場合、 [データを Active Directory に発行する](http://technet.microsoft.com/library/hh696543.aspx)ためのサイトが必要になります。  

##  <a name="a-namebkmkdnsa-dns"></a><a name="bkmk_dns"></a> DNS  
イントラネット上のクライアントは、サービスの場所として DNS を使用できます。 この場合、DNS に管理ポイントに関する情報を発行するためのサイトが階層内に少なくとも 1 つは必要になります。  

次の条件のいずれかに該当する場合は、サービスの場所として DNS の使用を検討してください。
-   Active Directory Domain Services スキーマが Configuration Manager 用に拡張されていない。
-   イントラネットのクライアントが、Configuration Manager からデータを発行できないフォレストに配置されている。  
-   クライアントがワークグループ コンピューターにあり、インターネット専用クライアント管理向けに構成されていない。 (インターネット用に構成されたワークグループ クライアントはインターネットに接続する管理ポイントとのみ通信し、サービスの場所として DNS を使用しません。)  
-   [DNS から管理ポイントを検索するようにクライアントを構成](http://technet.microsoft.com/library/gg682055)できます。  

サイトで DNS に管理ポイントのサービスの場所レコードを発行する場合:  

-   発行は、イントラネットからのクライアント接続を受け入れる管理ポイントにのみ適用できます。  
-   発行時に、管理ポイント コンピューターの DNS ゾーンにサービスの場所リソース レコード (SRV RR) が追加されます。 DNS には、そのコンピューターに対応するホスト エントリがなければなりません。  

既定では、ドメインに参加しているクライアントは、DNS でクライアントのローカル ドメインの管理ポイント レコードを検索します。 DNS に発行された管理ポイント情報があるドメインのドメイン サフィックスを指定するクライアント プロパティを構成することができます。  

クライアントの DNS サフィックスのプロパティを構成する方法については、「[How to configure client computers to find management points by using DNS publishing in System Center Configuration Manager](../../../core/clients/deploy/configure-client-computers-to-find-management-points-by-using-dns-publishing.md)」 (DNS 発行を使用して管理ポイントを検出するようにクライアント コンピューターを構成する方法) を参照してください。  

クライアントは、DNS からサービスの場所として使用する管理ポイントを見つけられない場合、WINS の使用を試みます。  

### <a name="publish-management-points-to-dns"></a>管理ポイントを DNS に発行する  
管理ポイントを DNS に発行するには、次の 2 つの条件を満たさなければなりません。  

-   DNS サーバーに、バージョン 8.1.2 以上の BIND がインストールされ、サービスの場所のリソース レコードを取り扱うことができる。  
-   Configuration Manager 内の管理ポイント用に指定されたイントラネット FQDN に DNS のホスト エントリ (たとえば A レコード) がある。  

> [!IMPORTANT]  
>  Configuration Manager の DNS 発行では、不整合のある名前空間はサポートされません。 不整合のある名前空間が存在する場合、手動で DNS に管理ポイントを発行するか、このセクションで説明している別のサービス検出方法のいずれかを使用します。  

**DNS サーバーが自動更新をサポートしている場合は**、イントラネットの管理ポイントが DNS に自動的に発行されるように Configuration Manager を構成することも、これらのレコードを DNS に手動で発行することもできます。 DNS に管理ポイントが発行されると、そのイントラネット FQDN とポート番号がサービスの場所 (SRV) レコードで公開されます。 サイトの管理ポイント コンポーネント プロパティで、サイトでの DNS 発行を構成します。 詳細については、「[Site components for System Center Configuration Manager](../../../core/servers/deploy/configure/site-components.md)」 (System Center Configuration Manager のサイト コンポーネント) を参照してください。  

**DNS ゾーンが動的更新に対して "セキュアのみ" に設定されている場合**、DNS に発行する最初の管理ポイントのみを既定のアクセス許可で正常に動的更新できます。
- 正常に発行してその DNS レコードを変更できるのが 1 つの管理ポイントのみの場合は、その管理ポイント サーバーが正常である限り、クライアントはその管理ポイントから完全な MP リストを取得し、優先管理ポイントを検索できます。


**DNS サーバーが自動更新をサポートしていないが、サービスの場所レコードをサポートする場合は**、管理ポイントを DNS に手動で発行することができます。 このためには、サービスの場所リソース レコード (SRV RR) を DNS で手動で指定する必要があります。  

Configuration Manager では、RFC 2782 に従って、次の形式でサービスの場所レコードを指定します。*_Service._Proto.Name TTL Class SRV Priority Weight Port Target*  

Configuration Manager に管理ポイントを発行するには、次の値を指定します。  

-   **_Service**: **_mssms_mp***_&lt;サイトコード\>* と入力します。*&lt;サイトコード\>* は、管理ポイントのサイト コードです。  
-   **._Proto**: **._tcp**を指定します。  
-   **.Name**: 管理ポイントの DNS サフィックスを入力します (例: **contoso.com**)。  
-   **TTL**: 「 **14400**」と入力します (4 時間)。  
-   **Class**: **IN** を指定します (RFC 1035 に準拠)。  
-   **Priority**: このフィールドは、Configuration Manager では使用しません。
-   **Weight**: このフィールドは、Configuration Manager では使用しません。  
-   **Port**: 管理ポイントで使用されるポート番号を入力します。たとえば、HTTP の場合は **80** 、HTTPS の場合は **443** です。  

    > [!NOTE]  
    >  SRV レコードのポートは、管理ポイントで使用する通信ポートと一致する必要があります。 既定では、これは HTTP 通信の場合は **80** 、HTTPS 通信の場合は **443** になります。  

-   **Target**: 管理ポイント サイトの役割が構成されているサイト システムに指定されているイントラネット FQDN を入力します。  

Windows Server DNS を使用する場合、次の手順に従って、イントラネット管理ポイントにこの DNS レコードを入力します。 DNS の別の実装を使用する場合、このセクションのフィールド値に関する情報を参考にし、その DNS のドキュメントを参照して、この手順を適合させます。  

##### <a name="to-configure-automatic-publishing"></a>自動発行を構成するには  

1.  Configuration Manager コンソールで、[**管理**] > [**サイトの構成**] > [**サイト**] の順に展開します。  

2.  サイトを選択してから、[ **サイト コンポーネントの構成**] をクリックします。  

3.  [ **管理ポイント**] を選択します。  

4.  発行する管理ポイントを選択します。 (この選択は、AD DS および DNS への発行に適用されます。)  

5.  チェックボックスを選択して DNS に発行します。  

    -   このダイアログ ボックスでは、発行する管理ポイントと、DNS への発行を選択できます。  

    -   このダイアログ ボックスでは、AD DS への発行は構成されません。  

##### <a name="to-manually-publish-management-points-to-dns-on-windows-server"></a>Windows Server の DNS に手動で管理ポイントを発行するには  

1.  Configuration Manager コンソールで、サイト システムのイントラネット FQDN を指定します。  

2.  DNS 管理コンソールで、管理ポイント コンピューターの DNS ゾーンを選択します。  

3.  サイト システムのイントラネット FQDN のホスト レコード (A または AAAA) があることを確認します。 このレコードが存在しない場合は作成します。  

4.  [ **その他の新しいレコード** ] オプションを使用して、[ **リソース レコードの種類** ] ダイアログ ボックスの [ **サービスの場所 (SRV)** ] をクリックして、[ **レコードの作成**] をクリックし、次の情報を入力して、[ **完了**] をクリックします。  

    -   **Domain**: 必要に応じて、管理ポイントの DNS サフィックスを入力します (例: **contoso.com**)。  
    -   **Service**: **_mssms_mp***_&lt;サイトコード\>* と入力します。*&lt;サイトコード\>* は、管理ポイントのサイト コードです。  
    -   **Protocol**: 「 **_tcp**」と入力します。  
    -   **Priority**: このフィールドは、Configuration Manager では使用しません。  
    -   **Weight**: このフィールドは、Configuration Manager では使用しません。  
    -   **Port**: 管理ポイントで使用されるポート番号を入力します。たとえば、HTTP の場合は **80** 、HTTPS の場合は **443** です。  

        > [!NOTE]  
        >  SRV レコードのポートは、管理ポイントで使用する通信ポートと一致する必要があります。 既定では、これは HTTP 通信の場合は **80** 、HTTPS 通信の場合は **443** になります。  

    -   **このサービスを提供しているホスト**: 管理ポイント サイトの役割が構成されているサイト システムに指定されている、イントラネット完全修飾ドメイン名 (FQDN) を入力します。  

DNS に発行するイントラネットの管理ポイントごとに、上記の手順を繰り返します。  

##  <a name="a-namebkmkwinsa-wins"></a><a name="bkmk_wins"></a> WINS  
他のサービスの場所が見つからない場合は、クライアントは WINS で接続する管理ポイントを探します。  

既定では、プライマリ サイトで、HTTP 用に構成されているサイトの最初の管理ポイントと HTTPS 用に構成されている最初の管理ポイントを WINS に発行します。  

クライアントが WINS で HTTP 管理ポイントを探さないようにする場合は、クライアントの CCMSetup.exe の Client.msi のプロパティで **SMSDIRECTORYLOOKUP=NOWINS**と指定します。  



<!--HONumber=Dec16_HO3-->



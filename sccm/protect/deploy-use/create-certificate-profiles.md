---
title: SCEP 証明書プロファイルを作成する方法
titleSuffix: Configuration Manager
description: 証明書プロファイルを使用して、System Center Configuration Manager で必要な証明書で、マネージド デバイスをプロビジョニングする方法について説明します。
ms.date: 03/28/2017
ms.prod: configuration-manager
ms.technology: configmgr-protect
ms.topic: conceptual
ms.assetid: 634d612c-92d7-4c03-873a-b2e730c9a72d
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 87b79c452054b3dd6d27def27a5d06a959a17f32
ms.sourcegitcommit: 48098f9fb2f447672bf36d50c9f58a3d26acb9ed
ms.translationtype: MTE75
ms.contentlocale: ja-JP
ms.lasthandoff: 12/14/2018
ms.locfileid: "53418970"
---
# <a name="create-certificate-profiles"></a>証明書プロファイルの作成

*適用対象: System Center Configuration Manager (Current Branch)*


Configuration Manager (SCCM) で証明書プロファイルを使用して、会社のリソースにアクセスするために必要な証明書で、マネージド デバイスをプロビジョニングします。 証明書プロファイルを作成する前に、[System Center Configuration Manager の証明書インフラストラクチャの設定](certificate-infrastructure.md)の手順に従って、証明書インフラストラクチャを設定します。  

このトピックでは、信頼されたルートおよび SCEP 証明書プロファイルを作成する方法について説明します。 PFX 証明書プロファイルを作成する場合は、「[PFX 証明書プロファイルを作成する方法](../../protect/deploy-use/create-pfx-certificate-profiles.md)」をご覧ください。

証明書プロファイルを作成するには:

1.  証明書プロファイルの作成ウィザードを開始します。
1.  証明書の全般的な情報を指定します。
1.  信頼された証明機関 (CA) 証明書を構成します。  
1.  SCEP 証明書情報を構成します (SCEP 証明書に対してのみ)。  
1.  証明書プロファイルの対応プラットフォームを指定します。


## <a name="start-the-create-certificate-profile-wizard"></a>証明書プロファイルの作成ウィザードを開始する  

1.  System Center Configuration Manager コンソールで、**[資産とコンプライアンス]** をクリックします。  

2.  **[資産とコンプライアンス]** ワークスペースで、**[コンプライアンス設定]**、**[会社のリソースへのアクセス]** の順に展開してから、**[証明書プロファイル]** をクリックします。  

3.  **[ホーム]** タブの **[作成]** グループで、**[証明書プロファイルの作成]** をクリックします。  

## <a name="provide-general-information-about-the-certificate-profile"></a>証明書プロファイルの全般的な情報を指定する  

証明書プロファイルの作成ウィザードの **[全般]** ページで、次の情報を指定します。  

-   **名前**: 証明書プロファイルの一意の名前を入力します。 最大 256 文字を使用できます。  

-   **説明**:System Center Configuration Manager コンソールで証明書プロファイルを区別しやすくなるように、簡単な説明と他の関連情報を入力します。 最大 256 文字を使用できます。  

-   **作成する証明書プロファイルの種類を指定します**: 次の証明書プロファイルの種類のいずれかを選択します。  

-   **信頼された CA 証明書**: ユーザーまたはデバイスが他のデバイスを認証する必要があり、信頼されたルート証明機関 (CA) 証明書または中間 CA 証明書を展開して信頼証明書チェーンを形成する場合に、この証明書プロファイルの種類を選択します。 たとえば、リモート認証ダイヤルイン ユーザー サービス (RADIUS) サーバーや仮想プライベート ネットワーク (VPN) サーバーなどのデバイスで認証する場合が当てはまります。 また、SCEP 証明書プロファイルを作成する前に、信頼された証明機関証明書を構成する必要があります。 この場合は、信頼された CA 証明書は、ユーザーまたはデバイスに証明書を発行する証明機関の信頼されたルート証明書でなければなりません。  

-   **Simple Certificate Enrollment Protocol (SCEP) 設定**: Simple Certificate Enrollment Protocol とネットワーク デバイス登録サービスの役割サービスを使用して、ユーザーまたはデバイスの証明書を要求する場合は、この証明書プロファイルの種類を選択します。

-   **Personal Information Exchange PKCS #12 (PFX) の設定 - インポート**: PFX 証明書をインポートする場合に、これを選択します。 PFX 証明書の作成の詳細については、「[Import PFX certificate profiles](/sccm/mdm/deploy-use/import-pfx-certificate-profiles.md)」(PFX 証明書プロファイルをインポートする) を参照してください。

-   **Personal Information Exchange -- PKCS #12 (PFX) 設定 -- 作成**: 証明機関を使用して PFX 証明書を処理する場合に選択します。 PFX 証明書の作成の詳細については、「[PFX 証明書プロファイルを作成する方法](/sccm/mdm/deploy-use/create-pfx-certificate-profiles.md)」をご覧ください。


## <a name="configure-a-trusted-ca-certificate"></a>信頼された証明機関証明書を構成する  

> [!IMPORTANT]  
>  SCEP 証明書プロファイルを作成する前に、少なくとも 1 つの信頼された証明機関証明書を構成する必要があります。    
>  
>  証明書を展開後に次のいずれかの値を変更すると、新しい証明書が要求されます。
>  -  キー格納プロバイダー
>  -  証明書テンプレート名
>  -  証明書の種類
>  -  サブジェクト名の形式
>  -  サブジェクト代替名
>  -  証明書の有効期間
>  -  キー使用法
>  -  キーのサイズ
>  -  拡張キー使用法
>  -  ルート CA 証明書

1. 証明書プロファイルの作成ウィザードの **[信頼された証明機関証明書]** ページで、次の情報を指定します。  

   -   **証明書ファイル**: **[インポート]** をクリックしてから、使用したい証明書ファイルを見つけます。  

   -   **保存先ストア**: デバイスに証明書ストアが複数ある場合は、証明書の保存先を選択します。 ストアが 1 つのみのデバイスの場合、この設定は無視されます。  

2. **[証明書の拇印]** 値を使用して、正しい証明書がインポートされたことを確認します。  


## <a name="configure-scep-certificate-information-only-for-scep-certificates"></a>SCEP 証明書情報を構成する (SCEP 証明書に対してのみ)  

1. 証明書プロファイルの作成ウィザードの **[SCEP サーバー]** ページで、SCEP 経由で証明書を発行する NDES サーバーの URL を指定します。 証明書登録ポイント サイト システム サーバーの構成に基づいて NDES URL を自動的に割り当てることも、手動で URL を追加することもできます。  

2. 証明書プロファイルの作成ウィザードの **[SCEP 登録]** ページで情報を指定します。

   -  **再試行**: ネットワーク デバイス登録サービスを実行しているサーバーに、デバイスが証明書の要求を自動的に再試行する回数を指定します。 この設定は、CA マネージャーが証明書の要求を事前に承認する必要がある場合に便利です。 この設定は、通常、厳重なセキュリティを施行している環境や、エンタープライズ CA ではなくスタンドアロン CA がある環境で使用します。 また、発行元 CA が証明書要求を処理する前に証明書要求オプションを確認するテスト目的で、この設定を使用することもあります。 この設定は、**[再試行の待ち時間 (分)]** 設定と共に使用してください。  

   -   **再試行の待ち時間 (分)**: 発行元 CA が証明書要求を処理する前に CA マネージャーの承認を使用するときの登録の再試行間隔 (分) を指定します。 テスト目的で CA マネージャーの承認を受けるようにする場合は、小さな値を指定して、証明書要求が承認されてからデバイスが証明書要求を再試行するまでの時間を短くします。 ただし、実稼働ネットワークでマネージャーの承認を使用する場合、CA マネージャーが保留中の承認を確認し、承認するか拒否するかを判断する処理に十分な時間をかけるようにするには、高い値を指定します。  

   -   **更新しきい値 (%)**: 証明書の有効期間の残りがどの程度 (%) になったら、デバイスが更新を要求するかを指定します。  

   -   **キー格納プロバイダー (KSP)**: 証明書のキーを格納する場所を指定します。 次のいずれかの値を選択します。  

   -   **トラステッド プラットフォーム モジュール (TPM) にインストールする (存在する場合)**: TPM にキーをインストールします。 TPM が存在しない場合、キーはソフトウェア キーの格納プロバイダーにインストールされます。  

   -   **トラステッド プラットフォーム モジュール (TPM) にインストールする (それ以外は失敗)**: TPM にキーをインストールします。 TPM モジュールが存在しない場合、インストールは失敗します。  

   -   **Windows Hello for Business にインストールする (それ以外は失敗)** このオプションは、Windows 10 Desktop および Mobile デバイスで利用可能です。 このオプションは、キーを **Windows Hello for Business** に登録します。「[System Center Configuration Manager における Windows Hello for Business の設定](../../protect/deploy-use/windows-hello-for-business-settings.md)」をご覧ください。 また、このオプションを使用すると、これらのデバイスに証明書を発行する前には、デバイスの登録中に **[多要素認証が必要]** となるようにできます。 詳しくは、「 [多要素認証を使用して Windows デバイスを保護する](https://technet.microsoft.com/library/dn889751.aspx) 」をご覧ください。

   > [!NOTE]  
   > 
   > ユーザーが Windows Hello for Business の PIN を作成すると、Windows は、Configuration Manager がリッスンする通知を送信します。 これにより、Configuration Manager が、Windows Hello の PIN を作成したユーザーをすぐに認識できるようになります。 その後、Windows Hello が証明書プロファイルでのキー記憶域プロバイダーとして使用される場合に、Configuration Manager はそれらのユーザーに対して新しい証明書を発行することもできます。  

   -   **ソフトウェア キー記憶域プロバイダーにインストールする**: ソフトウェア キー格納プロバイダーにキーをインストールします。  

   -   **証明書登録用のデバイス**: 証明書プロファイルをユーザー コレクションに展開する場合は、証明書の登録をユーザーのプライマリ デバイスだけで可能にするか、ユーザーがログオンするすべてのデバイスで可能にするかを選択します。 証明書プロファイルをデバイス コレクションに展開する場合は、証明書登録をデバイスのプライマリ ユーザーだけに許可するか、デバイスにログオンしているすべてのユーザーに許可するかを指定します。  

3. 証明書プロファイルの作成ウィザードの **[証明書のプロパティ]** ページで、次の情報を指定します。  

   -   **証明書テンプレート名**: **[参照]** をクリックして、ネットワーク デバイス登録サービスが使用するように構成され、発行元 CA に追加されている証明書テンプレートの名前を選択します。 証明書テンプレートを参照するには、System Center Configuration Manager コンソールを実行するために使用するユーザー アカウントが、証明書テンプレートに対する読み取りアクセス許可を持っている必要があります。 **[参照]** を使用できない場合は、証明書テンプレートの名前を入力します。  

   > [!IMPORTANT]
   >   
   >  証明書テンプレート名に、ASCII 以外の文字 (漢字など) が含まれていると、証明書が展開されません。 証明書が正しく展開されるように、CA の証明書テンプレートのコピーを作成して、ASCII 文字だけの名前に変更してください。  

   次に、[参照] を使って証明書テンプレートを選択する場合と、証明書テンプレートの名前を入力する場合の注意事項を示します。  

   -   [参照] を使って証明書テンプレートの名前を選択した場合は、ページ内のフィールドが、そのテンプレートにある値で自動的に埋められます。 場合によっては、別の証明書テンプレートを選択しないと、これらの値を変更できないことがあります。  

   -   証明書テンプレートの名前を入力する場合は、ネットワーク デバイス登録サービスを実行しているサーバーのレジストリに登録されている証明書テンプレートの名前と正確に同じ名前でなければなりません。 必ず、証明書テンプレートの表示名ではなく、証明書テンプレート自体の名前を入力してください。  

   証明書テンプレートの名前を調べるには、HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography\MSCEP 証明書テンプレートは、**[EncryptionTemplate]**、**[GeneralPurposeTemplate]**、および **[SignatureTemplate]** の値として登録されています。 既定では、3 つの証明書テンプレートのすべての値は **[IPSECIntermediateOffline]** です。これは、**[IPsec (オフライン要求)]** のテンプレートの表示名にマップされます。  

   > [!WARNING]  
   > 
   >  証明書テンプレート名を選択するのではなく入力した場合は、System Center Configuration Manager によって証明書テンプレートの内容が検証されないので、証明書テンプレートでサポートされていないオプションを選択してしまう可能性があります。この場合は、証明書要求に失敗します。 この問題が発生すると、証明書署名要求 (CSR) のテンプレート名とチャレンジが一致しないという w3wp.exe のエラーメッセージが、CPR.log ファイルに記録されます。  
   >   
   >  **[GeneralPurposeTemplate]** 値に指定した証明書テンプレートの名前を入力すると、証明書プロファイルの **[キーの暗号化]** オプションと **[キーの暗号化とデジタル署名]** オプションを選択する必要があります。 ただし、この証明書プロファイルで **[キーの暗号化]** オプションのみを有効にする場合は、**[EncryptionTemplate]** キーの証明書テンプレート名を指定します。 同様に、この証明書プロファイルで **[デジタル署名]** オプションのみを有効にする場合は、**[SignatureTemplate]** キーの証明書テンプレート名を指定します。  

   -   **証明書の種類**: 証明書をデバイスとユーザーのどちらに展開するかを選択します。  
   -   **サブジェクト名の形式**: 一覧から、System Center Configuration Manager が証明書要求のサブジェクト名をどのように自動生成するかを選択します。 証明書がユーザー用の場合、サブジェクト名にユーザーのメール アドレスを追加することもできます。 
    
   > [!NOTE]  
   > 
   > **[IMEI 番号]** または **[シリアル番号]** を選択することで、同じユーザーが所有するさまざまなデバイスを区別できます。 たとえば、デバイスで共通名を共有できますが、IMEI 番号やシリアル番号は共有できません。 デバイスが IMEI やシリアル番号をレポートしない場合、証明書は共通名で発行されます。

   -   **サブジェクトの別名**: System Center Configuration Manager が証明書要求のサブジェクトの別名 (SAN) の値をどのように自動生成するかを指定します。 たとえば、ユーザー証明書の種類を選択した場合は、サブジェクトの別名にユーザー プリンシパル名 (UPN) を含めることができます。  クライアント証明書を Windows ポリシー サーバーでの認証に使用する場合は、サブジェクトの別名を UPN に設定する必要があります。  

   > [!NOTE]  
   >  - iOS デバイスでサポートされている SCEP 証明書のサブジェクト名の形式とサブジェクトの別名は限られています。 サポートされていない形式を指定すると、証明書は iOS デバイスに登録されません。 iOS デバイスに展開する SCEP 証明書プロファイルを構成する場合は、**[サブジェクト名の形式]** を **[共通名]** に、**[サブジェクトの別名]** を **[DNS 名]**、**[電子メール アドレス]**、または **[UPN]** に設定してください。  

   -   **証明書の有効期間**: 発行元 CA で certutil - setreg Policy\EditFlags +EDITF_ATTRIBUTEENDDATE コマンドを実行してカスタム有効期間を設定できるようにした場合は、証明書が失効するまでの期間を指定できます。 このコマンドの詳細については、[System Center Configuration Manager の証明書インフラストラクチャ](../../protect/deploy-use/certificate-infrastructure.md)のトピックをご覧ください。  

   指定した証明書テンプレートの有効期限よりも小さい値を指定できますが、大きい値は指定できません。 たとえば、証明書テンプレートで証明書の有効期限が 2 年になっている場合は、この値を 1 年することはできますが、5 年にすることはできません。 また、発行元の CA の証明書の残りの有効期限よりも小さい値を指定する必要があります。  

   -   **キー使用法**: 証明書のキー使用法のオプションを指定します。 次のオプションから選択できます。  

       -   **キーの暗号化**: キーが暗号化されている場合にのみ、キーを交換できます。  

       -   **デジタル署名**: キーがデジタル署名で保護されている場合にのみ、キーを交換できます。  

   **[参照]** を使って証明書テンプレートを選択した場合は、別の証明書テンプレートを選択しないと、これらの設定を変更できないことがあります。  

   選択した証明書テンプレートには、上記のキー使用法オプションの 1 つまたは両方が構成されている必要があります。 構成されていないと、 **CSR のキー使用法とチャレンジが一致しない** というメッセージが証明書の登録ポイントのログ ファイル ( **Crp.log** ) に記録されます。  


- **キー サイズ (ビット)**: ビット単位のキーのサイズを選択します。   

- **拡張キー使用法**: **[選択]** をクリックして、証明書の使用目的に対応する値を追加します。 ほとんどの場合、ユーザーまたはデバイスがサーバーに対して認証できるように、証明書には **[クライアント認証]** が必要です。 ただし、必要に応じてその他のキー使用法を追加できます。  


- **ハッシュ アルゴリズム**: この証明書で使用するハッシュ アルゴリズムの種類を 1 つ選択します。 接続しているデバイスをサポートするセキュリティの最も強力なレベルを選択します。  

  > [!NOTE]  
  > 
  >  **SHA-2** では、SHA-256、SHA-384、および SHA-512 をサポートします。 **SHA-3** では、SHA-3 のみをサポートします。  

- **ルート CA 証明書**: **[選択]** をクリックして、既に構成してユーザーまたはデバイスに展開しているルート CA 証明書プロファイルを選択します。 この CA 証明書は、この証明書プロファイルで構成している証明書を発行する CA のルート証明書である必要があります。  

  > [!IMPORTANT]  
  >  ユーザーまたはデバイスに展開されていないルート CA 証明書を指定すると、System Center Configuration Manager が、この証明書プロファイルで構成している証明書要求を開始しません。  


##  <a name="specify-supported-platforms-for-the-certificate-profile"></a>証明書プロファイルの対応プラットフォームを指定する  

1. 証明書プロファイルの作成ウィザードの **[サポートされているプラットフォーム]** ページで、証明書プロファイルをインストールするオペレーティング システムを選択します。 すべての使用可能なオペレーティング システムに証明書プロファイルをインストールするには、**[すべて選択]** を選択します。
2. ウィザードの **[概要]** ページを確認して、**[完了]** を選びます。 
 
 
新しい証明書プロファイルが **[資産とコンプライアンス]** ワークスペースの **[証明書プロファイル]** ノードに表示され、「[How to deploy profiles in System Center Configuration Manager](deploy-wifi-vpn-email-cert-profiles.md)」(System Center Configuration Manager でプロファイルを展開する方法) で説明されているように、ユーザーまたはデバイスに展開できるようになります。  
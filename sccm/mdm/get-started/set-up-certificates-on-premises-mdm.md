---
title: '証明書を設定する '
titleSuffix: Configuration Manager
description: System Center Configuration Manager でのオンプレミスのモバイル デバイス管理のために信頼された通信用の証明書をセットアップします。
ms.date: 03/05/2017
ms.prod: configuration-manager
ms.technology: configmgr-hybrid
ms.topic: conceptual
ms.assetid: 2a7d7170-1933-40e9-96d6-74a6eb7278e2
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.collection: M365-identity-device-management
ms.openlocfilehash: 8443430b55ee61e9ad5eeac1e70342dfa6e85851
ms.sourcegitcommit: 874d78f08714a509f61c52b154387268f5b73242
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/12/2019
ms.locfileid: "56122374"
---
# <a name="set-up-certificates-for-trusted-communications-for-on-premises-mobile-device-management-in-system-center-configuration-manager"></a>System Center Configuration Manager でのオンプレミスのモバイル デバイス管理のために信頼された通信用の証明書をセットアップする

「オブジェクトの*適用対象: System Center Configuration Manager (Current Branch)*

オンプレミスのモバイル デバイス管理の System Center Configuration Manager は、マネージド デバイスとの信頼された通信のために、登録ポイント、登録プロキシ ポイント、配布ポイント、およびデバイス管理ポイントのサイト システムの役割をセットアップする必要があります。 1 つまたは複数のこれらの役割をホストしているサイト システム サーバーには、そのシステムの Web サーバーにバインドされた一意な PKI 証明書が必要です。 サーバーの証明書と同じルートの証明書も、信頼された通信を確立するためにマネージド デバイスに格納されます。  

 ドメインに参加しているデバイスの場合は、必要とする信頼されたルート証明書は Active Directory 証明書サービスですべてのデバイスに自動的にインストールされます。 ドメインに参加していないデバイスの場合は、有効な信頼されたルート証明書を別の方法で取得する必要があります。 信頼されたルートとしてサイトの CA (ドメインに参加しているデバイスに対して Active Directory が使用する CA と同じ) を使用する場合は、登録ポイントと登録プロキシ ポイントのサイト システム サーバーにバインドされているその CA によって発行された証明書が必要です。  

 サイト システムの役割との信頼された通信をサポートするには、同じルートの証明書が管理対象デバイスにインストールされている必要もあります。 一括登録されたデバイスの場合は、ユーザーによる最デバイスの初回起動時にデバイスを登録することを目的としてデバイスに追加された登録パッケージに、証明書を含めることができます。 ユーザーが登録したデバイスの場合は、電子メール、Web からのダウンロード、またはその他の方法で、証明書を追加する必要があります。  

 ドメインに参加していないデバイスのための代替方法として、よく知られた公的 CA (Verisign や GoDaddy) のルートを使用して、サーバー証明書を発行できます。これにより、ほとんどのデバイスは公的 CA の同じルートに基づいてサーバーへの接続をネイティブで信頼するようになることから、デバイスに証明書を手動でインストールする必要がなくなります。 これは、ユーザーが登録した各デバイスに、サイト CA によって信頼された証明書をインストールすることが不可能な場合に便利な代替方法です。  

> [!IMPORTANT]  
>  オンプレミスのモバイル デバイス管理のためにデバイスとサイト システム サーバーの間の信頼された通信用に証明書をセットアップする方法はいくつもあります。 この記事に書かれている情報は、1 つの方法例として提供されています。 この方法では、Active Directory 証明書サービスの役割、および証明機関と証明機関 Web 登録の役割サービスがインストールされているサイトで、サーバーを実行している必要があります。 この Windows Server の役割に関する詳細とガイダンスについては、「[Active Directory 証明書サービス](http://go.microsoft.com/fwlink/p/?LinkId=115018)」を参照してください。  

 オンプレミスのモバイル デバイス管理に必要な SSL 通信用に Configuration Manager サイトをセットアップするには、次の概要手順のようにします。  

-   [CRL を公開するように証明機関を構成する](#bkmk_configCa)  

-   [CA で Web サーバー証明書テンプレートを作成する](#bkmk_certTempl)  

-   [各サイト システムの役割用の Web サーバー証明書を要求する](#bkmk_requestCert)  

-   [Web サーバーに証明書をバインドする](#bkmk_bindCert)  

-   [Web サーバー証明書と同じルートの証明書をエクスポートする](#bkmk_exportCert)  

##  <a name="bkmk_configCa"></a> CRL を公開するように証明機関 (CA) を構成する  
 既定では、証明機関 (CA) は、ドメインに参加しているデバイスの接続を許可する LDAP ベースの証明書失効リスト (CRL) を使用します。 ドメインに参加していないデバイスが CA から発行された証明書に基づいて信頼されるようにするには、HTTP ベースの CRL を CA に追加する必要があります。 これらの証明書は、Configuration Manager サイト システムの役割をホストするサーバーとオンプレミスのモバイル デバイス管理に登録されたデバイスの間の SSL 通信に必要です。  

 ドメインに参加しているデバイスとドメインに参加していないデバイスの信頼された接続を可能にする証明書を発行するための CRL 情報を自動公開するように CA を構成するには、次の手順に従います。  

1.  サイトの証明機関を実行しているサーバーで **[スタート]** > **[管理ツール]** > **[証明機関]** をクリックします。  

2.  [証明機関] コンソールで、**[証明機関]** を右クリックしてから、**[プロパティ]** をクリックします。  

3.  [証明機関] プロパティで **[拡張機能]** タブをクリックして、**[拡張機能を選択してください]** が **[CRL 配布ポイント (CDP)]** に設定されていることを確認します。  

4.  **http://<ServerDNSName\>/CertEnroll/<CAName\><CRLNameSuffix\><DeltaCRLAllowed\>.crl** を選択します。 次の 3 つのオプションも選択します。  

    -   **CRL に含め、クライアントはこれを使って Delta CRL の場所を検索する**  

    -   **発行された証明書の CDP 拡張機能に含める**  

    -   **発行された CRL の IDP 拡張機能に含める**  

5.  **[終了モジュール]** タブをクリックして、**[プロパティ...]** をクリックしてから、**[ファイル システムに証明書の公開を許可する]** を選択します。  

6.  Active Directory 証明書サービスの再起動が必要であることを知らされたら、**[OK]** をクリックします。  

7.  **[失効した証明書]** を右クリックして、**[すべてのタスク]** をクリックし、次に **[公開]** をクリックします。  

8.  [CRL の公開] ダイアログ ボックスで、**[Delta CRL のみ]** をクリックしてから **[OK]** をクリックします。  

##  <a name="bkmk_certTempl"></a> CA で Web サーバー証明書テンプレートを作成する  
 CA で新しい CRL を公開した後の次の手順では、Web サーバー証明書テンプレートを作成します。 登録ポイント、登録プロキシ ポイント、配布ポイント、およびデバイス管理ポイントのサイト システムの役割をホストするサーバーの証明書を発行するには、このテンプレートが必要です。 これらのサーバーは、サイト システムの役割と登録されたデバイスの間の信頼された通信のための SSL エンドポイントになります。    証明書テンプレートを作成するのには、次の手順に従います。  

1.  登録されたデバイスとの信頼された通信を必要とするサイト システムを実行するサーバーを含む、「**ConfigMgr MDM Servers**」という名前のセキュリティ グループを作成します。  

2.  [証明機関] コンソールで、**[証明書テンプレート]** を右クリックしてから、**[管理]** をクリックして、[証明書テンプレート] コンソールを読み込みます。  

3.  結果ウィンドウで、 **[テンプレート表示名]** 列に **[Web サーバー]** と表示されているエントリを右クリックし、 **[テンプレートの複製]** をクリックします。  

4.  **[テンプレートの複製]** ダイアログ ボックスで、**[Windows 2003 Server Enterprise Edition]** が選択されていることを確認してから、**[OK]** をクリックします。  

    > [!IMPORTANT]  
    >  **[Windows 2008 Server Enterprise Edition]** を選択しないでください。 Configuration Manager では、HTTPS を使用する信頼された通信用の Windows Server 2008 証明書テンプレートはサポートされません。  

    > [!NOTE]  
    >  使用している CA が Windows Server 2012 にある場合は、**[テンプレートの複製]** をクリックしても、証明書テンプレートのバージョンの入力は求められません。 代わりに、次のように、テンプレートのプロパティの **[互換性]** タブでバージョンを指定します。  
    >   
    >  **証明機関**:**Windows Server 2003**  
    >   
    >  **証明書の受信者**:**Windows XP / Server 2003**  

5.  **[新しいテンプレートのプロパティ]** ダイアログ ボックスの **[全般]** タブで、「**ConfigMgr MDM Web Server**」など、Configuration Manager のサイト システムで使用される Web 証明書を生成するテンプレート名を入力します。  

6.  **[サブジェクト名]** タブをクリックして、**[Active Directory の情報から構築する]** を選択します。サブジェクト名の形式として **[DNS 名]** を指定します。 **[ユーザー プリンシパル名 (UPN)]** が選択されている場合は、代替サブジェクト名のチェック ボックスをオフにします。  

7.  **[セキュリティ]** タブをクリックし、セキュリティ グループの **[Domain Admins]** および **[Enterprise Admins]** から **[登録]** アクセス許可を削除します。  

8.  **[追加]** をクリックして、テキスト ボックスに「**ConfigMgr MDM Servers**」と入力し、**[OK]** をクリックします。  

9. このグループに対して **[登録]** アクセス許可を選択し、**[読み取り]** をオフにしません。  

10. **[OK]** をクリックして、[証明書テンプレート] コンソールを閉じます。  

11. [証明機関] コンソールで、**[証明書テンプレート]** を右クリックし、**[新規作成x]** をクリックして **[発行する証明書テンプレート]** をクリックします。  

12. **[証明書テンプレートの選択]** ダイアログ ボックスで、先ほど作成した新しいテンプレート **ConfigMgr MDM Web Server** を選択して、**[OK]** をクリックします。  

##  <a name="bkmk_requestCert"></a> 各サイト システムの役割用の Web サーバー証明書を要求する  
 オンプレミスのモバイル デバイス管理に登録されたデバイスは、登録ポイント、登録プロキシ ポイント、配布ポイント、およびデバイス管理ポイントをホストしている SSL エンドポイントを信頼する必要があります。  次の手順では、IIS の Web サーバー証明書を要求する方法について説明します。 オンプレミスのモバイル デバイス管理に必要なサイト システムの役割の 1 つをホストしているサーバー (SSL エンドポイント) ごとに、これを行う必要があります。  

1. プライマリ サイト サーバーで管理者権限を使用してコマンド プロンプトを開いて、**MMC** と入力してから、**Enter** キーを押します。  

2. MMC で、**[ファイル]** > **[スナップインの追加と削除]** の順にクリックします。  

3. 証明書スナップインで、**[証明書]** を選択してから、**[追加]** をクリックして、**[コンピューター アカウント]** を選択します。**[次へ]**、**[完了]**、**[OK]** の順にクリックして、[スナップインの追加と削除] ウィンドウを閉じます。  

4. **[個人]** を右クリックして、**[すべてのタスク]** > **[新しい証明書の要求]** の順にクリックします。  

5. 証明書の登録ウィザードで **[次へ]** をクリックしてから、**[Active Directory 登録ポリシー]** を選択して、**[次へ]** をクリックします。  

6. Web サーバー証明書 (**ConfigMgr MDM Web Server**) の隣にあるチェック ボックスをオンにしてから、**[登録]** をクリックします。  

7. 証明書を登録したら **[完了]** をクリックします。  

   それぞれのサーバーには一意の Web サーバー証明書が必要であることから、オンプレミスのモバイル デバイス管理に必要なサイト システムの役割の 1 つをホストしているすべてのサーバーに対して、この処理を繰り返す必要があります。  1 つのサーバーがすべてのサイト システムの役割をホストしている場合は、1 つの Web サーバー証明書のみを要求する必要があります。  

##  <a name="bkmk_bindCert"></a> Web サーバーに証明書をバインドする  
 オンプレミスのモバイル デバイス管理に必要なサイト システムの役割をホストしている各サイトの Web サーバーに新しい証明書をバインドする必要があります。 登録ポイントと登録プロキシ ポイントのサイト システムの役割をホストする各サーバーを対象に、次の手順に従います。 1 つのサーバーですべてのサイト システムの役割をホストしている場合は、これらの手順に一度だけ従う必要があります。 配布ポイントとデバイス管理ポイントのサイト システムの役割は、必要な証明書を登録時に自動的に受信することから、このタスクを実行する必要はありません。  

1.  登録ポイント、登録プロキシ ポイント、配布ポイント、またはデバイス管理ポイントをホストしているサーバーで、**[スタート]** > **[管理ツール]** > **[IIS マネージャー]** の順にクリックします。  

2.  [接続] で **[既定の Web サイト]** を右クリックしてから、**[バインドの編集...]** をクリックします。  

3.  [サイト バインド] ダイアログ ボックスで **[https]** をクリックしてから **[編集...]** をクリックします。  

4.  [サイト バインドの編集] ダイアログ ボックスで、**[SSL 証明書]** に対して先ほど登録した証明書を選択して、**[OK]** をクリックしてから、**[閉じる]** をクリックします。  

5.  [IIS マネージャー] コンソールの [接続] で、Web サーバーを選択してから、右側の [操作] パネルで **[再起動]** をクリックします。  

##  <a name="bkmk_exportCert"></a> Web サーバー証明書と同じルートの証明書をエクスポートする  
 通常では Active Directory 証明書サービスは、ドメインに参加しているすべてのデバイスに CA からの必要な証明書をインストールします。 ドメインに参加していないデバイスは、ルート CA からの証明書なしでサイト システムの役割と通信することはできません。 サイト システムの役割と通信するデバイスに必要な証明書を取得するには、Web サーバーにバインドされている証明書からエクスポートできます。  

 Web サーバーの証明書のルート証明書をエクスポートするには、これらの手順に従います。  

1.  IIS マネージャーで、**[既定の Web サイト]** をクリックしてから、右側の [操作] パネルで **[バインド]** をクリックします。  

2.  [サイト バインド] ダイアログ ボックスで **[https]** をクリックしてから **[編集...]** をクリックします。  

3.  Web サーバー証明書が選択されているかどうかを確認して、**[表示]** をクリックします。  

4.  Web サーバー証明書のプロパティで、**[証明のパス]** をクリックし、証明のパスの上部にあるルートをクリックしてから、**[証明書の表示]** をクリックします。  

5.  ルート証明書のプロパティで **[詳細]** をクリックしてから **[ファイルにコピー...]** をクリックします。  

6.  証明書のエクスポート ウィザードで、**[次へ]** をクリックします。  

7.  形式として **[DER encoded binary X.509 (.CER)]** が選択されていることを確認して、**[次へ]** をクリックします。  

8.  ファイル名で **[参照...]** をクリックします。証明書ファイルを保存する場所を選択し、ファイルの名前を入力して、**[保存]** をクリックします。  

     登録するデバイスは、ルート証明書をインポートするために、このファイルにアクセスする必要があります。そのために、ほとんどのコンピューターとデバイスがアクセスできる共通場所を選択するか、または当面都合の良い場所 (C ドライブなど) にこのファイルを保存しておいて、後で共通場所に移動します。  

     **[次へ]** をクリックします。  

9. 設定を確認して、**[完了]** をクリックします。  
